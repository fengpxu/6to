(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[11],{"369e":function(t,e,s){"use strict";s("8c40")},"60fe":function(t,e,s){"use strict";s("8062")},"6ba5":function(t,e,s){"use strict";s.r(e);var o=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"channel-page"},[s("q-virtual-scroll",{ref:"vscroll",staticClass:"posts",staticStyle:{height:"calc(100vh - 130px)",padding:"0"},attrs:{separator:"",items:t.filteredPosts,"virtual-scroll-slice-size":10,"virtual-scroll-item-size":385,"virtual-scroll-sticky-size-end":16,"virtual-scroll-sticky-size-start":560},on:{"virtual-scroll":t.onScroll},scopedSlots:t._u([{key:"before",fn:function(){return[t.isPreview?s("q-card",{staticClass:"channel-preview-hint",attrs:{id:"channel-preview-hint"}},[s("q-card-section",[s("div",{staticClass:"text-h6"},[t._v(t._s(t.$t("preview_mode")))]),s("div",{staticClass:"text-subtitle2"},[t._v(t._s(t.$t("preview_mode_desc")))])])],1):t._e(),s("div",{staticClass:"full-width flex justify-center",class:t.screen$xs?["q-pt-sm"]:["q-pt-md"]},[t.channel&&t.channel.id?s("ChannelHeader",{staticClass:"col-grow",class:[t.screen$xs?"q-ml-sm q-mr-xs":"q-mx-md"],attrs:{channel:t.channel},on:{scrollTop:t.scrollTop,intersect:t.intersect}}):t._e()],1)]},proxy:!0},{key:"default",fn:function(e){var o=e.item,a=e.index;return[s("PostCard",{key:a,attrs:{hideChannel:"",post:o},on:{preview:t.preview}})]}},{key:"after",fn:function(){return[s("div",{staticClass:"flex justify-center items-center",class:t.filteredPosts.length?["q-py-xl"]:["full-height"],style:{marginTop:t.filteredPosts.length?"-16px":"0"}},[t.filteredPosts.length?[s("q-icon",{attrs:{name:"check_circle_outline",size:"1.2rem"}}),s("div",{staticClass:"q-ml-sm"},[t._v(t._s(t.$t("got_all_post")))])]:[s("q-icon",{attrs:{name:"error_outline",size:"1.2rem"}}),s("div",{staticClass:"q-ml-sm"},[t._v(t._s(t.$t("credit_no_data")))])]],2)]},proxy:!0}])}),s("BackToTop",{attrs:{show:t.scrollIndex>0&&!t.isIntersecting},on:{click:t.scrollTop}}),s("q-dialog",{model:{value:t.showPreview,callback:function(e){t.showPreview=e},expression:"showPreview"}},[s("q-card",{staticClass:"image-preview-card"},[s("q-card-section",{staticClass:"q-pa-none"},[s("img",{staticClass:"preview-image",attrs:{src:t.previewImage}})]),s("q-card-actions",{staticClass:"q-pa-none",staticStyle:{position:"absolute",bottom:"0",right:"0"},attrs:{align:"right"}},[s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",padding:"none",size:"20px",icon:"close",color:"grey"}})],1)],1)],1),s("Loading",{attrs:{value:t.loadingPost}})],1)},a=[],i=(s("e01a"),s("ddb0"),s("826a")),n=s("4aad"),l=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-card",{staticClass:"channel-header relative-position overflow-hidden",style:{boxShadow:"0 1px 2px rgba(0, 0, 0, 0.24)",border:t.$q.dark.isActive?"1px solid rgba(255,255,255,0.24)":"none"}},[s("q-card-section",{staticStyle:{height:"140px"}},[s("div",{staticClass:"absolute-top-left bg-black full-width full-height overflow-hidden"},[s("img",{staticStyle:{filter:"brightness(0.7)"},attrs:{src:t.channel.image,width:"100%"},on:{error:t.onImageError}}),s("div",{staticClass:"absolute-top-left full-width full-height",staticStyle:{"box-shadow":"inset 0 0 50px rgba(0,0,0,0.8)"}})])]),s("q-card-section",{staticClass:"q-py-none q-pr-none q-mb-md flex no-wrap items-start bg-transparent relative-position",staticStyle:{height:"calc(60px + 4px)"}},[s("q-avatar",{staticClass:"q-ml-xs bg-black",staticStyle:{transform:"translateY(-50%)"},attrs:{size:"120px"}},[t.isLoadChannelImage?s("img",{attrs:{src:t.channel.image},on:{error:t.onChannelImageError,load:t.onChannelImageLoaded}}):t._e(),t.isLoadChannelImage?t._e():s("q-icon",{staticStyle:{color:"#ccc"},attrs:{name:"subscriptions",size:"65px"}})],1),s("div",{staticClass:"q-px-md overflow-hidden full-height full-width flex items-center justify-start"},[s("q-badge",{staticClass:"block q-py-xs cursor-pointer non-selectable",attrs:{color:"general","text-color":"general"},on:{click:function(e){t.showFollowers=!0}}},[s("div",{staticClass:"header-channel-info"},[s("span",{staticClass:"text-weight-bolder"},[t._v(t._s(t.followerCount))]),t._v("Â "),s("span",[t._v(t._s(t.$t("followers")))])])]),s("q-space"),s("FollowButton",{attrs:{id:t.channel.id}})],1)],1),s("q-card-section",{staticClass:"q-pt-none column items-stretch",staticStyle:{width:"fit-content","max-width":"100%"}},[s("div",{staticClass:"flex items-center no-wrap overflow-hidden full-width"},[s("div",{staticClass:"channel-title text-h6 text-weight-bold ellipsis col-shrink",attrs:{title:t.channel.title}},[t._v(t._s(t.channel.title))]),s("q-space"),s("q-btn",{staticClass:"q-ml-sm q-pa-xs",attrs:{unelevated:"",color:"general","text-color":"general",icon:"content_copy",size:"xs",dense:""},on:{click:function(e){return t.copy(t.channel.id)}}},[s("q-tooltip",[s("span",[t._v(t._s(t.$t("channel")+" ID: "))]),s("span",[t._v("%"+t._s(t.channel.id))])])],1),t.lib.isLibAdmin?s("q-btn",{staticClass:"q-ml-xs q-pa-xs",attrs:{unelevated:"",dense:"",color:"general","text-color":"general",icon:"block",size:"xs"},on:{click:t.takedownChannel}},[s("q-tooltip",[t._v(t._s(t.$t("takedown_channel")))])],1):t._e()],1),s("div",{staticClass:"flex items-center no-wrap overflow-hidden full-width"},[s("div",{staticClass:"creator-title cursor-pointer ellipsis col-shrink",staticStyle:{"font-size":"0.9rem"},on:{click:t.gotoCreator}},[t._v("\n        "+t._s(t.$t("creator"))+": "),s("span",[t._v(t._s(t.creator.name))])]),s("q-space"),t.creator.id?s("q-btn",{staticClass:"q-ml-sm q-pa-xs",attrs:{unelevated:"",color:"general","text-color":"general",icon:"content_copy",size:"xs",dense:""},on:{click:function(e){return t.copy(t.creator.id)}}},[s("q-tooltip",[s("span",[t._v(t._s(t.$t("creator")+" ID: "))]),s("span",[t._v("@"+t._s(t.creator.id))])])],1):t._e(),t.lib.isLibAdmin?s("q-btn",{staticClass:"q-ml-xs q-pa-xs",attrs:{unelevated:"",dense:"",color:"general","text-color":"general",icon:"block",size:"xs"},on:{click:t.takedownCreator}},[s("q-tooltip",[t._v(t._s(t.$t("takedown_user")))])],1):t._e()],1)]),s("q-card-section",{staticClass:"q-pt-none"},[s("div",{staticClass:"header-description"},[t._v("\n      "+t._s(t.channel.description)+"\n    ")]),s("div",{staticClass:"header-badges q-mt-sm non-selectable",staticStyle:{height:"min-content"}},[s("div",{staticClass:"overflow-hidden",staticStyle:{margin:"-4px"}},[t.channel.hidden?s("q-badge",{staticClass:"q-ma-xs q-py-xs",attrs:{color:"general","text-color":"general",label:t.$t("private_channel")}}):t._e(),t.isBlocked?s("q-badge",{staticClass:"q-ma-xs q-py-xs",attrs:{color:"negative","text-color":"negative",label:t.$t("blocked")}}):t._e(),t.isBlockedCreator?s("q-badge",{staticClass:"q-ma-xs q-py-xs",attrs:{color:"negative","text-color":"negative",label:t.$t("creator_blocked")}}):t._e()],1)])]),s("div",{staticClass:"absolute-top-right q-ma-sm flex"},[s("q-btn",{directives:[{name:"intersection",rawName:"v-intersection",value:function(e){return t.$emit("intersect",e)},expression:"e => $emit('intersect', e)"}],attrs:{unelevated:"",round:"",icon:"share","text-color":"white"},on:{click:t.copyShareLink}},[s("q-tooltip",[t._v(t._s(t.$t("share")))])],1)],1),s("q-dialog",{attrs:{position:t.screen$xs?"bottom":"standard","content-class":"fullscreen-dialog"},model:{value:t.showFollowers,callback:function(e){t.showFollowers=e},expression:"showFollowers"}},[s("q-card",{staticClass:"column overflow-hidden no-wrap",style:{minWidth:t.screen$xs?void 0:"560px",maxHeight:t.screen$xs?void 0:"calc(100vh - 120px)"}},[s("q-card-section",{staticClass:"row items-center q-py-sm"},[s("div",{staticClass:"text-h6 follower-title"},[t._v(t._s(t.$t("follower"))+" - "+t._s(t.channel.title))]),s("q-space"),s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",icon:"close",round:""}})],1),s("q-separator"),s("q-card-section",{staticClass:"row items-center q-pa-none",staticStyle:{"min-width":"400px","flex-grow":"1","flex-shrink":"1","overflow-y":"auto"}},[s("q-markup-table",{staticStyle:{width:"100%"},attrs:{dense:"",flat:""}},[s("thead",[s("tr",[s("th",{staticClass:"text-left"},[t._v(t._s(t.$t("user")))]),s("th",{staticClass:"text-right"},[t._v(t._s(t.$t("follow_time")))])])]),s("tbody",t._l(t.followers,(function(e){return s("tr",{key:e.id},[s("td",{staticClass:"text-left"},[t._v(t._s(e.user))]),s("td",{staticClass:"text-right"},[t._v(t._s(e.time))])])})),0)])],1)],1)],1)],1)},r=[],c=(s("d9e2"),s("f71e")),h=s("bae3"),d=s("20fc"),u=s("a939"),p=s("708e"),f=s.n(p),g={components:{FollowButton:u["a"]},name:"ChannelHeader",props:{channel:{type:Object,required:!0}},data(){return{creator:{name:this.$t("loading"),id:"",avatar:"",description:""},followBtnHovered:!1,pending:!1,showFollowers:!1,offFollower:null,isLoadChannelImage:!0,followers:[],lib:n["a"]}},computed:{currentCreator(){return n["a"].currentCreator},isBlocked(){return!(!n["a"].userData||!n["a"].userData.blockChannels)&&n["a"].userData.blockChannels.includes(this.channel.id)},isBlockedCreator(){return!(!n["a"].userData||!n["a"].userData.blockUsers)&&n["a"].userData.blockUsers.includes(this.channel.creator)},followable(){return!n["a"].followingChannels.find((t=>t.id===this.channel.id))},followBtnLabel(){return this.followable?this.$t("follow"):this.followBtnHovered?this.$t("unfollow"):this.$t("following")},followerCount(){let t=this.followers.length;return t<1e3?t.toString():(t=Math.floor(t/1e3),t<1e3?t.toString()+"K+":(t=Math.floor(t/1e3),t<1e3?t.toString()+"M+":(t=Math.floor(t/1e3),t.toString()+"B+")))}},methods:{loadCreator(){this.channel.creator.id!==this.creator.id&&(this.creator={name:this.$t("loading"),id:"",avatar:"",description:""}),n["a"].getUserProfile(this.channel.creator).then((t=>{this.creator=t}))},loadFollowers(){i["v"].get(`${i["e"]}/channels:follower/${this.channel.id}`).on(((t,e,s,o)=>{this.offFollower=()=>o.off();const a=Object.values(t);for(let i=0;i<this.followers.length;i++)a.includes(this.followers[i].id)||this.followers.splice(i--,1);for(const i of a){if(!i||"string"!==typeof i)continue;const[t,...e]=i.split("|"),s=e.join("|"),o=parseInt(t);if(isNaN(o)||!s)continue;const a=this.followers.findIndex((t=>t.id===i)),n={id:i,user:s,timestamp:o,time:new Date(o).toLocaleString()};-1!==a?this.followers.splice(a,1,n):this.followers.push(n)}}))},copy(t){Object(c["b"])(t).then((()=>{this.$q.notify(this.$t("copied_to_clipboard"))}))},async copyShareLink(){const t=`${f.a.shortProtocol}-library://channel/${Object(h["b"])(this.channel.title)}/${this.channel.id}`,e=await Object(d["a"])(t);if(!e)return this.$q.notify(this.$t("uri_copy_failed"));Object(c["b"])(e).then((()=>{this.$q.notify(this.$t("share_url_copied"))}))},async follow(){if(this.pending)return;const t=this.channel.id;if(!t)return;if(!n["a"].allChannelList.some((e=>e.id===t)))return this.$q.dialog({title:this.$t("channel_not_found"),message:this.$t("cannot_get_channel_info"),ok:!0});const e=this.followable;if(!e){const t=await new Promise((t=>{this.$q.dialog({title:this.$t("unfollow"),message:this.$t("unfollow_confirm"),ok:this.$t("unfollow"),cancel:this.$t("cancel")}).onOk((()=>t(!1))).onDismiss((()=>t(!0)))}));if(t)return}this.pending=!0,setTimeout((()=>{!n["a"].followingChannels.find((e=>e.id===t))===e&&(console.log("follow failed!",t,e),e&&n["a"].followChannel(t))}),2e3),e?n["a"].followChannel(t):n["a"].unfollowChannel(t)},gotoCreator(){if(console.log("goto creator",this.currentCreator),!this.currentCreator||!this.currentCreator.name)return this.$q.dialog({title:this.$t("loading_creator"),message:this.$t("wait_for_creator_loaded"),ok:this.$t("ok")});const t=`/library/creator?fromChannel=1&name=${encodeURIComponent(this.currentCreator.name)}`;this.$router.push(t).then((e=>{e instanceof Error||this.$root.$emit("navigate-to",t)}))},takedown(t,e){const s=[{value:"Serious Violation",label:this.$t("serious_violation")},{value:"Copyright Disputes",label:this.$t("copyright_disputes")},{value:"Adults Only",label:this.$t("adults_only")}];this.$q.dialog({options:{model:s[0].value,type:"radio",items:s},message:this.$t("select_takedown_reason"),ok:this.$t("take_down"),cancel:this.$t("cancel")}).onOk((s=>{console.log(s),["Serious Violation","Copyright Disputes","Adults Only"].includes(s)&&n["a"].takedown(t,e,s).then((()=>{this.$q.notify(this.$t("success"))}))}))},takedownCreator(){if(!n["a"].currentCreator||!n["a"].currentCreator.id)return this.$q.notify("Please wait for creator loaded");this.takedown("user",n["a"].currentCreator.id)},takedownChannel(){if(!this.channel.id)return this.$q.notify("Cannot get channel id");this.takedown("channel",this.channel.id)},onImageError(t){t.target.src="developer/platform-assets/linux/512x512.png"},onChannelImageError(){this.isLoadChannelImage=!1},onChannelImageLoaded(t){t.target.src===this.channel.image&&(this.isLoadChannelImage=!0)}},mounted(){this.loadCreator(),this.loadFollowers(),this.$nextTick((()=>{this.$emit("scrollTop")}))},activated(){this.loadCreator(),"function"===typeof this.offFollower&&(this.offFollower(),this.loadFollowers(),this.$nextTick((()=>{this.$emit("scrollTop")})))},beforeDestroy(){"function"===typeof this.offFollower&&this.offFollower()},watch:{followable(){this.pending=!1},currentCreator(){this.loadCreator()},channel(t,e){t&&t.image!==e.image&&(this.isLoadChannelImage=!0)}}},m=g,w=(s("60fe"),s("2877")),v=s("f09f"),C=s("a370"),b=s("cb32"),$=s("0016"),_=s("58a8"),q=s("2c91"),x=s("9c40"),y=s("05c0"),k=s("24e8"),I=s("eb85"),S=s("2bb1"),P=s("b498"),D=s("9748"),O=s("7f67"),L=s("eebe"),j=s.n(L),F=Object(w["a"])(m,l,r,!1,null,"1d2daf92",null),T=F.exports;j()(F,"components",{QCard:v["a"],QCardSection:C["a"],QAvatar:b["a"],QIcon:$["a"],QBadge:_["a"],QSpace:q["a"],QBtn:x["a"],QTooltip:y["a"],QDialog:k["a"],QSeparator:I["a"],QMarkupTable:S["a"],QColor:P["a"]}),j()(F,"directives",{Intersection:D["a"],ClosePopup:O["a"]});var Q=s("2de9"),B=s("0ebe"),z=s("ab9a"),A=s("ed08"),E=s("0613"),N={name:"LibraryChannel",components:{ChannelHeader:T,PostCard:Q["a"],Loading:z["a"],BackToTop:B["a"]},data(){return{channel:{id:""},posts:[],showPreview:!1,loadingPost:!1,previewImage:"",channelFollowers:[],currentId:"",scrollIndex:0,isIntersecting:!1,isChecking:!1,isPreview:!1,showLoading:!1,lib:n["a"]}},computed:{isDev(){return E["a"].getters.isDevMode},isFollowed(){return n["a"].followingChannels.some((t=>t.id===this.channel.id))},isBlocked(){return!(!n["a"].userData||!n["a"].userData.blockChannels)&&(n["a"].userData.blockChannels.includes(this.channel.id)||n["a"].userData.blockUsers.includes(this.channel.creator))},channelPosts(){const t=Object.assign({},this.channel);return this.posts.map((e=>({...e,rate:e.rate||"G",channel:t}))).sort(((t,e)=>e.timestamp-t.timestamp))},filteredPosts(){const t=n["a"].search.text.toLowerCase(),e=n["a"].search.option.value,s=t=>{switch(e){case"description":return t.description;default:return t.title}},o=e=>{var o;return Object(h["a"])(null===(o=s(e))||void 0===o?void 0:o.toLowerCase()).includes(Object(h["a"])(t))};return this.channelPosts.filter((t=>!!this.isPreview||!n["a"].isBannedPost(t)&&n["a"].isValidRate(t.rate))).filter(o)}},methods:{intersect(t){this.isIntersecting=t.isIntersecting},onAvatarError(t){t.target.src="developer/platform-assets/linux/512x512.png"},onScroll(t){this.scrollIndex=t.index},scrollTop(){this.$refs.vscroll.scrollTo(0,"start")},loadChannelPosts(){console.log(this.$route.query);const t=this.lib.allChannelList.find((t=>t.id===this.$route.query.id||t.soul===this.$route.query.soul));if(console.log("load channel",t),t){var e,s;if(this.channel=t,this.loadingPost=!0,this.channel.creator||this.channel.soul)n["a"].setCreator(this.channel.creator||(null===(e=this.channel.soul)||void 0===e||null===(s=e.split("/"))||void 0===s?void 0:s[0]));this.posts=[],n["a"].getChannelPosts(t.id,!0).then((t=>{console.log("Channel posts",t),this.posts=t.sort(((t,e)=>{const s=e.timestamp-t.timestamp;return 0===s?t.title.match(/^\d+/)&&e.title.match(/^\d+/)?parseInt(e.title)-parseInt(t.title):e.title.localeCompare(t.title):s}));const e=Date.now(),s=setInterval((()=>{(this.posts.length||Date.now()-e>5e3)&&(this.loadingPost=!1,clearInterval(s))}),1e3)}))}else{if(this.posts=[],console.log(this.$route.path),"library/channel"!==this.$route.path)return;this.$q.dialog({title:this.$t("channel_not_found"),message:this.$t("cannot_get_channel_info"),persistent:!0,ok:this.$t("lib_index")}).onOk((()=>{this.currentId="",this.$root.$emit("navigate-to"),this.$router.push("/library")}))}},loadChannelFollowers(){const t=[];i["v"].get(`${i["e"]}/channels:follower/${this.channel.id}`).on((e=>{if(!e)return;const s=Object.values(e);for(let o=0;o<t.length;o++)s.includes(t[o].id)||t.splice(o--,1);for(const o of Object.values(e)){if(!o||"string"!==typeof o)continue;const[e,...s]=o.split("|"),a=parseInt(e);if(isNaN(a))continue;const i=s.join("|"),n=t.findIndex((t=>t.id===o));-1!==n?t.splice(n,1,{id:o,user:i,timestamp:a}):t.push({id:o,user:i,timestamp:a})}})),this.channelFollowers=t.sort(((t,e)=>e.timestamp-t.timestamp))},async copyShare(){const t=`ab-library://channel/${Object(h["b"])(this.channel.title)}/${this.channel.id}`;if(console.log("share",t),Object(A["isElectron"])()){const e=await Object(d["a"])(t);if(!e)return this.$q.notify(this.$t("uri_copy_failed"));Object(c["b"])(e).then((()=>{this.$q.notify(this.$t("copied"))}))}},onFollow(){const t=this.channel.id;console.log("follow",t),n["a"].followingChannels.map((t=>t.id)).includes(t)?this.$q.dialog({title:this.$t("unfollow"),message:this.$t("unfollow_confirm"),ok:this.$t("unfollow"),cancel:this.$t("cancel")}).onOk((()=>{n["a"].unfollowChannel(t)})):n["a"].followChannel(t)},preview(t){this.previewImage=t,this.showPreview=!0},gotoCreator(){if(!n["a"].currentCreator||!n["a"].currentCreator.name)return this.$q.dialog({title:"Loading creator",message:"Please wait for creator info loaded",ok:!0});const t=`/library/creator?fromChannel=1&name=${encodeURIComponent(n["a"].currentCreator.name)}`;this.$root.$emit("navigate-to",t),this.$router.push(t)},checkAndReload(){console.log("check and reload"),this.isChecking||(this.isChecking=!0,setTimeout((()=>{this.isChecking=!1}),1e3),this.currentId===this.$route.query.id&&this.channelPosts.length||(console.log("load channel posts"),i["v"].get(`${i["e"]}/channels:follower/${this.currentId}`).off(),this.channel={},this.posts=[],this.currentId=this.$route.query.id,this.loadChannelPosts(),this.loadChannelFollowers()),this.$route.query.preview?this.isPreview=!0:this.isPreview=!1)},setSearch(){this.lib.setSearchOption([{label:this.$t("post_title"),value:"post"},{label:this.$t("description"),value:"description"}])}},mounted(){this.setSearch(),this.checkAndReload()},watch:{"$route.query.id"(t){t&&(console.log("query id check"),this.checkAndReload())},searchText(t){t&&this.active&&this.scrollTop()}},beforeDestroy(){i["v"].get(`${i["e"]}/channels:follower/${this.channel.id}`).off()}},H=N,M=(s("369e"),s("a12b")),R=s("4b7e"),U=Object(w["a"])(H,o,a,!1,null,"c19413d6",null);e["default"]=U.exports;j()(U,"components",{QVirtualScroll:M["a"],QCard:v["a"],QCardSection:C["a"],QIcon:$["a"],QDialog:k["a"],QCardActions:R["a"],QBtn:x["a"]}),j()(U,"directives",{ClosePopup:O["a"]})},8062:function(t,e,s){},"8c40":function(t,e,s){}}]);