(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[3],{"09dd":function(t,e,a){},"19bf":function(t,e,a){"use strict";a("d226")},"298f":function(t,e,a){},"29ed":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-page",{staticClass:"flex"},[a("q-scroll-area",{staticStyle:{"min-height":"100%","min-width":"100%"}},[a("optional-information"),a("verification-fields",{attrs:{loading:t.loading},on:{setLoading:t.setLoading}}),a("security"),a("OAuthManager",{directives:[{name:"show",rawName:"v-show",value:t.d$cfg.oauth.enable,expression:"d$cfg.oauth.enable"}],attrs:{loading:t.loading},on:{setLoading:t.setLoading}}),a("library-key"),a("keychain")],1)],1)},s=[],o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("setting-fragment",{attrs:{label:t.$t("account_personal_information")}},[a("q-form",{staticClass:"account-setting__information",on:{submit:function(e){return t.$refs.submitButton.handleButton(e)},reset:function(){t.edited=!1,t.fetchUser()}}},[t._l(t.form,(function(e,n,s){return["select"===e.type?a("Selector",{key:n,class:[s===Object.keys(t.form).length-1?"q-pb-xs":"q-pb-lg","full-width"],style:{minWidth:"280px"},attrs:{readonly:t.changing,value:e.model,options:e.options},on:{input:function(a){t.edited=!0,e.model=a}}}):a("q-input",{key:n,class:[s===Object.keys(t.form).length-1?"q-pb-xs":"q-pb-lg","full-width"],style:{minWidth:"280px"},attrs:{dense:"",outlined:"",readonly:t.changing,type:e.type,label:e.label,value:e.model,rules:e.rules,spellcheck:"false"},on:{input:function(a){t.edited=!0,e.model=a}},scopedSlots:t._u([{key:"prepend",fn:function(){return[e.icon?a("q-icon",{attrs:{name:e.icon}}):t._e()]},proxy:!0}],null,!0)})]})),a("div",{directives:[{name:"show",rawName:"v-show",value:t.edited,expression:"edited"}],staticClass:"optional-container q-mt-md"},[a("q-btn",{ref:"submitButton",staticStyle:{"min-width":"128px"},attrs:{unelevated:"",disable:t.changing||!t.fieldsValid,loading:t.changing,label:t.$t("account_submit"),type:"submit",color:"primary","text-color":"primary"},on:{click:t.handleSubmit}}),a("q-btn",{staticStyle:{"min-width":"128px"},attrs:{unelevated:"",disable:t.changing,label:t.$t("account_reset"),type:"reset",color:"general","text-color":"general"}})],1)],2)],1)},i=[],r=(a("ddb0"),a("48f4")),l=a("ed08"),c=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{class:["setting-fragment"].concat(t.fragClz)},[a("div",{class:["setting-fragment__label"].concat(t.fragLabelClz)},[a("div",[t._v(t._s(t.label))]),t._t("label")],2),a("div",{class:["setting-fragment__content"].concat(t.fragContentClz)},[t._t("default")],2)])},d=[],u={name:"SettingFragment",props:{label:String},data(){return{fragClz:[],fragLabelClz:["non-selectable","text-general","row","items-center"],fragContentClz:[]}}},h=u,p=(a("19bf"),a("2877")),m=Object(p["a"])(h,c,d,!1,null,null,null),_=m.exports,g=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-select",t._g(t._b({attrs:{dense:"",outlined:"",behavior:"menu",readonly:t.readonly,options:t.filter?t.optionsArr.filter((function(e){return t.filter(e.value)})):t.optionsArr,"option-label":function(e){return t.filter?"":"not_say"===e.label?t.$t("account_not_say"):e.label},"menu-offset":[0,4],"menu-anchor":"bottom left","menu-self":"top start","transition-show":"jump-down","transition-hide":"jump-up"},scopedSlots:t._u([{key:"no-option",fn:function(){return[a("q-item",{staticClass:"non-selectable",style:t.noOptionStyle},[a("q-item-section",{staticClass:"text-grey"},[t._v("\n        No results\n      ")])],1)]},proxy:!0},t.model&&(t.model.icon||t.model.emoji)?{key:"prepend",fn:function(){return[t.model.icon?a("q-icon",{attrs:{name:t.model.icon}}):t.model.emoji?a("div",{style:t.emojiStyle},[t._v(t._s(t.model.emoji))]):t._e()]},proxy:!0}:null,{key:"option",fn:function(e){var n=e.itemProps,s=e.itemEvents,o=e.opt;return[a("q-item",t._g(t._b({staticClass:"overflow-hidden-x",style:t.optionStyle},"q-item",n,!1),s),[o.icon||o.emoji?a("q-item-section",{staticStyle:{"margin-left":"-4px","margin-right":"-22px"},attrs:{avatar:""}},[o.icon?a("q-icon",{attrs:{name:o.icon}}):o.emoji?a("div",{style:t.emojiStyle},[t._v(t._s(o.emoji))]):t._e()],1):t._e(),a("q-item-section",{staticStyle:{"margin-left":"-4px"}},[a("q-item-label",{domProps:{innerHTML:t._s("not_say"===o.label?t.$t("account_not_say"):o.label)}})],1)],1)]}}],null,!0),model:{value:t.model,callback:function(e){t.model=e},expression:"model"}},"q-select",t.filterProps,!1),t.filterEvents))},b=[],f=a("839e");const v=(()=>{const t={TW:t=>{"TW"===t.country_code&&(t.emoji="🇼🇫")}},e=[];return Object.entries(f["countries"]).forEach((([a,n])=>{const s={country_code:a,name:n.name,name_native:n.native,emoji:n.emoji,phone_list:n.phone.split(","),language_list:n.languages};t.TW(s),e.push(s)})),e})(),y=v.map((t=>({id:t.country_code,country_code:t.country_code,name:t.name,name_native:t.name_native,emoji:t.emoji}))),$=y.reduce(((t,e)=>(t[e.id]=e,t)),{}),w={value:"not_say",label:"not_say",emoji:"🇼🇫"},C=(()=>{const t=Object.values($).map((t=>({value:t.id,label:t.name_native,emoji:t.emoji})));return t.unshift(w),t})(),q=t=>t===w.value?w:$[t],k={data(){return{emojiStyle:{fontFamily:"Noto Color Emoji",fontSize:"1.22rem",color:"#000"}}}},x={data(){const t={getInputEl:()=>this.$el,observer:new ResizeObserver((()=>{const t=this.mixin$OptionsStyle.getInputEl(),{width:e}=getComputedStyle(t);this.optionStyle={width:`calc(${e} - 8px)`},this.noOptionStyle={width:e}}))};return{mixin$OptionsStyle:t,optionStyle:{},noOptionStyle:{}}},mounted(){this.mixin$OptionsStyle.observer.observe(this.mixin$OptionsStyle.getInputEl())},beforeDestroy(){this.mixin$OptionsStyle.observer.unobserve(this.mixin$OptionsStyle.getInputEl())}},S={data(){return{isPopupShow:!1,filter:null}},computed:{filterProps(){return["locale"].includes(this.options)?{useInput:!0,inputDebounce:"0",inputStyle:this.isPopupShow?void 0:"display:none"}:{}},filterEvents(){return["locale"].includes(this.options)?{"popup-show":this.onPopupShow.bind(this),filter:this.onFilter.bind(this),"popup-hide":this.onPopupHide.bind(this)}:{}}},methods:{onFilter(t,e){e((()=>{this.filter=e=>{if(!t)return!0;if("not_say"===e)return!1;const a=q(e),n=[a.name,a.name_native,a.country_code];return n.some((e=>e.toLowerCase().includes(t.toLowerCase())))}}))},onPopupShow(){this.isPopupShow=!0,this.$nextTick((()=>{const t=this.$el.getElementsByTagName("input")[0];t.focus()}))},onPopupHide(){this.isPopupShow=!1,this.filter=null}}};var O={name:"Selector",mixins:[k,x,S],props:{value:String,options:[Array,String],readonly:Boolean},computed:{optionsArr(){const t=Object.assign([],"locale"===this.options?C:this.options);return t},model:{get(){return Object.assign({},this.optionsArr.find((t=>t.value===this.value)))},set(t){t&&this.$emit("input",t.value)}}}},A=O,E=(a("a2be"),a("ddd8")),N=a("66e5"),L=a("4074"),j=a("0016"),P=a("0170"),M=a("eebe"),Q=a.n(M),I=Object(p["a"])(A,g,b,!1,null,null,null),U=I.exports;Q()(I,"components",{QSelect:E["a"],QItem:N["a"],QItemSection:L["a"],QIcon:j["a"],QItemLabel:P["a"]});var F=a("05e4"),T=function(){const t={};return t.nickname={type:"text",icon:"emoji_emotions",label:this.$t("account_nickname"),rules:[F["c"].bind(this)],model:""},t.gender={type:"select",options:[{value:"not_say",icon:"elevator",label:this.$t("account_not_say")},{value:"female",icon:"female",label:this.$t("account_female")},{value:"male",icon:"male",label:this.$t("account_male")}],model:"not_say"},t.birthday={type:"date",icon:"cake",model:""},t.locale={type:"select",model:"not_say",options:"locale"},t},D={name:"OptionalInformation",components:{SettingFragment:_,Selector:U},data(){return{changing:!1,form:null,edited:!1}},created(){this.$watch("$store.getters.accountUserOptionalInfo",(()=>{this.fetchUser()}),{immediate:!0})},computed:{fieldsValid(){return!Object.values(this.form).some((t=>{if(t.rules)return t.rules.some((e=>!0!==e(t.model)))}))}},methods:{fetchUser(){const t=Object(l["deepClone"])(this.$store.getters.accountUserOptionalInfo),e=this.form||T.call(this);Object.entries(t).forEach((([t,a])=>{e[t]&&(e[t].model="notSay"===a?"not_say":a)})),this.form=e},async handleSubmit(){try{this.changing=!0,await this.$store.dispatch("ACCOUNT_CHANGE_ATTRIBUTES",Object.entries(this.form).reduce(((t,[e,a])=>(t[e]=a.model,t)),{})),r["a"].showPositive("changed"),this.edited=!1}catch(t){r["a"].showNegative(t.message)}finally{this.changing=!1}}}},z=D,B=(a("4f7a"),a("0378")),K=a("27f9"),W=a("9c40"),V=Object(p["a"])(z,o,i,!1,null,null,null),R=V.exports;Q()(V,"components",{QForm:B["a"],QInput:K["a"],QIcon:j["a"],QBtn:W["a"]});var H=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("setting-fragment",{attrs:{label:t.$t("account_contact_information")}},[a("q-list",{staticClass:"account-setting__verification rounded-borders",attrs:{bordered:"",separator:""}},t._l(t.items,(function(e,n){return a("q-item",{directives:[{name:"ripple",rawName:"v-ripple",value:!t.loading,expression:"!loading"}],key:n,staticClass:"q-pa-md",attrs:{clickable:!t.loading,readonly:t.loading},on:{click:e.handleClick}},[a("q-item-section",{staticStyle:{"min-width":"unset"},attrs:{avatar:""}},[a("q-icon",{staticStyle:{opacity:"0.7"},attrs:{size:"1.75rem",name:e.icon}})],1),a("q-item-section",[a("q-item-label",[t._v(t._s(e.title))]),a("q-item-label",{attrs:{caption:""}},[t._v(t._s(e.field||t.$t("account_not_set")))])],1),a("q-item-section",{attrs:{side:""}},[e.field&&e.verifiedLabel?a("q-badge",{attrs:{color:e.color,label:e.verifiedLabel}}):t._e()],1),a("q-tooltip",{attrs:{anchor:"center middle",self:"center middle","transition-show":"scale","transition-hide":"scale"}},[t._v("\n        "+t._s(e.verifiedLabel?t.$t("account_change"):t.$t("account_setting"))+"\n      ")])],1)})),1)],1)},G=[],Z=(a("5319"),a("d9e2"),a("8349")),Y={name:"VerificationFields",components:{SettingFragment:_},props:{loading:Boolean},computed:{items(){const t=t=>t?"positive":"negative",e=t=>this.$t(t?"account_verified":"account_unverified"),a={title:this.$t("account_email"),icon:"email",field:this.$store.state.account.email,color:t(this.$store.state.account.emailVerified),verifiedLabel:e(this.$store.state.account.emailVerified),handleClick:this.handleClickEmail},n={title:this.$t("account_phone_number"),icon:"phone",field:this.$store.state.account.phoneNumber,color:t(this.$store.state.account.phoneNumberVerified),verifiedLabel:e(this.$store.state.account.phoneNumberVerified),handleClick:this.handleClickPhoneNumber};return[a,n]}},methods:{parsePhoneNumberModel(t,e){const a=Z["a"][e].phones.map((t=>t.replace("-"+e,""))).find((e=>t.startsWith("+"+e)));return t=t.substr(a.length+1),console.log({countryCode:e,prefixCode:a,phoneNumber:t}),{countryCode:e,prefixCode:a,phoneNumber:t}},getDefaultPrefix(){var t;const e=null!==(t=this.$q.lang.getLocale().toLowerCase())&&void 0!==t?t:"en-us",[a,n]=Z["b"][e].phones[0].split("-");return console.log({countryCode:n,prefixCode:a}),{countryCode:n,prefixCode:a}},async handleClickEmail(){const t=()=>{if(this.$store.state.account.identities.length>0)throw new Error("error_can_not_change_email_before_unbound_social_account");if("NOMFA"!==this.$store.state.account.preferredMFA)throw new Error("can_not_change_email_phone_with_mfa_enabled");if(!this.$store.state.account.phoneNumberVerified)throw new Error("can_not_change_email")};try{t()}catch(o){return void r["a"].showNegative(o.message)}const e=async t=>{const e=[t=>!!t||this.$t("account_is_required"),t=>/^([a-zA-Z]|[0-9])(\w|-)+@[a-zA-Z0-9]+\.([a-zA-Z]{2,4})$/.test(t)||this.$t("account_invalid_email_format")],a={email:{type:"email",model:"",icon:"email",label:this.$t("account_email"),rules:e}};this.$store.state.account.email&&!this.$store.state.account.emailVerified&&(a.email.model=this.$store.state.account.email);const n=this.$alphabiz.dialog({title:this.$t("account_change_email"),prompts:a,cancel:!0,ok:{handler:()=>n.vm.dialog$useLoadingState("ok",(async e=>{const{prompts:a}=e.dialog$arguments();await t(e,a.email)}))}});await n.promise()},a=async t=>{const e=[t=>!!t||this.$t("account_is_required"),F["h"].bind(this)],a={code:{type:"text",label:this.$t("account_verification_code"),icon:"shield",rules:e}},n=this.$alphabiz.dialog({title:this.$t("account_change_email"),prompts:a,cancel:!0,ok:{handler:()=>n.vm.dialog$useLoadingState("ok",(async e=>{const{prompts:a}=e.dialog$arguments();await t(e,a.code)}))}});await n.promise()},n=async t=>{try{if(t===this.$store.state.account.email&&this.$store.state.account.emailVerified)throw new Error("error_same_email");return await this.$store.dispatch("ACCOUNT_CHANGE_EMAIL_SEND",t),!0}catch(o){return r["a"].showNegative(o.message),!1}},s=async t=>{try{return await this.$store.dispatch("ACCOUNT_CHANGE_EMAIL_SUBMIT",t),!0}catch(o){return r["a"].showNegative(o.message),!1}};await e((async(t,e)=>{const o=await n(e);o&&await a((async(e,a)=>{const n=await s(a);n&&(r["a"].showPositive("changed"),e.hide(),t.hide())}))}))},async handleClickPhoneNumber(){const t=()=>{if("NOMFA"!==this.$store.state.account.preferredMFA)throw new Error("can_not_change_email_phone_with_mfa_enabled");if(!this.$store.state.account.emailVerified)throw new Error("can_not_change_phone")};try{t()}catch(o){return void r["a"].showNegative(o.message)}const e=async t=>{const e=[t=>!!t||this.$t("account_is_required"),(t,e)=>!!e||void 0===e||this.$t("account_is_required"),F["e"].bind(this)],a={phoneNumber:{type:"tel",model:{countryCode:null,prefixCode:null,phoneNumber:""},rules:e}};this.$store.state.account.phoneNumber&&!this.$store.state.account.phoneNumberVerified?Object.assign(a.phoneNumber.model,this.parsePhoneNumberModel(this.$store.state.account.phoneNumber,this.$store.state.account.phoneNumberCountryCode)):Object.assign(a.phoneNumber.model,this.getDefaultPrefix());const n=this.$alphabiz.dialog({title:this.$t("account_change_phone_number"),cancel:!0,prompts:a,ok:{handler:()=>n.vm.dialog$useLoadingState("ok",(async e=>{const{prompts:a}=e.dialog$arguments();await t(e,a.phoneNumber)}))}});await n.promise()},a=async t=>{const e=[t=>!!t||this.$t("account_is_required"),F["h"].bind(this)],a={type:"text",icon:"shield",label:this.$t("account_verification_code"),rules:e},n=this.$alphabiz.dialog({title:this.$t("account_change_phone_number"),prompts:{code:a},cancel:!0,ok:{handler:()=>n.vm.dialog$useLoadingState("ok",(async e=>{const{prompts:a}=e.dialog$arguments();await t(e,a.code)}))}})},n=async(t,e)=>{try{if(e===this.$store.state.account.phoneNumber&&this.$store.state.account.phoneNumberVerified)throw new Error("error_same_phone");return await this.$store.dispatch("ACCOUNT_CHANGE_PHONE_NUMBER_SEND",{phoneNumberCountryCode:t,phoneNumber:e}),!0}catch(o){return r["a"].showNegative(o.message),!1}},s=async t=>{try{return await this.$store.dispatch("ACCOUNT_CHANGE_PHONE_NUMBER_SUBMIT",t),!0}catch(o){return r["a"].showNegative(o.message),!1}};await e((async(t,{countryCode:e,prefixCode:o,phoneNumber:i})=>{const l=await n(e,`+${o}${i}`);l&&await a((async(e,a)=>{const n=await s(a);n&&(r["a"].showPositive("changed"),e.hide(),t.hide())}))}))}}},J=Y,X=(a("ef28"),a("1c1c")),tt=a("58a8"),et=a("05c0"),at=a("714f"),nt=Object(p["a"])(J,H,G,!1,null,"f85a6d9c",null),st=nt.exports;Q()(nt,"components",{QList:X["a"],QItem:N["a"],QItemSection:L["a"],QIcon:j["a"],QItemLabel:P["a"],QBadge:tt["a"],QTooltip:et["a"]}),Q()(nt,"directives",{Ripple:at["a"]});var ot=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("setting-fragment",{attrs:{label:t.$t("account_security")}},[a("div",{staticClass:"account-setting__security"},[a("security-change-password"),a("SecurityMFA"),a("security-delete-account")],1)])},it=[],rt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-btn",{attrs:{"no-caps":"","no-wrap":"",unelevated:"",color:"general","text-color":"general",label:t.$t("account_change_password")},on:{click:t.changePassword}})},lt=[],ct={name:"SecurityChangePassword",methods:{async changePassword(){const t=async t=>{const e={required:t=>!!t||this.$t("account_is_required")},a={currentPassword:{type:"password",model:"",label:this.$t("account_current_password"),rules:[e.required,F["d"].bind(this)]},newPassword:{type:"password",model:"",label:this.$t("account_new_password"),rules:[e.required,F["d"].bind(this),t=>t!==a.currentPassword.model||this.$t("account_new_password_same")]},reEnterPassword:{type:"password",model:"",label:this.$t("account_re_enter_new_password"),rules:[e.required,t=>t===a.newPassword.model||this.$t("account_password_not_equal")]}},n=this.$alphabiz.dialog({title:this.$t("account_change_password"),cancel:!0,prompts:a,ok:{color:"primary",textColor:"primary",handler:()=>n.vm.dialog$useLoadingState("ok",(async()=>{const{prompts:e}=n.vm.dialog$arguments(),a=await t(e.currentPassword,e.newPassword);a&&n.vm.hide()}))}});await n.promise()};await t((async(t,e)=>{try{return await this.$store.dispatch("ACCOUNT_CHANGE_PASSWORD",{oldPassword:t,newPassword:e}),r["a"].showPositive("password_has_been_reset"),!0}catch(a){const t="Incorrect username or password."===a.message?"incorrect_original_password":a.message;r["a"].showNegative(t)}}))}}},dt=ct,ut=Object(p["a"])(dt,rt,lt,!1,null,null,null),ht=ut.exports;Q()(ut,"components",{QBtn:W["a"]});var pt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-btn",{attrs:{"no-caps":"","no-wrap":"",unelevated:"",color:"general","text-color":"red",label:t.$t("account_delete_account")},on:{click:t.deleteAccount}})},mt=[],_t={name:"SecurityDeleteAccount",methods:{async deleteAccount(){const t=async t=>{const e={type:"password",model:"",icon:"lock",label:this.$t("account_password"),rules:[t=>!!t||this.$t("account_is_required"),F["d"].bind(this)]},a=this.$alphabiz.dialog({title:this.$t("account_delete_account"),message:this.$t("account_tip_confirm_delete_account"),cancel:!0,prompts:{password:e},ok:{color:"negative",textColor:"negative",handler:()=>a.vm.dialog$useLoadingState("ok",(async()=>{const{prompts:e}=a.vm.dialog$arguments(),n=await t(e.password);n&&a.vm.hide()}))}});await a.promise()};await t((async t=>{try{return await this.$store.dispatch("ACCOUNT_DELETE_USER",{password:t}),r["a"].showPositive("deleted"),this.$router.push("/"),this.$amplify.showSignedOutDialog(),this.$root.$emit("pause-player-before-close"),!0}catch(e){r["a"].showNegative(e.message)}}))}}},gt=_t,bt=Object(p["a"])(gt,pt,mt,!1,null,null,null),ft=bt.exports;Q()(bt,"components",{QBtn:W["a"]});var vt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-btn-dropdown",{attrs:{"no-caps":"",unelevated:"",color:"general","text-color":"general",label:t.$t("account_set_mfa_type")}},[a("q-list",[a("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],class:"SOFTWARE_TOKEN_MFA"===t.$store.state.account.preferredMFA?"bg-general text-general":"",attrs:{clickable:t.$store.state.account.preferredMFA&&"SOFTWARE_TOKEN_MFA"!==t.$store.state.account.preferredMFA},on:{click:t.handleOTP}},[a("q-item-section",[a("q-item-label",[t._v(t._s(t.$t("account_totp_mfa")))])],1)],1),a("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],class:"SMS_MFA"===t.$store.state.account.preferredMFA?"bg-general text-general":"",attrs:{clickable:t.$store.state.account.preferredMFA&&"SMS_MFA"!==t.$store.state.account.preferredMFA},on:{click:t.handleSMS}},[a("q-item-section",[a("q-item-label",[a("span",[t._v(t._s(t.$t("account_sms_mfa")))]),a("span",[t._v("("+t._s(t.$t("account_not_recommend"))+")")])])],1)],1),a("q-item",{directives:[{name:"show",rawName:"v-show",value:t.$store.state.account.preferredMFA&&"NOMFA"!==t.$store.state.account.preferredMFA,expression:"\n       $store.state.account.preferredMFA &&\n       $store.state.account.preferredMFA !== 'NOMFA'\n      "},{name:"close-popup",rawName:"v-close-popup"}],staticClass:"text-negative",attrs:{clickable:""},on:{click:t.handleDisable}},[a("q-item-section",[a("q-item-label",[t._v(t._s(t.$t("account_disable_mfa")))])],1)],1)],1)],1)},yt=[],$t=a("5723");async function wt({title:t,message:e},a){const n=[t=>!!t||this.$t("account_is_required"),F["h"].bind(this)],s=this.$alphabiz.dialog({title:t,message:e,prompts:{code:{type:"text",icon:"shield",label:this.$t("account_verification_code"),rules:n}},cancel:!0,ok:t=>t.dialog$useLoadingState("ok",(async()=>{const{prompts:e}=t.dialog$arguments();await a(t,e.code)}))});await s.promise()}var Ct={methods:{async handleSMS(){if(!this.validate())return;const t=async t=>{const e=this.$alphabiz.dialog({title:this.$t("account_sms_mfa"),message:this.$t("account_tip_confirm_verify_phone"),cancel:!0,ok:e=>e.dialog$useLoadingState("ok",t)});await e.promise()};await t((async t=>{await Object($t["s"])("phone_number"),t.hide(),await wt.call(this,{title:this.$t("account_sms_mfa"),message:this.$t("account_phone_sent_tip")+this.$store.state.account.phoneNumber},(async(t,e)=>{try{await Object($t["u"])("phone_number",e),await this.$store.dispatch("ACCOUNT_SET_MFA_TYPE","SMS_MFA"),r["a"].showPositive("changed"),t.hide()}catch({message:a}){r["a"].showNegative(a)}}))}))},async handleDisableSMS(){const t=async t=>{const e=this.$alphabiz.dialog({title:this.$t("account_disable_mfa"),message:this.$t("account_tip_confirm_verify_phone"),cancel:!0,ok:e=>e.dialog$useLoadingState("ok",t)});await e.promise()};await t((async t=>{await Object($t["s"])("phone_number"),t.hide(),await wt.call(this,{title:this.$t("account_disable_mfa"),message:this.$t("account_phone_sent_tip")+this.$store.state.account.phoneNumber},(async(t,e)=>{try{await Object($t["u"])("phone_number",e),await this.$store.dispatch("ACCOUNT_SET_MFA_TYPE","NOMFA"),r["a"].showPositive("changed"),t.hide()}catch({message:a}){r["a"].showNegative(a)}}))}))}}},qt=a("24e8"),kt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-card",{staticStyle:{"max-width":"400px"}},[a("q-card-section",[a("div",{staticClass:"text-h6 text-bold"},[t._v(t._s(t.$t("account_setup_totp")))])]),a("q-card-section",{staticClass:"q-pt-none"},[t._v("\n    "+t._s(t.$t("account_tip_setup_totp"))+"\n  ")]),a("q-card-section",{staticClass:"q-pt-none"},[a("div",{staticClass:"qrcode q-mx-auto",on:{click:t.copyCode}},[a("canvas",{ref:"qrcode",staticClass:"full-width full-height"}),a("div",[t._v(t._s(t.$t("account_copy_code")))])])]),a("q-card-section",{staticClass:"q-pt-none"},[a("q-btn",{staticClass:"full-width",attrs:{unelevated:"",color:"general","text-color":"general",label:t.$t("ok")},on:{click:function(e){return t.$emit("hide")}}})],1)],1)},xt=[],St=a("d055"),Ot=a.n(St),At=a("f71e"),Et={name:"SetupTOTPCard",props:{code:String},methods:{async copyCode(){await Object(At["b"])(this.code),r["a"].showPositive("clipboard_with_code")}},mounted(){const t=this.$refs.qrcode;let e="Alphabiz Account Services",a=this.$store.state.account.emailVerified?this.$store.state.account.email:e;e=encodeURIComponent(e),a=encodeURIComponent(a).replace(".","%2E");const n=encodeURIComponent(this.code),s=`otpauth://totp/${e}:${a}?secret=${n}&issuer=${e}`;Ot.a.toCanvas(t,s,(t=>{if(t)throw t}))}},Nt=Et,Lt=(a("c69f"),a("f09f")),jt=a("a370"),Pt=Object(p["a"])(Nt,kt,xt,!1,null,"81ae2a9c",null),Mt=Pt.exports;async function Qt(){const t=await Object($t["p"])(),e=this.$q.dialog({component:{render(a){return a(qt["a"],{ref:"dialog",props:{persistent:!0},on:{hide:()=>this.$emit("hide")}},[a(Mt,{props:{code:t},on:{hide:()=>e.hide()}})])},methods:{show(){this.$refs.dialog.show()},hide(){this.$refs.dialog.hide()}}}});await new Promise(e.onDismiss)}async function It({title:t,message:e,banner:a,label:n,actions:s},o){const i=[t=>!!t||this.$t("account_is_required"),F["h"].bind(this)],r=this.$alphabiz.dialog({title:t,message:e,banner:a,prompts:{code:{type:"text",icon:"shield",label:n,rules:i}},actions:s,cancel:!0,ok:t=>t.dialog$useLoadingState("ok",(async()=>{const{prompts:e}=t.dialog$arguments();await o(t,e.code)}))});await r.promise()}Q()(Pt,"components",{QCard:Lt["a"],QCardSection:jt["a"],QBtn:W["a"]});var Ut={methods:{async handleOTP(){if(!this.validate())return;const t=async(t,e)=>{try{await Object($t["q"])(e),await this.$store.dispatch("ACCOUNT_SET_MFA_TYPE","SOFTWARE_TOKEN_MFA"),r["a"].showPositive("changed"),t.hide()}catch({message:a}){r["a"].showNegative(a)}};await It.call(this,{title:this.$t("account_totp_mfa"),message:this.$t("account_tip_verify_totp"),banner:this.$t("account_tip_no_totp"),label:this.$t("account_totp"),actions:{setupTOTP:{label:this.$t("account_setup_totp"),handler:t=>t.dialog$useLoadingState("setupTOTP",Qt.bind(this))}}},t)},async handleDisableOTP(){await It.call(this,{title:this.$t("account_disable_mfa"),message:this.$t("account_tip_verify_totp"),label:this.$t("account_totp")},(async(t,e)=>{try{await Object($t["q"])(e),await this.$store.dispatch("ACCOUNT_SET_MFA_TYPE","NOMFA"),r["a"].showPositive("changed"),t.hide()}catch({message:a}){r["a"].showNegative(a)}}))}}},Ft={name:"SecurityMFA2",mixins:[Ct,Ut],data(){return{}},methods:{validate(){const t=!this.$store.state.account.email||!this.$store.state.account.phoneNumber||!this.$store.state.account.emailVerified||!this.$store.state.account.phoneNumberVerified;return!t||(this.$q.notify({message:this.$t("account_error_can_not_enable_mfa"),type:"negative",position:"bottom-right",timeout:5e3}),!1)},handleDisable(){const t=this.$store.state.account.preferredMFA;"SMS_MFA"===t?this.handleDisableSMS():"SOFTWARE_TOKEN_MFA"===t&&this.handleDisableOTP()}}},Tt=Ft,Dt=(a("4f41"),a("f20b")),zt=a("7f67"),Bt=Object(p["a"])(Tt,vt,yt,!1,null,null,null),Kt=Bt.exports;Q()(Bt,"components",{QBtnDropdown:Dt["a"],QList:X["a"],QItem:N["a"],QItemSection:L["a"],QItemLabel:P["a"],QBtn:W["a"]}),Q()(Bt,"directives",{ClosePopup:zt["a"]});var Wt={name:"Security",components:{SettingFragment:_,SecurityChangePassword:ht,SecurityMFA:Kt,SecurityDeleteAccount:ft}},Vt=Wt,Rt=(a("45a0"),Object(p["a"])(Vt,ot,it,!1,null,"b409e69e",null)),Ht=Rt.exports,Gt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("setting-fragment",{style:{display:t.hide?"none":"flex"},attrs:{label:"OAuth"}},[a("ABOAuthManager",{staticClass:"account-setting__oauth"})],1)},Zt=[],Yt={name:"OAuthManager",components:{SettingFragment:_},props:{loading:Boolean},data(){return{hide:!1}}},Jt=Yt,Xt=(a("e6b8"),Object(p["a"])(Jt,Gt,Zt,!1,null,"082fc340",null)),te=Xt.exports,ee=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("SettingFragment",{attrs:{label:t.$t("keychain_setting")},scopedSlots:t._u([{key:"label",fn:function(){return[a("q-icon",{staticClass:"q-ml-sm cursor-pointer",attrs:{name:"help_outline",color:"general",size:"1.25rem"},on:{click:t.showAbout}})]},proxy:!0}])},[a("div",{staticClass:"setting-library-key"},[a("StatusBanner",{attrs:{loading:t.currentLoading},on:{loading:function(e){return t.currentLoading=e}}},[t.$store.getters.keychainState.lib?a("div",{staticClass:"row full-width"},[a("ChangePassword",{attrs:{loading:t.currentLoading},on:{loading:function(e){return t.currentLoading=e}}}),a("MnemonicCode")],1):t._e()]),a("q-list",{staticClass:"q-mt-sm rounded-borders overflow-hidden full-width",staticStyle:{"max-width":"calc(100vw - 16px)",border:"1px solid rgba(127,127,127,0.3)"}},[a("KeychainItem",{attrs:{loading:t.currentLoading},on:{loading:function(e){return t.currentLoading=e}}})],1)],1)])},ae=[],ne=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-banner",{staticClass:"bg-general text-general rounded-borders full-width",staticStyle:{"max-width":"calc(100vw - 16px)"},scopedSlots:t._u([{key:"avatar",fn:function(){return[a("q-icon",{attrs:{size:"1.75rem",color:"cloud"===t.libKeyStatus.type?"green":void 0,name:{pending:"pending",cloud:"cloud_done",local:"cloud_off"}[t.libKeyStatus.type]}})]},proxy:!0},{key:"default",fn:function(){return[a("div",{staticClass:"relative-position q-mb-sm"},[a("div",{staticClass:"text-weight-bold"},[t._v(t._s(t.$t("keychain_sync_status")))]),a("div",[t._v(t._s(t.libKeyStatusSummary))]),t.libKeyStatus.useCognito?a("div",[t._v("\n        "+t._s(t.$t("independent_password_not_enabled"))+"\n      ")]):t._e(),a("div",{staticClass:"absolute-top-right",staticStyle:{margin:"-8px -8px 0 0"}},[a("q-btn",{attrs:{flat:"",round:"",icon:"refresh",disable:!!t.currentLoading,loading:"sync_keychain_state"===t.currentLoading},on:{click:function(e){return t.useCurrentLoading("sync_keychain_state",t.syncKeychainState)}}})],1)])]},proxy:!0},{key:"action",fn:function(){return[a("div",["local"===t.libKeyStatus.type?a("q-btn",{attrs:{flat:"","no-wrap":"","no-caps":"",icon:"cloud",color:"green","text-color":"green",label:t.$t("enable_cloud_storage"),disable:!!t.currentLoading||"local"!==t.libKeyStatus.type,loading:"enable_cloud_storage"===t.currentLoading},on:{click:function(e){return t.useCurrentLoading("enable_cloud_storage",t.keychain$enableCloudStorage)}}}):"cloud"===t.libKeyStatus.type?a("q-btn",{attrs:{flat:"","no-wrap":"","no-caps":"",icon:"cloud_off",color:"red","text-color":"red",label:t.$t("disable_cloud_storage"),disable:!!t.currentLoading||"cloud"!==t.libKeyStatus.type,loading:"disable_cloud_storage"===t.currentLoading},on:{click:function(e){return t.useCurrentLoading("disable_cloud_storage",t.keychain$disableCloudStorage)}}}):t._e()],1),t.$slots.default?a("div",{staticClass:"full-width"},[a("div",{staticClass:"column",staticStyle:{margin:"0 -16px"}},[[a("q-separator",{staticClass:"q-mt-sm q-mb-xs"})],a("div",{staticClass:"q-px-xs"},[t._t("default")],2)],2)]):t._e()]},proxy:!0}],null,!0)})},se=[],oe=a("0613"),ie={props:{loading:[Object,String]},computed:{currentLoading:{get(){return this.loading},set(t){this.$emit("loading",t)}}},methods:{async useCurrentLoading(t,e){try{this.currentLoading=t,await e()}finally{this.currentLoading=null}}}},re=a("a4d4"),le=a("c894"),ce={name:"StatusBanner",i18n:le["a"],mixins:[ie,re["b"]],computed:{libKeyStatus(){const t={};if("sync_keychain_state"===this.currentLoading)return t.type="pending",t;const e=oe["a"].getters.keychainState.lib;return t.type=e?"cloud":"local",e&&(t.useCognito=oe["a"].getters.keychainState.unset),t},libKeyStatusSummary(){return"pending"===this.libKeyStatus.type?this.$t("loading"):"local"===this.libKeyStatus.type?this.$t("cloud_storage_disabled"):this.$t("cloud_storage_enabled",{storage:"Amazon Web Services"})}},methods:{async syncKeychainState(){await oe["a"].dispatch("syncKeychainState")}},mounted(){this.syncKeychainState()}},de=ce,ue=a("54e1"),he=a("eb85"),pe=Object(p["a"])(de,ne,se,!1,null,null,null),me=pe.exports;Q()(pe,"components",{QBanner:ue["a"],QIcon:j["a"],QBtn:W["a"],QSeparator:he["a"]});var _e=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-item",{staticClass:"q-pa-md"},[a("q-item-section",{staticStyle:{"min-width":"unset"},attrs:{avatar:""}},[a("q-icon",{staticStyle:{opacity:"0.7"},attrs:{size:"1.75rem",name:"video_library"}})],1),a("q-item-section",[a("q-item-label",[t._v(t._s(t.$t("keychain_"+t.key)))]),a("q-item-label",{attrs:{caption:""}},[t.syncEnabled?[t._v("\n        "+t._s(t.$t("sync_at",{time:t.$d(t.timestamp,"YMDHms")}))+"\n      ")]:[t._v("\n        "+t._s(t.$t("saved_locally"))+"\n      ")]],2)],1),a("q-item-section",{attrs:{side:""}},[a("q-btn",{staticStyle:{margin:"-8px -8px -8px 0"},attrs:{icon:"more_vert",flat:"",round:""}},[a("q-menu",{attrs:{"touch-position":"","auto-close":"","transition-show":"jump-down","transition-hide":"jump-up"}},[a("q-list",{staticStyle:{"min-width":"180px"}},[a("q-item",{attrs:{clickable:""},on:{click:function(){return t.useCurrentLoading("import_local_key",t.lib$importLocalKey)}}},[a("q-item-section",[a("q-item-label",[t._v(t._s(t.$t("import_local_key")))])],1)],1),a("q-item",{attrs:{clickable:""},on:{click:function(){return t.useCurrentLoading("export_current_key",t.lib$exportCurrentKey)}}},[a("q-item-section",[a("q-item-label",[t._v(t._s(t.$t("export_current_key")))])],1)],1),t.syncEnabled?[a("q-separator"),a("q-item",{attrs:{clickable:""},on:{click:function(){return t.useCurrentLoading("export_cloud_key",t.lib$exportCloudKey)}}},[a("q-item-section",[a("q-item-label",[t._v(t._s(t.$t("export_cloud_key")))])],1)],1),a("q-item",{attrs:{clickable:""},on:{click:function(){return t.useCurrentLoading("backup_current_key",t.lib$backupCurrentKey)}}},[a("q-item-section",[a("q-item-label",[t._v(t._s(t.$t("backup_current_key")))])],1)],1)]:t._e()],2)],1)],1)],1)],1)},ge=[],be=a("e65a"),fe={name:"KeychainItem",i18n:le["a"],mixins:[ie,be["c"]],data(){return{key:"lib"}},computed:{syncEnabled(){return!!this.$store.getters.keychainState.lib},timestamp(){return this.$store.getters.keychainState.timestamps[this.key]||0}}},ve=fe,ye=a("4e73"),$e=Object(p["a"])(ve,_e,ge,!1,null,null,null),we=$e.exports;Q()($e,"components",{QItem:N["a"],QItemSection:L["a"],QIcon:j["a"],QItemLabel:P["a"],QBtn:W["a"],QMenu:ye["a"],QList:X["a"],QSeparator:he["a"]});var Ce=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-btn",{attrs:{unelevated:"","no-caps":"","no-wrap":"",color:"general","text-color":"general",label:t.$t("change_password"),disable:!!t.currentLoading,loading:"change_password"===t.currentLoading},on:{click:function(e){return t.useCurrentLoading("change_password",t.keychain$changePassword)}}})},qe=[],ke={name:"ChangePassword",i18n:le["a"],mixins:[ie,re["b"]]},xe=ke,Se=Object(p["a"])(xe,Ce,qe,!1,null,"72f877a7",null),Oe=Se.exports;Q()(Se,"components",{QBtn:W["a"]});var Ae=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"mnemonic-code"},[a("input",{ref:"fileSelector",staticStyle:{display:"none"},attrs:{type:"file",name:"file",accept:".txt"},domProps:{value:t.file},on:{change:t.onFile}}),a("q-btn",{staticClass:"full-width",attrs:{unelevated:"","no-wrap":"","no-caps":"",color:"general","text-color":"general",label:t.$t("mnemonic_code")},on:{click:t.showDialog}}),a("q-dialog",{model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[a("q-card",{staticClass:"mnemonic-code-card",staticStyle:{width:"360px"}},[a("q-card-section",[a("div",{staticClass:"text-h6 text-bold"},[t._v(t._s(t.$t("mnemonic_code")))])]),a("q-card-section",{staticClass:"q-py-none"},[a("div",{staticClass:"wordlist-select"},[a("q-select",{attrs:{dense:"",outlined:"",options:t.wordlists,label:t.$t("wordlist")},model:{value:t.wordlist,callback:function(e){t.wordlist=e},expression:"wordlist"}})],1)]),a("q-card-actions",{staticClass:"q-pa-md",attrs:{align:"right"}},[a("q-btn",{attrs:{flat:"",label:t.$t("restore_code"),color:"general"},on:{click:function(e){t.showImport=!0}}}),a("q-btn",{attrs:{flat:"",label:t.$t("generate_code"),color:"primary"},on:{click:t.toMnemonicCode}})],1)],1)],1),a("q-dialog",{staticClass:"export-dialog",attrs:{position:t.screen$xs?"bottom":"standard","content-class":"fullscreen-dialog"},model:{value:t.showExport,callback:function(e){t.showExport=e},expression:"showExport"}},[a("q-card",{staticClass:"export-dialog-card column no-wrap"},[a("q-card-section",[a("div",{staticClass:"text-h6 text-bold"},[t._v(t._s(t.$t("export_mnemonic_code")))])]),a("q-card-section",{staticClass:"q-py-none col-grow"},[a("q-input",{staticClass:"q-mt-md",attrs:{type:"textarea",outlined:"",label:t.$t("mnemonic_code"),"input-style":"height: calc(60vh - 120px)",readonly:""},model:{value:t.mnemonicCode,callback:function(e){t.mnemonicCode=e},expression:"mnemonicCode"}})],1),a("q-card-actions",{staticClass:"q-pa-md",attrs:{align:"right"}},[a("q-btn",{attrs:{flat:"",color:"general",icon:"close",label:t.$t("close")},on:{click:function(e){t.showExport=!1}}}),a("q-btn",{attrs:{flat:"",color:"primary",icon:"content_copy",label:t.$t("copy")},on:{click:t.copyCode}}),t.isElectron?a("q-btn",{attrs:{flat:"",color:"primary",icon:"picture_as_pdf",label:t.$t("save_as_pdf")},on:{click:t.savePdf}}):t._e(),a("q-btn",{attrs:{flat:"",color:"primary",icon:"save",label:t.$t("save_as_txt")},on:{click:t.saveTxt}})],1)],1)],1),a("q-dialog",{staticClass:"import-dialog",attrs:{position:t.screen$xs?"bottom":"standard","content-class":"fullscreen-dialog"},model:{value:t.showImport,callback:function(e){t.showImport=e},expression:"showImport"}},[a("q-card",{staticClass:"import-dialog-card column"},[a("q-card-section",[a("div",{staticClass:"text-h6 text-bold"},[t._v(t._s(t.$t("import_mnemonic_code")))])]),a("q-card-section",{staticClass:"q-py-none col-grow"},[a("div",{staticClass:"wordlist-select"},[a("q-select",{attrs:{options:t.wordlists,label:t.$t("wordlist"),outlined:"",dense:""},model:{value:t.wordlist,callback:function(e){t.wordlist=e},expression:"wordlist"}})],1),a("q-input",{staticClass:"q-mt-md",attrs:{type:"textarea",outlined:"",label:t.$t("mnemonic_code"),"input-style":"height: calc(60vh - 120px)"},model:{value:t.mnemonicCode,callback:function(e){t.mnemonicCode=e},expression:"mnemonicCode"}})],1),a("q-card-actions",{staticClass:"q-pa-md",attrs:{align:"right"}},[a("q-btn",{attrs:{flat:"",color:"general",icon:"close",label:t.$t("close")},on:{click:function(e){t.showImport=!1}}}),a("q-btn",{attrs:{flat:"",color:"primary",icon:"note_add",label:t.$t("open_file")},on:{click:t.fromFile}}),a("q-btn",{attrs:{flat:"",color:"primary",icon:"add",label:t.$t("import")},on:{click:t.fromMnemonicCode}})],1)],1)],1)],1)},Ee=[],Ne=a("29c9");const Le={0:"0".charCodeAt(0),9:"9".charCodeAt(0),a:"a".charCodeAt(0),z:"z".charCodeAt(0),A:"A".charCodeAt(0),Z:"Z".charCodeAt(0),_:"_".charCodeAt(0),"-":"-".charCodeAt(0)},je=(t=0)=>{if(isNaN(t))return 0;if(t>=Le[0]&&t<=Le[9])return t-Le[0];if(t>=Le.a&&t<=Le.z)return t-Le.a+10;if(t>=Le.A&&t<=Le.Z)return t-Le.A+36;if(t===Le._)return 62;if(t===Le["-"])return 63;throw new Error(`Invalid code ${t} as character ${String.fromCharCode(t)}`)},Pe=(t=0)=>{if(isNaN(t))return 0;if(t<0)throw new Error(`Invalid number ${t}: should not smaller than 0`);if(t<10)return t+Le[0];if(t<36)return t+Le.a-10;if(t<62)return t+Le.A-36;if(62===t)return Le._;if(63===t)return Le["-"];throw new Error(`Invalid number ${t}: should not larger than 63`)},Me=(t="")=>{let e="";for(let a=t.length;a>0;a-=2){const[n,s]=[t.charCodeAt(a-2),t.charCodeAt(a-1)].map(je),o=(64*n+s).toString(16).padStart(3,"0");e=o+e}return e},Qe=(t="")=>{let e="";for(let a=t.length;a>0;a-=3){let n=parseInt(t.substring(a-3,a),16),s="";while(0!==n)s=String.fromCharCode(Pe(n%64))+s,n=Math.floor(n/64);e=s.padStart(2,"0")+e}return e},Ie=t=>{const{pub:e,priv:a,epub:n,epriv:s}=t,[o,i]=e.split("."),[r,l]=n.split("."),c=[o,s,l,i,a,r].join("");return Me(c)},Ue=t=>{if("string"!==typeof t||387!==t.length)throw new Error("Expect hex to be string with length=387");const e=Qe(t),[a,n,s,o,i,r]=e.match(/.{43}/g),l=a+"."+o,c=r+"."+s;return{pub:l,priv:i,epub:c,epriv:n}};var Fe=a("826a"),Te=a("bae3"),De={name:"MnemonicCode",data(){return{show:!1,showImport:!1,showExport:!1,mnemonicCode:"",isElectron:Object(l["isElectron"])(),wordlists:[{label:this.$t("english"),value:"english"},{label:this.$t("chinese"),value:"chinese_simplified"},{label:this.$t("traditional_chinese"),value:"chinese_traditional"}],wordlist:{label:this.$t("english"),value:"english"},file:null}},mixins:[be["c"]],methods:{showDialog(){this.wordlist={label:this.$t("english"),value:"english"},this.mnemonicCode="",this.showImport=!1,this.showExport=!1,this.show=!0},toMnemonicCode(){const t=Fe["v"].user()._.sea;if(t&&t.priv&&t.epriv){const e=Ie(t).padStart(448,"0").match(/.{64}/g);Object(Ne["setDefaultWordlist"])(this.wordlist.value);const a=e.map((t=>Object(Ne["entropyToMnemonic"])(t))),n=Ne["wordlists"][this.wordlist.value][0];console.log("first word",n,Ne["wordlists"][this.wordlist.value]),a[0]=a[0].replace((n+" ").repeat(22),""),this.mnemonicCode=a.join(" ").split(" ").map(((t,e)=>`${e+1}. ${t}`)).reduce(((t,e)=>{const a=t[t.length-1];return 6===a.length?t.push([e]):a.push(e),t}),[[]]).map((t=>t.join(" "))).join(" "),this.showExport=!0}else this.$q.dialog({title:this.$t("not_logged_in"),message:this.$t("login_to_continue"),ok:this.$t("ok")})},fromMnemonicCode(){Object(Ne["setDefaultWordlist"])(this.wordlist.value);const t=this.validateMnemonicCode(this.mnemonicCode);if(!t)return this.$q.dialog({title:this.$t("error"),message:this.$t("not_valid_mnemonic_code"),ok:this.$t("ok")});try{const e=t.reduce(((t,e)=>{const a=t[t.length-1];return 24===a.length?t.push([e]):a.push(e),t}),[[]]).map((t=>t.join(" "))).map((t=>Object(Ne["mnemonicToEntropy"])(t))).join("").substring(61),a=Ue(e);console.log("decode",a),this.promptImportKey(a)}catch(e){console.log(`Cannot parse key for reason ${e.message||e}`),this.$q.dialog({title:this.$t("error"),message:this.$t("cannot_parse_code_as_key"),ok:this.$t("ok")})}},promptImportKey(t){this.$q.dialog({title:this.$t("import_key"),message:this.$t("import_key_hint"),ok:this.$t("import_key_confirm"),cancel:this.$t("not_now")}).onOk((()=>{this.importKeyObject(t).then((()=>{this.showImport=!1,this.show=!1}))}))},validateMnemonicCode(t=""){if(!t||!t.length)return!1;const e=t.replace(/\d+\.\s?/g,"").replace(/\n/g," ").split(/\s+/g).filter((t=>t));if(console.log(e),146!==e.length)return!1;const a=Ne["wordlists"][this.wordlist.value][0];return e.unshift(...new Array(22).fill(a)),e},printCode(){const t=document.createElement("div");if(t.classList.add("printable"),t.innerText=this.mnemonicCode,document.body.appendChild(t),Object(l["isElectron"])()){const{ipcRenderer:e}=a("34bb");e.once("print-main-window",((e,a,n)=>{t.remove(),a||("no valid printers available"===n?this.$q.notify("It seems you did not have a printer or connect it to your device."):this.$q.notify(n))})),e.send("print-main-window")}else window.print(),t.remove()},savePdf(){if(!Object(l["isElectron"])())return;const{ipcRenderer:t}=a("34bb");t.send("save-as-pdf",`mnemonic-code-${Date.now()}.${this.wordlist.label}.pdf`,this.mnemonicCode)},saveTxt(){const t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8,"+this.mnemonicCode),t.setAttribute("download",`mnemonic-code-${Date.now()}.${this.wordlist.label}.txt`),t.style.display="none",document.body.appendChild(t),t.click(),setTimeout((()=>{t.remove()}),1e3)},copyCode(){Object(At["b"])(this.mnemonicCode).then((()=>{this.$q.notify(this.$t("copied_to_clipboard"))}))},fromFile(){this.$refs.fileSelector.click()},onFile(t){var e,a;if(console.log("onFile",t),null!==t&&void 0!==t&&null!==(e=t.target)&&void 0!==e&&null!==(a=e.files)&&void 0!==a&&a[0]){const e=t.target.files[0];if(e.size>1e6)return this.$q.notify("File too large!");Object(Te["g"])(e).then((t=>{this.mnemonicCode=t})),t.target.value=null}}}},ze=De,Be=(a("dfd9"),a("4b7e")),Ke=Object(p["a"])(ze,Ae,Ee,!1,null,"a42ce67a",null),We=Ke.exports;Q()(Ke,"components",{QBtn:W["a"],QDialog:qt["a"],QCard:Lt["a"],QCardSection:jt["a"],QSelect:E["a"],QInput:K["a"],QCardActions:Be["a"]});var Ve={name:"SettingKeychain",components:{SettingFragment:_,StatusBanner:me,KeychainItem:we,ChangePassword:Oe,MnemonicCode:We},i18n:le["a"],data(){return{currentLoading:null,showSetting:!1,showChangePassword:!1,input:{oldPassword:"",password:""},libraryPassword:""}},methods:{showAbout(){this.$alphabiz.dialog({title:this.$t("keychain_setting"),message:this.$t("setting_description")})}}},Re=Ve,He=(a("dc22"),Object(p["a"])(Re,ee,ae,!1,null,"51c58204",null)),Ge=He.exports;Q()(He,"components",{QIcon:j["a"],QList:X["a"]});var Ze=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("SettingFragment",{attrs:{label:t.$t("library_setting")}},[a("div",{staticClass:"setting-library-key"},[a("BlockList",{attrs:{loading:t.currentLoading},on:{loading:function(e){return t.currentLoading=e}}}),a("EditProfile",{attrs:{loading:t.currentLoading},on:{loading:function(e){return t.currentLoading=e}}})],1)])},Ye=[];const Je={library_setting:["Library setting","媒体库设置","媒體庫設置"],block_list_manage:["Block list manage","屏蔽列表管理","屏蔽列表管理"],blocked_users:["Blocked users","已屏蔽的用户","已屏蔽的用戶"],blocked_channels:["Blocked channels","已屏蔽的频道","已屏蔽的頻道"],unblock_user:["Unblock user","解除用户屏蔽","解除用戶屏蔽"],unblock_channel:["Unblock channel","解除频道屏蔽","解除頻道屏蔽"],no_blocked_user:["No blocked user","没有已屏蔽的用户","沒有已屏蔽的用戶"],no_blocked_channel:["No blocked channel","没有已屏蔽的频道","沒有已屏蔽的頻道"],field_required:["{0} is required","{0}不能为空","{0}不能為空"]},Xe={"en-US":{},"zh-CN":{},"zh-TW":{}},ta=Object.keys(Xe);Object.keys(Je).forEach((t=>{Je[t].forEach(((e,a)=>{Xe[ta[a]][t]=e}))}));var ea={messages:Xe},aa=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"block-list-manage"},[a("q-btn",{staticClass:"full-width",attrs:{unelevated:"","no-wrap":"","no-caps":"",color:"general","text-color":"general",label:t.$t("block_list_manage"),disable:!!t.currentLoading},on:{click:function(e){t.show=!0}}}),a("q-dialog",{attrs:{"content-class":"fullscreen-dialog",position:t.screen$xs?"bottom":"standard"},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[a("q-card",{staticClass:"column no-wrap"},[a("q-card-section",{staticClass:"q-px-md flex items-center",class:t.screen$xs?"q-py-sm":"q-py-md"},[a("div",{staticClass:"text-h6 text-weight-bold non-selectable"},[t._v(t._s(t.$t("block_list_manage")))]),a("q-space"),t.screen$xs?a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",icon:"close",round:""}}):t._e()],1),t.screen$xs?a("q-separator"):t._e(),a("q-card-section",{staticClass:"q-pb-none q-px-none row items-start block-list col-grow",class:t.screen$xs?"q-pt-sm":"q-pt-none"},[a("q-markup-table",{staticClass:"col-12 q-mb-md",attrs:{flat:""}},[a("thead",[a("tr",[a("th",{staticClass:"table-header text-left",attrs:{colspan:"3"}},[t._v(t._s(t.$t("blocked_users")))])]),a("tr",[a("th",{staticClass:"text-left table-id"},[t._v("ID")]),a("th",{staticClass:"text-left"},[t._v(t._s(t.$t("account_username")))]),a("th",{staticClass:"text-center table-operations"},[t._v(t._s(t.$t("operations")))])])]),a("tbody",[t._l(t.blockUsers,(function(e){return a("tr",{key:e.id},[a("td",{staticClass:"text-left table-id"},[t._v(t._s(e.id))]),a("td",{staticClass:"text-left table-name"},[t._v(t._s(e.name))]),a("td",{staticClass:"text-center table-operations"},[a("q-btn",{attrs:{"fab-mini":"",unelevated:"","text-color":"general",icon:"remove_circle_outline"},on:{click:function(a){return t.unblockUser(e.uid)}}},[a("q-tooltip",[t._v(t._s(t.$t("unblock_user")))])],1)],1)])})),t.blockUsers.length?t._e():a("tr",[a("td",{attrs:{colspan:"3"}},[a("div",{staticClass:"empty-placeholder"},[a("q-icon",{staticClass:"empty-icon",attrs:{name:"help_outline",size:"16px"}}),a("span",{staticClass:"empty-hint q-ml-sm"},[t._v(t._s(t.$t("no_blocked_user")))])],1)])])],2)]),a("q-markup-table",{staticClass:"col-12",attrs:{flat:""}},[a("thead",[a("tr",[a("th",{staticClass:"table-header text-left",attrs:{colspan:"3"}},[t._v(t._s(t.$t("blocked_channels")))])]),a("tr",[a("th",{staticClass:"text-left table-id"},[t._v(t._s(t.$t("channel_id")))]),a("th",{staticClass:"text-left"},[t._v(t._s(t.$t("channel_title")))]),a("th",{staticClass:"text-center table-operations"},[t._v(t._s(t.$t("operations")))])])]),a("tbody",[t._l(t.blockChannels,(function(e){return a("tr",{key:e.id},[a("td",{staticClass:"text-left table-id"},[t._v(t._s(e.id))]),a("td",{staticClass:"text-left table-name",attrs:{title:e.title}},[t._v(t._s(e.title))]),a("td",{staticClass:"text-center table-operations"},[a("q-btn",{attrs:{"fab-mini":"",unelevated:"","text-color":"general",icon:"remove_circle_outline"},on:{click:function(a){return t.unblockChannel(e.id)}}},[a("q-tooltip",[t._v(t._s(t.$t("unblock_channel")))])],1)],1)])})),t.blockChannels.length?t._e():a("tr",[a("td",{attrs:{colspan:"3"}},[a("div",{staticClass:"empty-placeholder"},[a("q-icon",{staticClass:"empty-icon",attrs:{name:"help_outline",size:"16px"}}),a("span",{staticClass:"empty-hint q-ml-sm"},[t._v(t._s(t.$t("no_blocked_channel")))])],1)])])],2)])],1)],1)],1)],1)},na=[],sa=a("4aad"),oa={props:{loading:[Object,String]},computed:{currentLoading:{get(){return this.loading},set(t){this.$emit("loading",t)}}},methods:{async useCurrentLoading(t,e){try{this.currentLoading=t,await e()}finally{this.currentLoading=null}}}},ia={name:"BlockList",i18n:ea,mixins:[oa],data(){return{show:!1,blockUsers:[],lib:sa["a"]}},computed:{blockChannels(){return sa["a"].userData&&sa["a"].userData.blockChannels?sa["a"].userData.blockChannels.map((t=>{const e=this.getChannelData(t);if(!e||!e.title)return null;const a=e.title;return{title:a,id:t}})):[]}},methods:{getUserData(t){return console.log("get user",t),sa["a"].getUserProfile(t).then((e=>{const a=e&&e.name?e.name:"(Unknown)";return Object.assign(e,{name:a,uid:t})}))},getChannelData(t){const e=sa["a"].allChannelList.find((e=>e.id===t));return{id:t,title:e&&e.title?e.title:"(Unknown)"}},unblockUser(t){sa["a"].unblockUser(t).then((e=>{console.log("unblock user result",e,t)})).catch((t=>{console.log(t)}))},unblockChannel(t){sa["a"].unblockChannel(t).then((t=>{console.log("unblock channel result",t)}))}},mounted(){this.$watch("lib.userData.blockUsers",(t=>{t&&t.length||this.blockUsers.splice(0);for(let e=0;e<this.blockUsers.length;e++)t.includes(this.blockUsers[e].id)||this.blockUsers.splice(e--,1);if(t)for(const e of t)this.blockUsers.find((t=>t.id===e))||this.getUserData(e).then((t=>{this.blockUsers.find((t=>t.id===e))||this.blockUsers.push(t)}))}),{immediate:!0})}},ra=ia,la=(a("d22a"),a("2c91")),ca=a("2bb1"),da=Object(p["a"])(ra,aa,na,!1,null,"104de609",null),ua=da.exports;Q()(da,"components",{QBtn:W["a"],QDialog:qt["a"],QCard:Lt["a"],QCardSection:jt["a"],QSpace:la["a"],QSeparator:he["a"],QMarkupTable:ca["a"],QTooltip:et["a"],QIcon:j["a"]}),Q()(da,"directives",{ClosePopup:zt["a"]});var ha=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"edit-profile"},[a("q-btn",{staticClass:"full-width",attrs:{unelevated:"","no-wrap":"","no-caps":"",color:"general","text-color":"general",label:t.$t("edit_user_profile"),disable:!!t.currentLoading},on:{click:t.showEdit}}),a("q-dialog",{attrs:{persistent:"","content-class":"fullscreen-dialog",position:t.screen$xs?"bottom":"standard"},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[a("q-card",{staticClass:"profile-editor column no-wrap"},[a("q-card-section",{staticClass:"q-px-md flex",class:t.screen$xs?"q-py-sm":"q-py-md"},[a("div",{staticClass:"q-mt-xs text-h6 text-weight-bold non-selectable"},[t._v(t._s(t.$t("edit_user_profile")))])]),a("q-separator",{directives:[{name:"show",rawName:"v-show",value:t.screen$xs,expression:"screen$xs"}]}),a("q-card-section",{staticClass:"column items-stretch col-grow",class:t.screen$xs?"q-py-md":"q-py-none"},[a("q-input",{staticClass:"q-mb-xs",attrs:{type:"text",outlined:"",dense:"",label:t.$t("account_nickname"),rules:[t.validateUserName]},nativeOn:{paste:function(t){t.stopPropagation()}},model:{value:t.profile.name,callback:function(e){t.$set(t.profile,"name",e)},expression:"profile.name"}}),a("q-input",{staticClass:"q-mb-xs",attrs:{type:"text",outlined:"",dense:"",label:t.$t("description"),rules:[t.validateUserDesc]},nativeOn:{paste:function(t){t.stopPropagation()}},model:{value:t.profile.description,callback:function(e){t.$set(t.profile,"description",e)},expression:"profile.description"}}),a("ImageWithPreview",{staticStyle:{"margin-bottom":"-8px"},attrs:{label:t.$t("avatar")+"(url)",rules:[t.validateUserAvatar]},on:{state:t.updateAvatarState},nativeOn:{paste:function(t){t.stopPropagation()}},model:{value:t.profile.avatar,callback:function(e){t.$set(t.profile,"avatar",e)},expression:"profile.avatar"}})],1),a("q-separator",{directives:[{name:"show",rawName:"v-show",value:t.screen$xs,expression:"screen$xs"}]}),a("q-card-actions",{staticClass:"q-px-md",class:t.screen$xs?"q-py-sm":"q-py-md",attrs:{align:"right"}},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],staticClass:"q-px-md",attrs:{unelevated:"",color:"general","text-color":"general",icon:"close",label:t.$t("cancel")}}),a("q-btn",{staticClass:"q-px-md",attrs:{unelevated:"",color:"primary","text-color":"primary",icon:"done",label:t.$t("lib_submit")},on:{click:t.submit}})],1)],1)],1)],1)},pa=[],ma=(a("e01a"),a("c65d")),_a={name:"EditProfile",i18n:ea,mixins:[oa],components:{ImageWithPreview:ma["a"]},data(){return{show:!1,avatarState:0,profile:{name:"",description:"",avatar:""}}},computed:{userProfile(){return sa["a"].userData}},methods:{validateUserName(t){return t?t.match(/\s/)?this.$t("validate_user_name_no_space"):!(t.length<4||t.length>12)||this.$t("validate_user_name_length",[4,12]):this.$t("field_required",[this.$t("account_nickname")])},validateUserDesc(t){return t?!(t.length>120)||this.$t("validate_user_desc_length",[120]):this.$t("field_required",[this.$t("description")])},validateUserAvatar(t){return!t||(t.match(/\s/)?this.$t("validate_url_no_space"):!!((t.startsWith("http://")||t.startsWith("https://"))&&t.length<2048)||this.$t("validate_user_avatar_url"))},validateUser(){return[this.validateUserName(this.profile.name),this.validateUserDesc(this.profile.description),this.validateUserAvatar(this.profile.avatar)]},updateAvatarState(t){this.avatarState=t},showEdit(){this.profile={name:this.userProfile.name,description:this.userProfile.description,avatar:this.userProfile.avatar},this.show=!0},submit(){if(1!==this.avatarState&&this.profile.avatar)return this.$alphabiz.dialog({title:this.$t("validate_error"),message:"Url "+this.$t("error"),ok:this.$t("ok")});const t=this.validateUser().filter((t=>!0!==t));if(t.length)return this.$alphabiz.dialog({title:this.$t("validate_error"),message:t.join("; "),ok:this.$t("ok")});sa["a"].changeProfile(this.profile).then((t=>{console.log("change profile result:",t),this.show=!1,this.$alphabiz.dialog({title:this.$t("edit_user_profile"),message:this.$t("success"),ok:this.$t("ok")})}))}}},ga=_a,ba=(a("3565"),Object(p["a"])(ga,ha,pa,!1,null,"7584d8a8",null)),fa=ba.exports;Q()(ba,"components",{QBtn:W["a"],QDialog:qt["a"],QCard:Lt["a"],QCardSection:jt["a"],QSeparator:he["a"],QInput:K["a"],QCardActions:Be["a"]}),Q()(ba,"directives",{ClosePopup:zt["a"]});var va={name:"SettingLibraryKey",components:{SettingFragment:_,BlockList:ua,EditProfile:fa},i18n:ea,data(){return{currentLoading:null}}},ya=va,$a=(a("37d7"),Object(p["a"])(ya,Ze,Ye,!1,null,"b7e4ad50",null)),wa=$a.exports,Ca={name:"AccountSettings.vue",components:{OptionalInformation:R,VerificationFields:st,OAuthManager:te,Security:Ht,Keychain:Ge,LibraryKey:wa},data(){return{showUserEdit:!1,loading:!1}},mounted(){this.$route.query.call&&this.invite()},watch:{"$route.query.call"(t){t&&this.invite()}},methods:{setLoading(t){this.loading=t},invite(){if(this.loading)return;const t=this.$refs.invitation;t.invite().then((()=>{this.$router.push({path:this.$route.path,query:{}})}))}}},qa=Ca,ka=(a("a404"),a("9989")),xa=a("4983"),Sa=Object(p["a"])(qa,n,s,!1,null,null,null);e["default"]=Sa.exports;Q()(Sa,"components",{QPage:ka["a"],QScrollArea:xa["a"],QBtn:W["a"],QDialog:qt["a"]})},3565:function(t,e,a){"use strict";a("e739")},"37d7":function(t,e,a){"use strict";a("e3c8")},"45a0":function(t,e,a){"use strict";a("09dd")},"464b":function(t,e,a){},"4f41":function(t,e,a){"use strict";a("8f9c")},"4f7a":function(t,e,a){"use strict";a("9312")},8771:function(t,e,a){},"8f9c":function(t,e,a){},9312:function(t,e,a){},a2be:function(t,e,a){"use strict";a("8771")},a404:function(t,e,a){"use strict";a("464b")},a9f3:function(t,e,a){},bbd9:function(t,e,a){},bfbe:function(t,e,a){},c69f:function(t,e,a){"use strict";a("bbd9")},d226:function(t,e,a){},d22a:function(t,e,a){"use strict";a("e015")},dc22:function(t,e,a){"use strict";a("298f")},dfd9:function(t,e,a){"use strict";a("a9f3")},e015:function(t,e,a){},e3c8:function(t,e,a){},e6b8:function(t,e,a){"use strict";a("ee7f")},e739:function(t,e,a){},ee7f:function(t,e,a){},ef28:function(t,e,a){"use strict";a("bfbe")}}]);