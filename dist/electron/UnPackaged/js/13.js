(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[13],{2673:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-page",[a("input",{ref:"fileSelector",staticStyle:{display:"none"},attrs:{type:"file",name:"file"},on:{change:t.onFileChange}}),a("div",{staticClass:"container full-width"},[a("div",{staticClass:"sticky-bar q-py-sm bg-page text-page q-header--bordered"},[a("q-toolbar",{staticClass:"sticky-bar-toolbar",staticStyle:{"min-height":"unset"}},[a("span",[t._v("\n          "+t._s(t.$t("web_mode_hint"))+"\n          "),a("a",{staticClass:"doc-link",attrs:{href:"https://alpha.biz",target:"_blank"}},[t._v("\n            "+t._s(t.$t("go_to"))+" alpha.biz\n            "),a("q-icon",{attrs:{name:"open_in_new"}})],1)])])],1),a("div",{staticClass:"task-container"},[t.task.magnetURI||t.task.origin||t.task.isSeeding?a("CardItem",{attrs:{torrent:t.task},on:{pauseTorrent:t.pauseTorrent,resumeTorrent:t.resumeTorrent,deleteTorrent:t.deleteTorrent,play:t.play,showPaymentPannel:t.showPaymentPannel,showDetail:t.showDetail,showAbPanel:t.showAbPanel,showPostInfo:t.showPostInfo,showQuickStart:t.showQuickStart,saveFile:t.saveFile,saveZip:t.saveZip}}):a("div",{staticClass:"no-task"},[a("div",{staticClass:"add-hints"},[t._v("\n          "+t._s(t.$t("web_mode_task_hint"))+"\n        ")]),a("q-btn",{staticClass:"add-button",attrs:{color:"primary",icon:"add",size:"lg"},on:{click:t.showDownload}},[a("q-tooltip",[t._v(t._s(t.$t("download")))])],1),a("q-btn",{staticClass:"add-button q-ml-md",attrs:{color:"primary",icon:"cloud_upload",size:"lg"},on:{click:t.showUpload}},[a("q-tooltip",[t._v(t._s(t.$t("upload")))])],1)],1)],1)]),a("q-dialog",{model:{value:t.showInput,callback:function(e){t.showInput=e},expression:"showInput"}},[a("q-card",{staticClass:"url-input"},[a("q-card-section",[a("div",{staticClass:"text-h6"},[t._v(t._s(t.$t("download")))]),a("q-input",{attrs:{type:"text",label:"Task URL"},nativeOn:{paste:function(t){t.stopPropagation()}},model:{value:t.taskUrl,callback:function(e){t.taskUrl=e},expression:"taskUrl"}})],1),a("q-card-actions",{attrs:{align:"right"}},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Cancel",color:"primary"}}),a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{color:"primary",icon:"add",label:t.$t("add")},on:{click:t.addTask}})],1)],1)],1),a("q-dialog",{staticClass:"channel-post",attrs:{position:t.screen$xs?"bottom":"standard","content-class":"fullscreen-dialog"},model:{value:t.showChannelPost,callback:function(e){t.showChannelPost=e},expression:"showChannelPost"}},[t.channelPost?a("PostCard",{attrs:{post:t.channelPost,followable:t.channelFollowable,hideButtons:""},on:{"to-channel":t.toChannelPage}}):t._e()],1),a("TableListDetail",{attrs:{show:t.showTaskDetail,torrent:t.task,paymentSize:10},on:{close:t.hideDetail}}),a("AlphabizPanel",{attrs:{show:t.showAlphabizPanel,torrent:t.task,paymentSize:10},on:{close:t.hideAbPanel}}),a("QuickStart",{attrs:{show:t.showQuickStartDialog,preset:t.task},on:{input:t.hideQuickStartDialog}})],1)},o=[],n=(a("498a"),a("5319"),a("a79d"),a("ddb0"),a("849b")),i=a("1ffc"),l=a("d491"),r=a("9e90"),c=a("34f8"),h=a("20fc"),d=(a("2b3d"),a("9861"),a("a32b")),p=a("c4e3"),u=a.n(p);const w=(t,e)=>{const a=URL.createObjectURL(e),s=document.createElement("a");s.href=a,s.download=t,document.body.appendChild(s),s.click(),setTimeout((()=>{URL.revokeObjectURL(a),s.remove()}),3e4)};async function m(t){return new Promise((e=>{t.getBlob(((a,s)=>{if(a)throw a;w(t.name,s),e()}))}))}async function f(t){if(!t.done)return;const e=Object(d["basename"])(t.name,Object(d["extname"])(t.name))+".zip",a=new u.a,s=t.files;await Promise.all(s.map((t=>new Promise(((e,s)=>{t.getBlob(((o,n)=>{if(o)return s(o);a.file(t.path,n),e()}))}))))),s.length>1&&a.folder(t.postTitle||t.name);const o=await a.generateAsync({type:"blob"});return w(e,o)}var k=a("ac4e"),g=a("b4ab"),b=a("4aad"),y=a("2de9"),$=a("708e"),P=a("f71e"),v={components:{CardItem:i["a"],TableListDetail:l["a"],AlphabizPanel:r["a"],QuickStart:g["a"],PostCard:y["a"]},name:"Downloader",data(){return{locked:!1,showInput:!1,showTaskDetail:!1,showAlphabizPanel:!1,showQuickStartDialog:!1,showChannelPost:!1,channelPost:null,taskUrl:"",task:{}}},computed:{isReady(){return this.task.name&&this.task.length},displayName(){return this.task.postTitle?this.task.postTitle:this.task.name?this.task.name:this.$t("loading")},taskAction(){return this.task.paused?this.task.done?this.$t("upload"):this.$t("resume"):this.task.isSeeding?this.$t("stop_torrent"):this.$t("pause")},channelFollowable(){return!!this.channelPost&&!b["a"].followingChannels.some((t=>{var e;return t&&t.id===(null===(e=this.channelPost.channel)||void 0===e?void 0:e.id)}))}},methods:{async showDownload(){this.taskUrl="",this.showInput=!0,await this.$nextTick();const t=await Object(P["a"])();if(t&&"string"===typeof t){const e=t.trim();if([$["protocol"],$["shortProtocol"],"magnet"].some((t=>e.startsWith(t+":")))){const t=e.startsWith("magnet")?e:await Object(h["a"])(e);if(!t||!t.startsWith("magnet"))return;this.taskUrl=e}}},async showUpload(){this.$refs.fileSelector.click()},showDetail(){this.showTaskDetail=!0},hideDetail(){this.showTaskDetail=!1},switchState(){console.log("on switch state")},addTask(){n["a"].emit("wt-add",this.taskUrl)},deleteTorrent(){this.$q.dialog({title:this.$t("delete_task"),message:this.$t("delete_confirm_message"),cancel:{color:"primary",flat:!0,label:this.$t("not_now")},ok:{color:"red",flat:!0,label:this.$t("delete")}}).onOk((()=>{n["a"].emit("wt-delete",this.task.infoHash),this.task={}}))},pauseTorrent(){n["a"].emit("wt-pause",this.task.infoHash),this.task.paused=!0},resumeTorrent(){this.task&&this.task.magnetURI&&(this.task.paused=!1,n["a"].emit("wt-resume",this.task.infoHash))},play(t){console.log("onplay",t),Object(c["default"])(t)},showPaymentPannel(){},showAbPanel(){this.showAlphabizPanel=!0},hideAbPanel(){this.showAlphabizPanel=!1},async showPostInfo(t=""){if(console.log("show",t),!t||!t.includes("posts"))return this.$q.notify("Cannot find post");this.$q.loading.show();const e=t.replace(/\/posts\/([^/]+$)/,""),a=e.split("/").filter((t=>t)).pop(),s=t.split("/").filter((t=>t)).pop();let o=!1;setTimeout((()=>{o||(o=!0,this.$q.loading.hide(),this.$q.dialog({title:this.$t("error"),message:this.$t("cannot_get_channel_info"),ok:this.$t("ok")}))}),5e3);const n=await b["a"].getPostById(a,s,!0);if(console.log("show post",n),o)return;const i=await b["a"].getChannelById(a);if(console.log("show post channel",i),!o){if(o=!0,!n)return this.$q.loading.hide(),void this.$q.dialog({title:"Not Found",message:"Cannot found post info"});n.channel=i,this.channelPost=n,this.$q.loading.hide(),this.showChannelPost=!0}},toChannelPage(t){console.log("to",t);const e=["id","title"].map((e=>{const a=t[e];return encodeURIComponent(e)+"="+encodeURIComponent(a)})).join("&");this.$router.push(`/library/channel?${e}`),setTimeout((()=>{this.$root.$emit("navigate-to",`/library/channel?${e}`)}),200)},onFileChange(t){const e=t.target;e&&e.files&&e.files.length&&(console.log("To upload",e.files[0]),n["a"].emit("wt-add",e.files[0])),e.value=null},showQuickStart(){this.showQuickStartDialog=!0},hideQuickStartDialog(){this.showQuickStartDialog=!1},saveFile(t){const e=k["wtClient"].torrents[0];if(!e||!e.files)return;const a=e.files.find((e=>e.path===t.path))||e.files.find((e=>e.name===t.name));if(!a)return;const s=this.$q.dialog({title:this.$t("creating_save_file"),persistent:!0,ok:!1});setTimeout((()=>{m(a).catch((t=>{console.error(t),t.message&&this.$q.notify(t.message)})).finally((()=>s.hide()))}))},saveZip(){const t=this.$q.dialog({message:this.$t("creating_save_file"),persistent:!0,ok:!1});setTimeout((()=>{f(k["wtClient"].torrents[0]).catch((t=>{console.error(t),t.message&&this.$q.notify(t.message)})).finally((()=>t.hide()))}))}},created(){console.log("[wt] created"),n["a"].on("weberror",((...t)=>this.$q.notify(...t))),n["a"].on("wt-task",(t=>{this.task=Array.isArray(t)?t[0]:t}))}},C=v,_=(a("c094"),a("2877")),q=a("9989"),T=a("e359"),Q=a("65c6"),D=a("0016"),S=a("9c40"),I=a("05c0"),U=a("24e8"),A=a("f09f"),z=a("a370"),x=a("27f9"),O=a("4b7e"),R=a("7f67"),j=a("eebe"),F=a.n(j),L=Object(_["a"])(C,s,o,!1,null,"1f33e3d4",null);e["default"]=L.exports;F()(L,"components",{QPage:q["a"],QHeader:T["a"],QToolbar:Q["a"],QIcon:D["a"],QBtn:S["a"],QTooltip:I["a"],QDialog:U["a"],QCard:A["a"],QCardSection:z["a"],QInput:x["a"],QCardActions:O["a"]}),F()(L,"directives",{ClosePopup:R["a"]})},3626:function(t,e,a){},c094:function(t,e,a){"use strict";a("3626")}}]);