(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[6],{"14ff":function(t,e,o){},"364e":function(t,e,o){},"5e15":function(t,e,o){"use strict";o.r(e);var s=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("q-page",[o("div",{staticClass:"container full-width"},[o("div",{staticClass:"sticky-bar q-py-sm bg-page text-page q-header--bordered"},[o("q-toolbar",{staticClass:"sticky-bar-toolbar"},[t._l([{tabName:"downloading",label:"start_all",color:"primary",disable:t.isAllStarted,handleClick:t.downloadAll},{tabName:"downloading",label:"pause_all",color:"general",disable:t.isAllPaused,handleClick:t.requestPauseAllDownloading},{tabName:"downloading",label:"remove_all",color:"negative",disable:0===t.currentList.length,handleClick:t.removeAllDownloading},{tabName:"uploading",label:"pause_all",color:"general",disable:t.isAllPaused,handleClick:t.pauseAllUploading},{tabName:"uploading",label:"remove_all",color:"negative",disable:0===t.currentList.length,handleClick:t.removeAllUploading},{tabName:"downloaded",label:"clear_history",color:"general",disable:0===t.currentList.length,handleClick:t.clearAll}],(function(e,s){return o("alphabiz-button",{directives:[{name:"show",rawName:"v-show",value:t.currentTab===e.tabName,expression:"currentTab === buttonData.tabName"}],key:s,style:"negative"===e.color?{marginLeft:"16px"}:{},attrs:{color:e.color,icon:e.icon,label:t.$t(e.label),value:e.disable,dense:t.screen$xs},on:{click:function(o){return t.ensureLogin(e.handleClick)}}})})),o("q-space"),o("div",{staticClass:"right-buttons"},[o("q-space"),o("alphabiz-button",{directives:[{name:"show",rawName:"v-show",value:!(t.showSearchText||t.searchText.length),expression:"!(showSearchText || searchText.length)"}],attrs:{"button-type":"icon",icon:"search"},on:{click:function(e){return t.toggleSearchText(!0)}}}),o("q-input",{directives:[{name:"show",rawName:"v-show",value:t.showSearchText||t.searchText.length,expression:"showSearchText || searchText.length"}],ref:"searchInput",attrs:{outlined:"",dense:"",type:"text",debounce:"300"},on:{blur:function(e){return t.toggleSearchText(!1)}},nativeOn:{paste:function(t){t.stopPropagation()}},scopedSlots:t._u([{key:"append",fn:function(){return[o("q-icon",{staticClass:"cursor-pointer text-red",attrs:{name:"close"},on:{click:t.clearSearch}})]},proxy:!0}]),model:{value:t.searchText,callback:function(e){t.searchText=e},expression:"searchText"}}),o("alphabiz-button",{attrs:{"button-type":"icon",icon:"list"===t.listMode?"view_list":"view_agenda"},on:{click:t.changeListMode}},[o("q-tooltip",[t._v(t._s(t.$t("toggle_list_mode")))])],1),o("SortMenu",{on:{changeSortSequence:t.changeSortSequence,changeSortOption:t.changeSortOption}})],1)],2),"downloading"===t.currentTab?o("q-toolbar",{staticClass:"sticky-bar-toolbar",staticStyle:{"min-height":"unset"}},[o("q-linear-progress",{staticStyle:{"flex-shrink":"1","max-width":"calc(100% - 110px)"},attrs:{value:t.downloadingProgress.value,rounded:"",size:"20px"}},[o("div",{staticClass:"absolute-full flex flex-center text-general"},[o("span",{staticStyle:{"font-size":"0.9rem"}},[t._v(t._s(t.downloadingProgress.label))])])]),o("div",{staticClass:"download-speed"},[t._v(t._s(t.totalDownloadSpeed))])],1):t._e(),"uploading"===t.currentTab?o("q-toolbar",{staticClass:"sticky-bar-toolbar",staticStyle:{"min-height":"unset"}},[o("div",[t._v(t._s(t.totalIncomeInfo))]),o("q-space"),o("div",[t._v(t._s(t.$t("total_upload_speed"))+": "+t._s(t.totalUploadSpeed))])],1):t._e()],1),o("q-tab-panels",{staticClass:"torrent-list bg-transparent",class:{"torrent-list-large":"downloaded"!==t.currentTab},model:{value:t.displayTab,callback:function(e){t.displayTab=e},expression:"displayTab"}},t._l(t.displayList,(function(e){return o("q-tab-panel",{key:"panel_"+e.label,staticClass:"q-pa-none",attrs:{name:e.key}},[o(t.listComponent,{key:"task-list-"+e.label,tag:"component",attrs:{list:e,tab:t.currentTab,incomes:t.incomes,noDataMessage:t.noDataMessage},on:{pauseTorrent:t.pauseTorrent,resumeTorrent:t.resumeTorrent,deleteTorrent:t.deleteTorrent,play:t.play,showOriginTorrent:t.showOriginTorrent,showDirectory:t.showDirectory,setThrottleGroup:t.setThrottleGroup,shareFile:t.shareFile,saveTorrentFile:t.saveTorrentFile,showPaymentPannel:t.showPaymentPannel,showDetail:t.showDetail,showAbPanel:t.showAbPanel,showPostInfo:t.showPostInfo,showQuickStart:t.showQuickStart}})],1)})),1),o("q-page-sticky",{staticClass:"action-container",attrs:{position:"bottom-right",offset:[16,16]}},t._l({download:{tabName:"downloading",icon:"add",handleClick:function(){return t.showMagnetDialog("download")}},upload:{tabName:"uploading",icon:"cloud_upload",handleClick:function(){return t.showMagnetDialog("upload")}},upload_all:{tabName:"downloaded",icon:"cloud_upload",handleClick:t.uploadAll}},(function(e,s){return o("alphabiz-button",{directives:[{name:"show",rawName:"v-show",value:t.currentTab===e.tabName,expression:"currentTab === buttonData.tabName"}],key:s,staticClass:"q-ma-xs action-button",attrs:{color:"primary",icon:e.icon,label:t.$t(s),"button-type":"fab"},on:{click:function(o){return t.ensureLogin(e.handleClick)}}})})),1)],1),o("q-dialog",{staticClass:"channel-post",attrs:{position:t.screen$xs?"bottom":"standard","content-class":"fullscreen-dialog"},model:{value:t.showChannelPost,callback:function(e){t.showChannelPost=e},expression:"showChannelPost"}},[t.channelPost?o("PostCard",{attrs:{post:t.channelPost,followable:t.channelFollowable,hideButtons:""},on:{"to-channel":t.toChannelPage}}):t._e()],1),o("TorrentPayment",t._b({attrs:{show:t.showPayment,dp$source:t.dp$source,autoRenew:t.autoRenew},on:{change:function(e){return t.showPayment=e},createPayment:t.createPayment,setAutoRenew:t.setAutoRenew}},"TorrentPayment",t.paymentData,!1)),o("TableListDetail",{attrs:{show:t.showTorrentDetail,torrent:t.torrentDetail},on:{close:t.hideDetail,showDirectory:t.showDirectory,showPaymentPannel:t.showPaymentPannel,play:t.play,shareFile:t.shareFile}}),o("AlphabizPanel",{attrs:{dp$source:t.dp$source,show:t.showAlphabizPanel,torrent:t.alphabizTorrent,paymentSize:t.paymentSize},on:{close:t.hideAbPanel,createPayment:t.createPayment,setAutoRenew:t.setAutoRenew}}),o("QuickStart",{attrs:{show:t.showQuickStartDialog,preset:t.quickStartTask},on:{input:t.hideQuickStartDialog}})],1)},i=[],n=(o("5319"),o("ddb0"),o("e9c4"),o("9b0f")),a=o.n(n),r=o("a32b"),l=o.n(r),h=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("q-virtual-scroll",{key:"torrent-list-"+t.list.label,ref:"listIns",class:[t.screen$xs?"q-pt-sm":"q-pt-md",t.isPortrait?"portrait":"landscape"],style:"max-height:"+t.viewHeight,attrs:{items:t.list.list,"virtual-scroll-item-size":178},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.item;return[o("q-item",{key:t.list.label+"-"+s.infoHash,staticClass:"fit",class:[t.screen$xs?"q-px-sm":"q-px-md"],attrs:{dense:""}},[o("card-item",{attrs:{torrent:s,highlight:s.infoHash&&s.infoHash===t.highlightItem.infoHash},on:{pauseTorrent:t.emitEvent["pauseTorrent"],resumeTorrent:t.emitEvent["resumeTorrent"],deleteTorrent:t.emitEvent["deleteTorrent"],play:t.emitEvent["play"],showOriginTorrent:t.emitEvent["showOriginTorrent"],showDirectory:t.emitEvent["showDirectory"],setThrottleGroup:t.emitEvent["setThrottleGroup"],saveTorrentFile:t.emitEvent["saveTorrentFile"],showPaymentPannel:t.emitEvent["showPaymentPannel"],showDetail:t.emitEvent["showDetail"],showAbPanel:t.emitEvent["showAbPanel"],showPostInfo:t.emitEvent["showPostInfo"],showQuickStart:t.emitEvent["showQuickStart"],saveFile:t.emitEvent["shareFile"]}})],1)]}},{key:"after",fn:function(){return[t.list.list.length?t._e():o("div",{staticClass:"full-width text-center text-subtitle1"},[o("q-icon",{attrs:{name:"help_outline"}}),t._v("\n      "+t._s(t.noDataMessage)+"\n    ")],1),o("div",{directives:[{name:"show",rawName:"v-show",value:t.list.list.length,expression:"list.list.length"}],staticClass:"q-py-xl"})]},proxy:!0}])})},c=[],d=o("ed08"),u=o("c428"),p=o("1ffc"),m={name:"CardList",props:{list:Object,noDataMessage:String},data(){const t=this;return{isElectron:Object(d["isElectron"])(),safeArea:"env(safe-area-inset-bottom) - env(safe-area-inset-top)",emitEvent:new Proxy({},{get(e,o){return(...e)=>{t.$emit(o,...e)}}}),highlightItem:{}}},computed:{viewHeight(){const t=(this.list.key.startsWith("downloaded")?150:180)+(this.isPortrait||this.isElectron?0:-30);return`calc(100vh - ${this.safeArea} - ${t}px);`}},components:{CardItem:p["a"]},methods:{findTaskIndex(t,e){for(const o in this.list.list){const s=this.list.list[o];if(e&&s.fromPost===e)return console.log("found item by soul",e),parseInt(o);if(Object(u["a"])(s.alphabizURI)===t)return console.log("found",t,s.alphabizURI,o),parseInt(o)}return-1}},activated(){if(this.highlightItem={infoHash:-1},this.$route.query&&this.$route.query.abKey){const t=Date.now(),e=setInterval((()=>{if(!this.$route.path.startsWith("/downloader"))return clearInterval(e),console.log("User exit before loaded");if(this.$refs.listIns){var o;if(Date.now()-t<1e3)return;clearInterval(e);const s=null===(o=this.$route.query.abKey)||void 0===o?void 0:o.replace(/\s/g,"+"),i=this.findTaskIndex(s,this.$route.query.soul);if(-1===i)return console.log("Cannot find abKey",s);const n=this.list.list[i];console.log("scroll to",i,n),this.highlightItem=n,this.$refs.listIns.scrollTo(i,"center"),clearInterval(e),setTimeout((()=>{this.highlightItem===n&&(this.highlightItem={infoHash:-1})}),2500)}}),200)}}},g=m,f=(o("c48e"),o("2877")),b=o("a12b"),w=o("66e5"),v=o("0016"),y=o("eebe"),_=o.n(y),T=Object(f["a"])(g,h,c,!1,null,"0dd405a4",null),$=T.exports;_()(T,"components",{QVirtualScroll:b["a"],QItem:w["a"],QIcon:v["a"]});var S=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("q-table",{ref:"tableIns",staticClass:"list bg-page text-page",class:{xs:t.isPortrait,electron:t.isElectron},attrs:{data:t.list.list,columns:t.columns,"row-key":"name",dense:"",flat:"","virtual-scroll":"","hide-bottom":!!t.list.list.length,"rows-per-page-options":[0],"visible-columns":t.visibleColumns,"no-data-label":t.noDataMessage},nativeOn:{mousemove:function(e){return t.onDrag(e)},touchmove:function(e){return t.onDrag(e)},mouseleave:function(e){return t.onDragEnd.apply(null,arguments)},mouseup:function(e){return t.onDragEnd.apply(null,arguments)},touchend:function(e){return t.onDragEnd.apply(null,arguments)},touchcancel:function(e){return t.onDragEnd.apply(null,arguments)}},scopedSlots:t._u([{key:"header",fn:function(e){return[o("q-tr",{attrs:{props:e}},t._l(e.cols,(function(s){return o("q-th",{key:s.name,staticClass:"thead",attrs:{props:e}},[o("span",{staticClass:"text-ellipsis"},[t._v(t._s(s.label))]),"options"!==s.name?o("span",{staticClass:"thead-draggable",on:{mousedown:function(e){return t.onDragStart(s,e)},mouseup:t.onDragEnd,touchstart:function(e){return t.onDragStart(s,e)},touchmove:function(e){return t.onDrag(e)},touchend:t.onDragEnd,touchcancel:t.onDragEnd}}):t._e()])})),1)]}},{key:"body",fn:function(e){return[o("ListItem",{key:e.row.infoHash,attrs:{torrent:e.row,visibleColumns:t.visibleColumns,showCols:t.showCols,incomes:t.taskIncomes[e.row.infoHash],colWidth:t.colWidthText,highlight:e.row.infoHash&&e.row.infoHash===t.highlightItem.infoHash},on:{pauseTorrent:t.emitEvent["pauseTorrent"],resumeTorrent:t.emitEvent["resumeTorrent"],deleteTorrent:t.emitEvent["deleteTorrent"],play:t.emitEvent["play"],showOriginTorrent:t.emitEvent["showOriginTorrent"],showDirectory:t.emitEvent["showDirectory"],setThrottleGroup:t.emitEvent["setThrottleGroup"],saveTorrentFile:t.emitEvent["saveTorrentFile"],showPaymentPannel:t.emitEvent["showPaymentPannel"],showDetail:t.emitEvent["showDetail"],showAbPanel:t.emitEvent["showAbPanel"],showPostInfo:t.emitEvent["showPostInfo"],showQuickStart:t.emitEvent["showQuickStart"]}})]}},{key:"bottom-row",fn:function(){return[o("div",{directives:[{name:"show",rawName:"v-show",value:t.list.list.length,expression:"list.list.length"}],staticClass:"q-py-xl"})]},proxy:!0},{key:"no-data",fn:function(){return[o("div",{staticClass:"full-width text-center text-subtitle1"},[o("q-icon",{attrs:{name:"help_outline"}}),t._v("\n      "+t._s(t.noDataMessage)+"\n    ")],1)]},proxy:!0}])})},k=[],I=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("q-tr",{key:t.torrent.infoHash||t.torrent.origin,staticClass:"list-item-tr",class:{highlight:t.highlight}},[o("q-td",{key:"name",staticClass:"no-select task-name",style:t.colWidth.name,on:{dblclick:t.onDoubleClick}},[o("IconWithTooltip",t._b({staticClass:"q-mr-xs name-icon"},"IconWithTooltip",t.taskIcon,!1)),o("div",{staticClass:"name-info"},[o("span",{staticClass:"torrent-name",attrs:{title:t.displayName}},[t._v(t._s(t.displayName))]),o("br"),t._m(0),o("span",{staticClass:"text-grey"},[t._v(t._s(t.downloadStatus))])],1)],1),o("q-td",{directives:[{name:"show",rawName:"v-show",value:t.showCols["remaining"],expression:"showCols['remaining']"}],key:"remaining",style:t.colWidth.remaining},[t._v(t._s(t.remaining))]),o("q-td",{directives:[{name:"show",rawName:"v-show",value:t.showCols["completedTime"],expression:"showCols['completedTime']"}],key:"completedTime",style:t.colWidth.completedTime},[t._v(t._s(t.completedTime))]),o("q-td",{directives:[{name:"show",rawName:"v-show",value:t.showCols["progress"],expression:"showCols['progress']"}],key:"progress",style:t.colWidth.progress},[o("q-linear-progress",{attrs:{value:t.torrent.progress,size:"20px",rounded:""}},[o("div",{staticClass:"absolute-full flex flex-center text-general"},[o("span",{staticStyle:{"font-size":"0.9rem"}},[t._v(t._s(t.progress||"0%"))])])])],1),o("q-td",{directives:[{name:"show",rawName:"v-show",value:t.showCols["uploadSpeed"],expression:"showCols['uploadSpeed']"}],key:"uploadSpeed",style:t.colWidth.uploadSpeed},[t._v(t._s(t.uploadSpeed))]),o("q-td",{directives:[{name:"show",rawName:"v-show",value:t.showCols["downloadSpeed"],expression:"showCols['downloadSpeed']"}],key:"downloadSpeed",staticClass:"download-speed",style:t.colWidth.downloadSpeed},[o("span",{attrs:{title:t.downloadSpeed}},[t._v(t._s(t.downloadSpeed))]),o("q-btn",{directives:[{name:"show",rawName:"v-show",value:t.showAbButton,expression:"showAbButton"}],staticClass:"text-primary float-right",attrs:{flat:"",dense:"",size:"sm"},on:{click:t.openAbPanel}},[o("IconWithTooltip",{attrs:{icon:t.isPayed?"flash_auto":"flash_on",tooltip:t.isPayed?t.$t("alphabiz_accelerating"):t.$t("ab_peer_available")}})],1)],1),o("q-td",{directives:[{name:"show",rawName:"v-show",value:t.showCols["incomeInfo"],expression:"showCols['incomeInfo']"}],key:"incomeInfo",staticClass:"text-right",style:t.colWidth.incomeInfo},[t._v(t._s(t.incomeInfo))]),o("q-td",{directives:[{name:"show",rawName:"v-show",value:t.visibleColumns.includes("options"),expression:"visibleColumns.includes('options')"}],key:"options",staticClass:"option-btns",style:t.colWidth.options,attrs:{"auto-width":""}},[o("q-btn",{directives:[{name:"show",rawName:"v-show",value:!t.torrent.isAutoUpload&&!t.torrent.missFile,expression:"!torrent.isAutoUpload && !torrent.missFile"}],attrs:{flat:"",dense:"",size:"sm",disable:t.locked||t.isProcessingUpload},on:{click:t.toggleStatus}},[o("IconWithTooltip",{attrs:{icon:t.actionIcon,tooltip:t.taskAction,clickable:""}})],1),o("q-btn",{attrs:{flat:"",dense:"",size:"sm"},on:{click:t.onDoubleClick}},[o("IconWithTooltip",{attrs:{icon:t.playable?"smart_display":"file_open",tooltip:t.$t("open_file"),clickable:""}})],1),t._m(1),o("q-btn",{directives:[{name:"show",rawName:"v-show",value:t.torrent.fromPost,expression:"torrent.fromPost"}],attrs:{flat:"",dense:"",size:"sm"},on:{click:t.showPostInfo}},[o("IconWithTooltip",{attrs:{icon:"video_library",tooltip:t.$t("library"),clickable:""}})],1),o("q-btn",{directives:[{name:"show",rawName:"v-show",value:(1===t.torrent.progress||t.torrent.upload)&&!t.torrent.paused,expression:"(torrent.progress === 1 || torrent.upload) && !torrent.paused"}],attrs:{flat:"",dense:"",size:"sm",disabled:t.isProcessingUpload},on:{click:t.showQuickStart}},[o("IconWithTooltip",{attrs:{icon:"present_to_all",tooltip:t.$t("share_to_library"),clickable:""}})],1),t._m(2),o("q-btn",{staticClass:"text-red",attrs:{flat:"",dense:"",size:"sm",disabled:t.isProcessingUpload},on:{click:t.deleteTorrent}},[o("IconWithTooltip",{attrs:{icon:"close",tooltip:t.$t("delete"),clickable:""}})],1)],1)],1)},x=[function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("IconWithTooltip",{directives:[{name:"show",rawName:"v-show",value:t.torrent.isAutoUpload,expression:"torrent.isAutoUpload"}],staticClass:"q-mr-xs text-primary",attrs:{tooltip:t.$t("auto_uploading"),icon:"cloud_upload"}})},function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("q-btn",{attrs:{flat:"",dense:"",size:"sm"},on:{click:t.showDirectory}},[o("IconWithTooltip",{attrs:{icon:"folder",tooltip:t.$t("open_directory"),clickable:""}})],1)},function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("q-btn",{attrs:{flat:"",dense:"",size:"sm"},on:{click:t.showDetail}},[o("IconWithTooltip",{attrs:{icon:"more_horiz",tooltip:t.$t("more"),clickable:""}})],1)}],q=o("f880"),C=o("0613"),P=o("51d9"),D=o("307e"),O=o("0967"),H={name:"ListItem",props:{torrent:{type:Object,required:!0},visibleColumns:{type:Array,required:!0},showCols:{type:Object,required:!0},incomes:{type:Object,default:()=>({})},colWidth:{type:Object,default:()=>({})},highlight:Boolean},inject:["io"],components:{IconWithTooltip:P["a"]},data(){return{locked:!1}},computed:{isDevMode(){return C["a"].getters.isDevMode},isProcessingUpload(){return!(!this.torrent.isSeeding&&!this.torrent.done||this.torrent.length)},displayName(){const t=this.torrent.postTitle||this.torrent.name||this.torrent.origin||this.torrent.token;if(!t)return"";if(t.includes("&dn")){const e=(t+"&").match(/&dn=(.*?)&/);if(e&&e[1])return e[1]}const e=t.match(/btih:([^&]*)/);if(e&&e[1])return e[1];const o=O["b"].is.win;if(t.includes(o)){const e=t.replace(new RegExp(o+"$"),"").match(new RegExp(`([^${o}]*$)`));if(e&&e[1])return e[1]}return t},isReady(){return this.torrent&&this.torrent.name&&this.torrent.ready},taskIcon(){const t=this.torrent,e=t.files?t.files:[],o=Object(q["c"])(e.map((t=>t.path||t)));return{icon:o.icon,tooltip:this.$t(o.tooltip)}},downloadStatus(){if(this.torrent.missFile)return this.$t("miss_file");if(this.torrent.isSeeding||this.torrent.done){if(!this.torrent.length){if(this.torrent.verifyStatus){const{current:t,total:e}=this.torrent.verifyStatus,o=t/e,s=Object(q["f"])(o);if(!isNaN(o))return this.$t("loading")+` (${s})`}return this.$t("loading")}return Object(q["a"])(this.torrent.length)}return this.isReady||this.torrent.paused||this.torrent.length?this.torrent.done||this.torrent.downloaded===this.torrent.length?Object(q["a"])(this.torrent.length):`${Object(q["a"])(this.torrent.downloaded)}/${Object(q["a"])(this.torrent.length)}`:"-"},remaining(){return this.torrent.paused||this.torrent.pending?"-":Object(q["d"])(this.torrent.timeRemaining)},completedTime(){const t=(...t)=>this.$t(...t);return this.torrent.completedTime?Object(q["e"])(this.torrent.completedTime,t,null===this||void 0===this?void 0:this.$i18n.locale):Object(q["e"])(this.torrent.createdTime,t,null===this||void 0===this?void 0:this.$i18n.locale)},progress(){return Object(q["f"])(this.torrent.progress)},downloadSpeed(){if(this.torrent.paused)return this.$t("paused");if(this.torrent.pending)return this.$t("pending");if(!this.torrent.ready){if(!this.torrent.hasMetadata)return this.$t("loading");if(this.torrent.waiting)return this.$t("waiting_for_verify");if(this.torrent.verifyStatus){const{current:t,total:e}=this.torrent.verifyStatus,o=t/e,s=Object(q["f"])(o);if(!isNaN(o))return this.$t("verifying")+` (${s})`}return this.$t("verifying")}return Object(q["a"])(this.torrent.downloadSpeed,{byte:!1,gb:!1,fix:1})+"/s"},incomeInfo(){return[Number(((this.incomes.today||0)/1e3).toFixed(3)),Number(((this.incomes.total||0)/1e3).toFixed(3))].join(" / ")},uploadSpeed(){return this.torrent.ready?Object(q["a"])(this.torrent.uploadSpeed,{byte:!1,gb:!1,fix:1})+"/s":"-/s"},taskAction(){return this.torrent.paused?this.torrent.done||this.torrent.isSeeding?this.$t("seed"):this.$t("resume"):this.torrent.isSeeding?this.$t("stop_torrent"):this.$t("pause")},actionIcon(){return this.torrent.paused?this.torrent.done||this.torrent.isSeeding?"cloud_upload":"play_arrow":this.torrent.isSeeding?"stop":"pause"},playableFiles(){var t;return(null===(t=this.torrent.files)||void 0===t?void 0:t.filter((t=>Object(D["a"])(t.name))))||[]},playable(){return this.playableFiles.length},abPeers(){return this.torrent.connections?this.torrent.connections.filter((t=>!(!this.torrent.hasMetadata&&!t.hasMeta)&&(!!t.hasResource&&(t.isAbPeer&&t.subId&&t.subId!==C["a"].getters.accountUserInfo.sub)))):[]},showAbButton(){return this.isDevMode&&this.abPeers.length},isPayed(){return this.abPeers.some((t=>"high"===t.remoteGroup))}},methods:{shouldShow(t){return this.visibleColumns.includes(t)},onDoubleClick(){this.playable?this.$emit("play",this.playableFiles[0].path,this.torrent.infoHash):this.torrent.files&&this.torrent.files.length?this.openFile():this.$q.notify(this.$t("no_available_file"))},toggleStatus(){if(!this.locked)if(this.locked=!0,this.torrent.isSeeding?setTimeout((()=>{this.locked=!1}),2e3):setTimeout((()=>{this.locked=!1}),1e3),this.torrent.paused)this.$emit("resumeTorrent",this.torrent);else{if(!this.torrent.infoHash)return this.$q.dialog({message:this.$t("this_task_not_ready"),ok:{textColor:"red",color:"unset",flat:!0,label:this.$t("remove")},cancel:{textColor:"grey",color:"unset",flat:!0,label:this.$t("cancel")}}).onOk((()=>{this.io.emit("delete_torrent",this.torrent.token,!1)}));this.$emit("pauseTorrent",this.torrent.infoHash||this.torrent.token)}},deleteTorrent(){this.$emit("deleteTorrent",this.torrent)},openFile(){1===this.torrent.files.length?this.io.emit("open-external-file",this.torrent.files[0].path,this.torrent.infoHash):this.showDirectory()},showDirectory(){this.$emit("showDirectory",this.torrent)},showDetail(){this.$emit("showDetail",this.torrent)},showPostInfo(){this.$emit("showPostInfo",this.torrent.fromPost)},openAbPanel(){this.$emit("showAbPanel",this.torrent)},showQuickStart(){this.$emit("showQuickStart",this.torrent)}}},A=H,L=(o("755b"),o("bd08")),N=o("db86"),j=o("6b1d"),Q=o("9c40"),E=o("b498"),R=Object(f["a"])(A,I,x,!1,null,null,null),z=R.exports;_()(R,"components",{QTr:L["a"],QTd:N["a"],QLinearProgress:j["a"],QBtn:Q["a"],QColor:E["a"]});var F=o("e302"),W={name:"TableList",props:{list:{type:Object,required:!0},tab:{type:String,default:"downloading"},incomes:{type:Object,default:()=>({})},noDataMessage:{type:String,default:()=>""}},components:{ListItem:z},data(){const t=this;let e={name:250,remaining:80,completedTime:80,progress:120,downloadSpeed:150,uploadSpeed:100,incomeInfo:120,options:165};return localStorage.getItem("table-col-width")||localStorage.setItem("table-col-width",JSON.stringify(e)),e=JSON.parse(localStorage.getItem("table-col-width")),{isElectron:Object(d["isElectron"])(),emitEvent:new Proxy({},{get(e,o){return(...e)=>{t.$emit(o,...e)}}}),defaultColumns:{downloading:["name","remaining","progress","downloadSpeed","options"],uploading:["name","completedTime","uploadSpeed","incomeInfo","options"],downloaded:["name","completedTime","options"]},dragData:{start:!1,col:"",pageX:0,pageY:0},highlightItem:{},colWidth:e}},computed:{columns(){return[{name:"name",required:!0,label:this.$t("task_name"),align:"left",headerStyle:this.colWidthText.name+";padding-left: 48px; max-width: calc(100% - 48px);"},{name:"remaining",label:this.$t("remaining"),align:"left",headerStyle:this.colWidthText.remaining+"; max-width: calc(100% - 8px)"},{name:"completedTime",label:this.$t("completed_time"),align:"left",headerStyle:this.colWidthText.completedTime+"; max-width: calc(100% - 8px)"},{name:"progress",label:this.$t("progress"),align:"left",headerStyle:this.colWidthText.progress+"; max-width: calc(100% - 8px)"},{name:"downloadSpeed",label:this.$t("total_download_speed"),align:"left",headerStyle:this.colWidthText.downloadSpeed+"; max-width: calc(100% - 8px)"},{name:"uploadSpeed",label:this.$t("total_upload_speed"),align:"left",headerStyle:this.colWidthText.uploadSpeed+"; max-width: calc(100% - 8px)"},{name:"incomeInfo",label:this.$t("income_info"),align:"right",headerStyle:this.colWidthText.incomeInfo+"; max-width: calc(100% - 8px)"},{name:"options",label:this.$t("operations"),align:"left"}]},visibleColumns(){switch(this.tab){case"downloading":return this.defaultColumns.downloading;case"uploading":return 2!==this.$store.state.credits.isModuleInit?this.defaultColumns.uploading.filter((t=>"incomeInfo"!==t)):this.defaultColumns.uploading;case"downloaded":return this.defaultColumns.downloaded}return this.defaultColumns.downloading},showCols(){const t={};for(const e of this.visibleColumns)t[e]=!0;return t},colWidthText(){const t={};for(const e in this.colWidth){const o=this.colWidth[e];t[e]=`width: ${o}px; min-width: ${o}px; max-width: ${o}px;`}return t},tableList(){var t,e;return(null===(t=this.list)||void 0===t||null===(e=t.list)||void 0===e?void 0:e.map((t=>({name:t.name}))))||[]},taskIncomes(){const{todayTaskIncome:t,allTaskIncome:e}=this.incomes,o={};for(const s in e)o[s]||(o[s]={today:0,total:0}),o[s].total+=e[s],t[s]&&(o[s].today+=t[s]);return o}},methods:{onDragStart(t,e){this.dragData.pageX=e.pageX,this.dragData.pageY=e.pageY,this.dragData.start=!0,this.dragData.col=t.name,document.body.style.cursor="col-resize"},onDragEnd(){this.dragData.start&&(this.dragData.start=!1,document.body.style.cursor="",localStorage.setItem("table-col-width",JSON.stringify(this.colWidth)))},onDrag(t){if(!this.dragData.start)return;const e=this.dragData.pageX-t.pageX;this.dragData.pageX=t.pageX,this.colWidth[this.dragData.col]&&(this.colWidth[this.dragData.col]-=e,this.colWidth[this.dragData.col]<80&&(this.colWidth[this.dragData.col]=80))},onResize(){console.log("table resize"),this.$refs.tableIns.resetVirtualScroll()},findTaskIndex(t,e){for(const o in this.list.list){const s=this.list.list[o];if(e&&s.fromPost===e)return console.log("found item by soul",e),parseInt(o);if(Object(u["a"])(s.alphabizURI)===t)return console.log("found",t,s.alphabizURI,o),parseInt(o)}return-1}},created(){this.onDrag=Object(F["a"])(this.onDrag,1e3/60),this.onResize=Object(F["a"])(this.onResize)},beforeDestroy(){window.removeEventListener("resize",this.onResize)},mounted(){window.addEventListener("resize",this.onResize),console.log("table created",this.$route.query)},activated(){if(this.highlightItem={infoHash:-1},this.$route.query&&this.$route.query.abKey){const t=Date.now(),e=setInterval((()=>{if(!this.$route.path.startsWith("/downloader"))return clearInterval(e),console.log("User exit before loaded");if(this.$refs.tableIns){var o;if(Date.now()-t<1e3)return;const s=null===(o=this.$route.query.abKey)||void 0===o?void 0:o.replace(/\s/g,"+"),i=this.findTaskIndex(s,this.$route.query.soul);if(-1===i)return console.log("Cannot find abKey",s);const n=this.list.list[i];console.log("scroll to",i,n),this.highlightItem=n,this.$refs.tableIns.scrollTo(i,"center"),clearInterval(e),setTimeout((()=>{this.highlightItem===n&&(this.highlightItem={infoHash:-1})}),2500)}}),200)}}},M=W,U=(o("7c24"),o("eaac")),B=o("357e"),J=Object(f["a"])(M,S,k,!1,null,null,null),V=J.exports;_()(J,"components",{QTable:U["a"],QTr:L["a"],QTh:B["a"],QIcon:v["a"],QColor:E["a"]});var G=function(){var t=this,e=this,o=e.$createElement,s=e._self._c||o;return s("q-dialog",{attrs:{value:e.show},on:{input:function(e){return t.$emit("change",e)},"before-hide":function(){return t.disable=!1}}},[s("q-card",{staticClass:"info"},[s("q-card-section",[s("div",{staticClass:"text-h6"},[e._v(e._s(e.$t("create_payment")))]),s("div",{staticClass:"infohash"},[e._v(e._s(e.$t("pay_for_torrent",[e.torrentName])))]),s("small",{staticClass:"infohash text-secondary"},[e._v("infoHash: "+e._s(e.infoHash))]),s("div",{staticClass:"peer-info"},[e._v(e._s(e.$t("pay_target"))+":\n        "),s("div",{staticClass:"q-ml-sm remote"},[e._v("SubId: "+e._s(e.remoteSubId))]),s("div",{staticClass:"peer-address q-ml-md"},[e._v("Address: "+e._s(e.address))]),s("div",{staticClass:"peer-id q-ml-md"},[e._v("PeerId: "+e._s(e.peerId))])]),s("div",{staticClass:"space q-my-md"}),s("div",{staticClass:"user-info"},[s("div",{staticClass:"sub-id"},[e._v(e._s(e.$t("your_subid"))+": "+e._s(e.subId))]),s("div",{staticClass:"credit-count"},[e._v(e._s(e.$t("your_credits"))+": "+e._s(e.credit))])]),s("div",{staticClass:"actions"},[s("q-btn",{attrs:{"no-caps":"",label:e.$t("pay_point_for_data",[2,"20MB"]),disable:e.disable,loading:e.disable},on:{click:function(t){return e.pay(2)}}}),s("q-btn",{attrs:{"no-caps":"",label:e.$t("pay_point_for_data",[10,"100MB"]),disable:e.disable,loading:e.disable},on:{click:function(t){return e.pay(10)}}}),s("br"),s("q-toggle",{attrs:{value:e.enableAutoRenew,label:e.$t("auto_renew"),"left-label":""},on:{input:e.setAutoRenew}})],1)])],1)],1)},K=[],X={name:"TorrentPayment",props:{dp$source:Object,infoHash:{type:String,default:""},torrentName:{type:String,default:""},peerId:{type:String,default:""},address:{type:String,default:""},remoteUser:{type:String,default:""},remoteSubId:{type:String,default:""},show:{type:Boolean,default:!1},autoRenew:{type:Object,default:()=>({})}},data(){return{disable:!1,sentTransactions:new Set,pendingTransactions:new Map}},computed:{credit(){return this.dp$source.dp$credit},userId(){return this.$store.state.account.username},subId(){return this.dp$source.dp$address},enableAutoRenew(){return this.autoRenew&&this.autoRenew[this.infoHash]||!1},income(){return this.dp$source.dp$incomeTxnList},expenses(){return this.dp$source.dp$expenseTxnList}},methods:{setAutoRenew(t){this.$emit("setAutoRenew",this.infoHash,t)},pay(t=1){if(!this.infoHash.length||!this.peerId.length||!this.remoteSubId.length)return this.$q.notify("Info missing");this.disable=!0,console.log("dp$ create payment from","TorrentPayment::pay"),this.$emit("createPayment",{infoHash:this.infoHash,peerId:this.peerId,remoteSubId:this.remoteSubId,payed:t,autoRenew:this.enableAutoRenew})}}},Y=X,Z=o("24e8"),tt=o("f09f"),et=o("a370"),ot=o("9564"),st=Object(f["a"])(Y,G,K,!1,null,null,null),it=st.exports;_()(st,"components",{QDialog:Z["a"],QCard:tt["a"],QCardSection:et["a"],QBtn:Q["a"],QToggle:ot["a"]});var nt=o("d491"),at=o("9e90"),rt=o("2de9"),lt=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("alphabiz-button",{attrs:{"button-type":"icon",icon:"sort"}},[o("q-tooltip",[t._v(t._s(t.$t("sort")))]),o("q-menu",{attrs:{"transition-show":"jump-down","transition-hide":"jump-up"}},[o("q-list",{attrs:{padding:""}},[o("q-item",{staticStyle:{"min-width":"240px"}},[o("q-item-section",[o("q-item-label",[t._v(t._s(t.$t("sort")))])],1),o("q-item-section",{attrs:{side:""}},[o("q-badge",{staticClass:"cursor-pointer non-selectable",attrs:{color:"general","text-color":"general"},on:{click:t.changeSortSequence}},[o("span",{staticClass:"q-ml-sm"},[t._v(t._s(1===t.sortSequence?t.$t("ascending"):t.$t("descending")))]),o("q-icon",{attrs:{size:"1.5rem",name:1===t.sortSequence?"arrow_drop_up":"arrow_drop_down"}})],1)],1)],1),o("q-separator"),t._l(t.options,(function(e){return o("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],key:e.value,attrs:{clickable:"",dense:"",tag:"label"}},[o("q-item-section",{attrs:{avatar:""}},[o("q-radio",{attrs:{val:e.value,color:"positive"},model:{value:t.sortOption,callback:function(e){t.sortOption=e},expression:"sortOption"}})],1),o("q-item-section",[o("q-item-label",[t._v(t._s(e.label))])],1)],1)}))],2)],1)],1)},ht=[],ct={name:"DownloaderSortMenu",inject:["io"],data(){return{sortOption:"createdTime",sortSequence:1}},computed:{options(){switch(this.$route.query.currentTab){case"downloading":return[{label:this.$t("status"),value:"status"},{label:this.$t("task_name"),value:"name"},{label:this.$t("size"),value:"length"},{label:this.$t("total_download_speed"),value:"downloadSpeed"},{label:this.$t("progress"),value:"progress"},{label:this.$t("remaining"),value:"timeRemaining"},{label:this.$t("created_time"),value:"createdTime"},{label:this.$t("used_time"),value:"usedTime"}];case"uploading":return[{label:this.$t("status"),value:"status"},{label:this.$t("task_name"),value:"name"},{label:this.$t("size"),value:"length"},{label:this.$t("total_upload_speed"),value:"uploadSpeed"},{label:this.$t("created_time"),value:"createdTime"},{label:this.$t("completed_time"),value:"completedTime"},{label:this.$t("income"),value:"income"}];case"downloaded":return[{label:this.$t("status"),value:"status"},{label:this.$t("task_name"),value:"name"},{label:this.$t("size"),value:"length"},{label:this.$t("created_time"),value:"createdTime"},{label:this.$t("completed_time"),value:"completedTime"},{label:this.$t("used_time"),value:"usedTime"}]}return[{label:this.$t("status"),value:"status"},{label:this.$t("task_name"),value:"name"}]}},methods:{saveSortOptions(){localStorage.setItem("sortOptions_"+this.$route.query.currentTab,JSON.stringify({sortOption:this.sortOption,sortSequence:this.sortSequence}))},changeSortSequence(){this.sortSequence=-1*this.sortSequence,this.$emit("changeSortSequence",this.sortSequence),this.io.emit("set_sort_sequence",this.sortSequence),this.saveSortOptions()}},mounted(){const t=localStorage.getItem("sortOptions_"+this.$route.query.currentTab);if(t){const{sortOption:e,sortSequence:o}=JSON.parse(t);e&&(this.sortOption=e),o&&(this.sortSequence=o)}else this.sortOption="createdTime",this.sortSequence=1,this.saveSortOptions()},watch:{sortOption(t){this.$emit("changeSortOption",t),this.io.emit("set_sort_option",this.sortOption),this.saveSortOptions()},"$route.query.currentTab"(t,e){if(t===e||!t)return;const o=localStorage.getItem("sortOptions_"+t);if(o){const{sortOption:t,sortSequence:e}=JSON.parse(o);t&&(this.sortOption=t),e&&(this.sortSequence=e)}else this.sortOption="createdTime",this.sortSequence=1}}},dt=ct,ut=o("05c0"),pt=o("4e73"),mt=o("1c1c"),gt=o("4074"),ft=o("0170"),bt=o("58a8"),wt=o("eb85"),vt=o("3786"),yt=o("714f"),_t=Object(f["a"])(dt,lt,ht,!1,null,"b08e87f8",null),Tt=_t.exports;_()(_t,"components",{QTooltip:ut["a"],QMenu:pt["a"],QList:mt["a"],QItem:w["a"],QItemSection:gt["a"],QItemLabel:ft["a"],QBadge:bt["a"],QIcon:v["a"],QSeparator:wt["a"],QRadio:vt["a"]}),_()(_t,"directives",{Ripple:yt["a"]});var $t=o("4aad"),St=o("1141"),kt=o("648d"),It=o("9b6a"),xt=o("b4ab"),qt=o("f71e"),Ct=o("77d8"),Pt=o("43a8"),Dt=o("0208");const Ot=o("ed08").isElectron();var Ht={name:"Downloader",inject:["rootApp","io","taskQueue","dp$source"],components:{CardList:$,TableList:V,TableListDetail:nt["a"],IconWithTooltip:P["a"],AlphabizPanel:at["a"],TorrentPayment:it,SortMenu:Tt,PostCard:rt["a"],QuickStart:xt["a"]},data(){return{isMobile:O["b"].is.mobile||Object(Ct["a"])(),currentTab:"downloading",loading:!1,listMode:localStorage.getItem("task-list-mode")||"list",searchText:"",showSearchText:!1,autoRenew:JSON.parse(localStorage.getItem("task-autorenew")||"{}"),sortOption:"createdTime",sortSequence:1,statusText:{},info:{downloadSpeed:0,uploadSpeed:0,progress:0,taskNum:0},showPayment:!1,showTorrentDetail:!1,torrentDetailInfoHash:"",paymentData:{infoHash:"",torrentName:"",peerId:"",address:"",remoteUser:"",remoteSubId:""},paymentSize:1e7,showAlphabizPanel:!1,abTorrentInfoHash:"",lib:$t["a"],showChannelPost:!1,channelPost:null,showQuickStartDialog:!1,quickStartTask:null}},computed:{torrentList(){return kt["a"].taskList},listComponent(){return"card"===this.listMode?"CardList":"TableList"},displayTab:{get(){return this.currentTab+"Torrents"},set(t){const e=t.replace(/Torrents$/,"");this.$router.push({path:this.$route.path,query:{...this.$route.query,currentTab:e}})}},displayList(){return[{key:"downloadingTorrents",label:this.$t("downloading"),open:!0,list:this.filterTorrent(this.downloadingTorrents||[])},{key:"uploadingTorrents",label:this.$t("uploading"),open:!1,list:this.filterTorrent(this.uploadingTorrents||[])},{key:"downloadedTorrents",label:this.$t("downloaded"),open:!1,list:this.filterTorrent(this.downloadedTorrents||[])}]},currentList(){switch(this.displayTab){case"downloadingTorrents":return this.displayList[0].list;case"uploadingTorrents":return this.displayList[1].list;default:return this.displayList[2].list}},isAllStarted(){return this.currentList.every((t=>!t.paused))},isAllPaused(){return this.currentList.every((t=>t.paused))},noDataMessage(){return this.searchText?this.$t("no_matched_task"):this.$t("no_task")},downloadingTorrents(){const t=this.sortTorrents(this.torrentList.downloading);return t},disableDownloadAll(){return this.loading||this.downloadingTorrents.every((t=>!t.paused))},disablePauseAllDownloading(){return this.loading||this.downloadingTorrents.every((t=>t.paused))},downloadingProgress(){const t=this.torrentList.totalDownloadProgress;return isNaN(t)||0===t&&0===this.downloadingNum?{value:0,label:this.$t("no_downloading_task")}:{value:t,label:Object(q["f"])(t)}},uploadingTorrents(){const t=this.sortTorrents(this.torrentList.uploading);return t},totalDownloadSpeed(){return this.torrentList.totalDownloadSpeed?Object(q["a"])(this.torrentList.totalDownloadSpeed,{byte:!1,gb:!1})+" / s":"0.00 KB / s"},totalUploadSpeed(){if(!this.uploadingTorrents)return"-";const t=this.torrentList.totalUploadSpeed;return Object(q["a"])(t,{byte:!1,gb:!1})+" / s"},downloadedTorrents(){return this.sortTorrents(this.torrentList.downloaded)},torrentItems(){return kt["a"].allTasks},torrentDetail(){return this.torrentDetailInfoHash&&this.torrentItems.find((t=>t.infoHash===this.torrentDetailInfoHash))||{}},alphabizTorrent(){return this.abTorrentInfoHash&&this.torrentItems.find((t=>t.infoHash===this.abTorrentInfoHash))||{}},downloadingNum(){return this.downloadingTorrents.filter((t=>!t.paused&&!t.pending&&!(!t.download||1===t.progress))).length},incomes(){let t=0;const e={};for(const n of this.dp$source.dp$incomeTxnListToday){if(!n.meta||"FINISH"!==n.status)continue;t+=n.amount;const o=JSON.parse(n.meta);o.infoHash&&(e[o.infoHash]||(e[o.infoHash]=0),e[o.infoHash]+=n.amount)}let o=0;const s={},i=this.dp$source.dp$incomeStatusMapper.FINISH;if(i)for(const n of i){const t=this.dp$source.dp$incomeTxnDict[n];o+=t.amount;const e=JSON.parse(t.meta).infoHash;s[e]||(s[e]=0),s[e]+=t.amount}return{todayIncome:t,todayTaskIncome:e,allIncome:o,allTaskIncome:s}},totalIncomeInfo(){return 2!==C["a"].state.credits.isModuleInit?this.$t("login_to_see_income"):this.$t("total_income_info",[Number((this.incomes.todayIncome/1e3).toFixed(3)),Number((this.incomes.allIncome/1e3).toFixed(3))])},disableTasks(){return!!C["a"].getters.shouldDisableTasks||!!C["a"].getters.settings.forceLogin&&(!C["a"].getters.accountUserInfo||!C["a"].getters.accountUserInfo.sub)},channelFollowable(){return!!this.channelPost&&!$t["a"].followingChannels.some((t=>{var e;return t&&t.id===(null===(e=this.channelPost.channel)||void 0===e?void 0:e.id)}))}},methods:{ensureLogin(t){if(this.disableTasks){if(!C["a"].state.account.authState)return;this.$amplify.showSignedOutDialog()}else"function"===typeof t&&t()},async setLoading(){this.loading=!0,await new Promise((t=>setTimeout(t,1e3))),this.loading=!1},toggleSearchText(t){this.showSearchText=t,t&&this.$nextTick((()=>{this.$refs.searchInput.focus()}))},filterTorrent(t){const e=this.searchText.toLowerCase(),o=t.filter((t=>t.name||t.postTitle?t.postTitle?t.postTitle.toLowerCase().includes(e):t.name.toLowerCase().includes(e):""===e));return o},clearSearch(){this.searchText="",this.$refs.searchInput.blur()},changeListMode(){"list"===this.listMode?this.listMode="card":this.listMode="list",localStorage.setItem("task-list-mode",this.listMode)},byteToLargerSize(t){return Object(q["a"])(t,{byte:!0,gb:!0})},getTorrentListName(t){let e="downloading";return t.isSeeding||t.uploading?e="uploading":t.pending?e="pending":1===t.progress||t.done?e="downloaded":t.paused&&(e="paused"),e},showMagnetDialog(t){this.$root.$emit("openTaskDialog",t)},showDetail(t){this.torrentDetailInfoHash=t.infoHash,this.showTorrentDetail=!0},hideDetail(){this.showTorrentDetail=!1,this.torrentDetailInfoHash=""},showAbPanel({infoHash:t}){this.abTorrentInfoHash=t,this.showAlphabizPanel=!0},async showPostInfo(t=""){if(console.log("show",t),!t||!t.includes("posts"))return this.$q.notify("Cannot find post");this.$q.loading.show();const e=t.replace(/\/posts\/([^/]+$)/,""),o=e.split("/").filter((t=>t)).pop(),s=t.split("/").filter((t=>t)).pop();let i=!1;setTimeout((()=>{i||(i=!0,this.$q.loading.hide(),this.$q.dialog({title:this.$t("error"),message:this.$t("cannot_get_channel_info"),ok:this.$t("ok")}))}),5e3);const n=await $t["a"].getPostById(o,s,!0);if(console.log("show post",n),i)return;const a=await $t["a"].getChannelById(o);if(console.log("show post channel",a),!i){if(i=!0,!n)return this.$q.loading.hide(),void this.$q.dialog({title:"Not Found",message:"Cannot found post info"});n.channel=a,this.channelPost=n,this.$q.loading.hide(),this.showChannelPost=!0}},toChannelPage(t){console.log("to",t);const e=["id","title"].map((e=>{const o=t[e];return encodeURIComponent(e)+"="+encodeURIComponent(o)})).join("&");this.$router.push(`/library/channel?${e}`),setTimeout((()=>{this.$root.$emit("navigate-to",`/library/channel?${e}`)}),200)},hideAbPanel(){this.showAlphabizPanel=!1,this.abTorrentInfoHash=""},async shareFile(t){const e=await Dt["Share"].canShare();if(!e.value)return;const o=await Dt["Share"].share({files:["file://"+encodeURI(t)]}).catch((t=>{console.log(t)}));this.$q.notify("Result: "+o.activityType)},showOriginTorrent(t){let e=t.token||t.origin;if(t.isSeeding||t.upload?e=t.magnetURI:t.magnetPath&&(e=t.magnetPath),!e)return this.$q.notify("origin_not_found");a.a.existsSync(e)?this.io.emit("show_torrent_file",e):(e.startsWith("magnet")||(e="magnet:?xt=urn:btih:"+t.infoHash),t.name&&(e+="&dn="+encodeURIComponent(t.name)),Object(qt["b"])(e),this.$q.notify(this.$t("text_copied")))},async showDirectory(t){if(Object(Ct["a"])()){if(1!==t.progress&&!t.done)return this.$q.notify(this.$t("wait_for_downloaded_to_share"));if((await Dt["Share"].canShare()).value){const e=t.files.map((t=>"file://"+t.path));console.log("Files",e,t.path);const o=Object(Pt["a"])(e);console.log("pub",o),Dt["Share"].share({files:["file://"+encodeURI(o)],title:"Save"}).catch((t=>{console.log("Share error",t)}))}}if(!a.a.existsSync(t.path))return this.$q.notify(this.$t("path_missing"));if(t.files&&1===t.files.length&&a.a.existsSync(t.files[0].path))return this.io.emit("show_torrent_file",t.files[0].path);const e=l.a.resolve(t.path,t.postTitle||t.name||"");if(!a.a.existsSync(e))return this.io.emit("show_torrent_file",t.path);this.io.emit("show_torrent_file",e)},setAutoRenew(t,e){return Object(It["c"])(t,e),this.$set(this.autoRenew,t,e)},showPaymentPannel(t){this.paymentData=t,this.showPayment=!0},changeSortOption(t){this.sortOption=t},changeSortSequence(t){this.sortSequence=t},sortTorrents(t){const e=this.sortOption,o=e;switch(o){case"income":{const e=this.incomes.allTaskIncome;return[...t].sort(((t,o)=>e[t.infoHash]?e[o.infoHash]?(e[t.infoHash]-e[o.infoHash])*this.sortSequence:-1:e[o.infoHash]?1:0))}default:return t}},async askForConfirm(t){return new Promise((e=>{this.$q.dialog({persistent:!0,message:t,ok:this.$t("confirm"),cancel:{textColor:"grey",color:"unset",flat:!0,label:this.$t("cancel")}}).onOk((()=>e(!0))).onCancel((()=>e(!1)))}))},downloadAll(t=!1){if(console.log("download all!"),this.loading)return console.log("skip downloadAll since loading");this.setLoading(),Object(St["c"])(t)},async pauseAllDownloading(t=!1){if(!this.torrentList.downloading.length)return console.log("skip pause all downloading");console.log("pauseall"),this.setLoading(),Object(St["d"])(t)},requestPauseAllDownloading(){this.$q.dialog({title:this.$t("pause_all"),message:this.$t("pause_all_finish_payments"),ok:{textColor:"red",color:"unset",flat:!0,label:this.$t("pause_all")},cancel:{textColor:"grey",color:"unset",flat:!0,label:this.$t("cancel")}}).onOk((()=>{this.pauseAllDownloading()}))},removeAllDownloading(){const t=[];C["a"].getters.settings.defaultDeleteFiles&&t.push("deleteFiles"),this.$q.dialog({title:this.$t("delete_task"),message:this.$t("remove_all_downloading_tasks"),options:{type:"checkbox",model:t,items:[{label:this.$t("also_delete_files"),value:"deleteFiles"}]},ok:{textColor:"red",color:"unset",flat:!0,label:this.$t("remove_all")},cancel:{textColor:"grey",color:"unset",flat:!0,label:this.$t("not_now")}}).onOk((async t=>{const e=t.includes("deleteFiles");if(e&&C["a"].state.video.currentVideo.infoHash){const t=this.downloadingTorrents.find((t=>t.infoHash===C["a"].state.video.currentVideo.infoHash));if(t){const e=this.$t("remove_playing_confirm",[t.name]),o=await this.askForConfirm(e);if(!o)return;this.io.emit("trigger_clear_player",t.infoHash)}}this.setLoading(),this.io.emit("delete_all","download",e);for(const o of this.downloadingTorrents)this.io.emit("delete_torrent",o.infoHash,e);C["a"].dispatch("updateSettings",{defaultDeleteFiles:e})}))},pauseAllUploading(t=!1){this.torrentList.uploading.length&&(this.setLoading(),Object(St["e"])(t))},removeAllUploading(){const t=[];C["a"].getters.settings.defaultDeleteFiles&&t.push("deleteFiles"),this.$q.dialog({title:this.$t("delete_task"),message:this.$t("remove_all_upload_tasks"),options:{type:"checkbox",model:t,items:[{label:this.$t("also_delete_files"),value:"deleteFiles"},{label:this.$t("remove_autoupload_files"),value:"deleteAutoUpload"}]},ok:{textColor:"red",color:"unset",flat:!0,label:this.$t("remove_all")},cancel:{textColor:"grey",color:"unset",flat:!0,label:this.$t("not_now")}}).onOk((async t=>{const e=t.includes("deleteFiles"),o=t.includes("deleteAutoUpload");if(e&&C["a"].state.video.currentVideo.remotePlay&&C["a"].state.video.currentVideo.infoHash){const t=this.uploadingTorrents.find((t=>t.infoHash===C["a"].state.video.currentVideo.infoHash));if(t){var s,i,n;const e=this.$t("remove_playing_confirm",[t.name]),o=await this.askForConfirm(e);if(!o)return;console.log(null===(s=this.$refs.videoJsPlayer)||void 0===s?void 0:s.player),null===(i=this.$refs.videoJsPlayer)||void 0===i||null===(n=i.player)||void 0===n||n.stop(),this.io.emit("trigger_clear_player",t.infoHash)}}this.setLoading(),this.io.emit("delete_all","upload",e,o),C["a"].dispatch("updateSettings",{defaultDeleteFiles:e})}))},async uploadAll(t=!1){const e=Object(St["h"])(t);if(console.log("rest",e),e<=this.downloadedTorrents.length)return void console.log("Skip watch: nothing to upload");this.loading=!0;let o=null;const s=new Promise((t=>o=t)),i=this.$watch("downloadedTorrents",(t=>{t.length<=e&&(i(),this.loading=!1,console.log("upload done"),o())}));return setTimeout((()=>{this.loading&&(this.loading=!1,i(),o())}),5e3),s},pauseTorrent(t){this.setLoading(),Object(St["f"])(t,this)},resumeTorrent(t){t&&this.ensureLogin((()=>{this.setLoading(),console.log("resume",t),this.io.emit("resume_torrent",t)}))},deleteTorrent(t){this.ensureLogin((async()=>{if(t.infoHash&&C["a"].state.video.currentVideo.remotePlay&&t.infoHash===C["a"].state.video.currentVideo.infoHash){const e=this.$t("remove_playing_confirm",[t.name]),o=await this.askForConfirm(e);if(o){const e=await kt["a"].deleteTask(t);if(!e)return;this.io.emit("trigger_clear_player",t.infoHash)}}else kt["a"].deleteTask(t)}))},clearAll(){this.ensureLogin((()=>{this.$q.dialog({title:this.$t("clear_history"),message:this.$t("remove_all_history"),ok:this.$t("remove_all"),cancel:this.$t("not_now")}).onOk((()=>{this.setLoading();for(const t of this.downloadedTorrents)this.io.emit("delete_torrent",t.infoHash)}))}))},startPayment(t,e=!1){Object(It["d"])(t,e)},async createPayment(t,e=!1){await Object(It["a"])(t,e,this),e||(this.showPayment=!1)},setThrottleGroup(t){this.io.emit("set_throttle_group",t)},saveTorrentFile(t){this.io.emit("save_torrent_file",t)},play(t,e){(Ot||Object(Ct["a"])())&&(console.log("run play():"+e+", "+t),C["a"].dispatch("remotePlay",e),this.io.emit("play-torrent",{infoHash:e,filepath:t}))},showQuickStart(t){this.quickStartTask=t,this.showQuickStartDialog=!0},hideQuickStartDialog(){this.showQuickStartDialog=!1,this.quickStartTask=null}},created(){this.io.on("client_info",(t=>{this.info=t}))},mounted(){if(Object.keys(this.autoRenew).length)for(const t in this.autoRenew)Object(It["c"])(t,this.autoRenew[t])},beforeRouteEnter(t,e,o){if(console.log("before enter",t,e),"/downloader"!==t.path)return o();console.log("is downloader"),t.query.currentTab?(console.log("current tab:",t.query.currentTab),o((e=>{e.currentTab=t.query.currentTab}))):(console.log("not current tab",t.query),o({path:t.path,query:{...t.query,currentTab:"downloading"}}))},beforeRouteUpdate(t,e,o){console.log("before update",t,e),this.currentTab=t.query.currentTab,o()},watch:{autoRenew(t){localStorage.setItem("task-autorenew",JSON.stringify(t))}}},At=Ht,Lt=(o("d210"),o("f77e"),o("9989")),Nt=o("e359"),jt=o("65c6"),Qt=o("2c91"),Et=o("27f9"),Rt=o("adad"),zt=o("823b"),Ft=o("de5e"),Wt=Object(f["a"])(At,s,i,!1,null,"540e1290",null);e["default"]=Wt.exports;_()(Wt,"components",{QPage:Lt["a"],QHeader:Nt["a"],QToolbar:jt["a"],QSpace:Qt["a"],QBtn:Q["a"],QInput:Et["a"],QIcon:v["a"],QTooltip:ut["a"],QLinearProgress:j["a"],QTabPanels:Rt["a"],QTabPanel:zt["a"],QPageSticky:Ft["a"],QDialog:Z["a"]})},"687b":function(t,e,o){},"69df":function(t,e,o){},7159:function(t,e,o){},"755b":function(t,e,o){"use strict";o("14ff")},"7c24":function(t,e,o){"use strict";o("69df")},c48e:function(t,e,o){"use strict";o("364e")},d210:function(t,e,o){"use strict";o("687b")},f77e:function(t,e,o){"use strict";o("7159")}}]);