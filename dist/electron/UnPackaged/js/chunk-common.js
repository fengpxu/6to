(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[1],{"0ebe":function(t,e,s){"use strict";var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-page-sticky",{staticClass:"back-to-top",attrs:{position:"bottom-right"}},[s("transition",{attrs:{name:"animate"}},[s("q-btn",{directives:[{name:"show",rawName:"v-show",value:t.show,expression:"show"}],staticClass:"back-btn q-ma-xs",class:{hide:t.hide},attrs:{fab:"","no-wrap":"",size:"18px",color:"primary","text-color":"primary",icon:"publish"},on:{click:t.onClick}},[s("div",{staticClass:"fab-inner-text"},[t._v("\n        "+t._s(t.$t("back_to_top"))+"\n      ")])])],1)],1)},a=[],o={name:"BackToTop",props:{show:Boolean},data(){return{hide:!1,hovered:!1}},methods:{onClick(){this.$emit("click")}},activated(){this.hide=!0,setTimeout((()=>{this.hide=!1}),300)},deactivated(){this.hide=!0}},n=o,r=(s("10fd"),s("2877")),l=s("de5e"),c=s("9c40"),d=s("eebe"),h=s.n(d),u=Object(r["a"])(n,i,a,!1,null,"ec8a50cc",null);e["a"]=u.exports;h()(u,"components",{QPageSticky:l["a"],QBtn:c["a"]})},"10fd":function(t,e,s){"use strict";s("345c")},"1eab":function(t,e,s){"use strict";s("b739")},"1ffc":function(t,e,s){"use strict";var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticStyle:{width:"100%"}},[s("q-card",{staticClass:"torrent-item",class:[t.screen$xs?"q-mb-sm":"q-mb-md"],attrs:{flat:"",bordered:""}},[s("q-card-section",{class:{highlight:t.highlight}},[s("div",{staticClass:"row justify-between items-center"},[s("div",{staticClass:"torrent-info title q-mb-xs"},[s("p",{staticClass:"torrent-name"},[t.isReady?t._e():s("q-circular-progress",{directives:[{name:"show",rawName:"v-show",value:!t.torrent.paused&&!t.torrent.pending,expression:"!torrent.paused && !torrent.pending"}],staticClass:"torrent-loading",attrs:{indeterminate:"",size:"24px",color:"primary"}}),s("span",[t._v(t._s(t.displayName))]),t.torrent.isAutoUpload?s("q-icon",{staticClass:"q-ml-md",attrs:{name:"drive_folder_upload"}},[s("q-tooltip",[t._v(t._s(t.$t("auto_uploading")))])],1):t._e()],1)]),s("alphabiz-button",{staticClass:"absolute-top-right q-mt-sm q-mr-md",attrs:{size:"md","button-type":"icon",icon:"more_horiz"},on:{click:t.showDetail}},[s("q-tooltip",[t._v(t._s(t.$t("more")))])],1)],1),s("div",{staticClass:"torrent-info"},[s("div",{staticClass:"operations"},[s("alphabiz-button",{directives:[{name:"show",rawName:"v-show",value:!t.torrent.isAutoUpload&&!(t.torrent.paused&&t.torrent.missFile),expression:"!torrent.isAutoUpload && !(torrent.paused && torrent.missFile)"}],attrs:{color:"general",value:t.locked,icon:t.actionIcon,label:t.torrentAction,disabled:t.isProcessingUpload},on:{click:t.switchStateTorrent}}),t.isReady&&t.playable?s("alphabiz-button",{attrs:{color:"general",icon:"smart_display",label:t.torrent.done||t.torrent.isSeeding?t.$t("play"):t.$t("play_while_downloading")}},[s("q-menu",{attrs:{"max-height":"200px"}},[s("q-list",{staticStyle:{"min-width":"100px"}},t._l(t.playableFiles,(function(e,i){return s("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],key:i,staticClass:"playable-items",attrs:{clickable:!e.missing,disable:e.missing},on:{click:function(s){return t.play(e.path,t.torrent.infoHash)}}},[s("q-linear-progress",{directives:[{name:"show",rawName:"v-show",value:1!==e.progress||e.isSeeding,expression:"item.progress !== 1 || item.isSeeding"}],staticClass:"progress-background",attrs:{stripe:"",value:e.progress}}),s("q-item-section",[s("p",{staticClass:"q-ma-none"},[s("q-icon",{staticClass:"q-mr-xs",attrs:{name:"play_arrow"}}),t._v("\n                      "+t._s(e.name)+"\n                      "),e.missing?s("q-icon",{attrs:{name:"error",color:"primary"}}):1===e.progress?s("q-icon",{attrs:{name:"done",color:"primary"}}):t._e(),e.missing?s("q-tooltip",[t._v(t._s(t.$t("file_not_found")))]):t._e(),1!==e.progress||t.isElectron?t._e():s("q-btn",{staticClass:"save-to-local-btn",attrs:{flat:"",dense:"",color:"primary",size:"sm",icon:t.isCapacitor?"ios_share":"save"},on:{click:function(s){return s.stopPropagation(),s.preventDefault(),t.saveFile(e)}}},[s("q-tooltip",[t._v(t._s(t.$t("save_to_local")))])],1)],1)])],1)})),1)],1)],1):s("alphabiz-button",{attrs:{color:"general",icon:"file_open",label:t.$t("open_file")},on:{click:t.openFile}}),t.isElectron||t.isCapacitor?s("alphabiz-button",{attrs:{color:"general",icon:t.isElectron?"folder":"ios_share",label:t.isElectron?t.$t("open_directory"):t.$t("share")},on:{click:t.showDirectory}}):t._e(),t.torrent.fromPost?s("alphabiz-button",{attrs:{icon:"video_library",label:t.$t("library")},on:{click:t.showPostInfo}}):t._e(),1!==t.torrent.progress&&!t.torrent.upload||t.torrent.paused?t._e():s("alphabiz-button",{attrs:{icon:"present_to_all",label:t.$t("share_to_library"),disabled:t.isProcessingUpload},on:{click:t.showQuickStart}}),t.isElectron||t.isCapacitor||!t.torrent.done?t._e():s("alphabiz-button",{attrs:{label:t.$t("save_as_zip"),icon:"folder_zip"},on:{click:t.saveZip}}),s("alphabiz-button",{attrs:{color:"negative",icon:"close",label:t.$t("delete"),disabled:t.isProcessingUpload},on:{click:t.deleteTorrent}}),s("q-space"),t.showAbButton?s("alphabiz-button",{attrs:{color:"accent",icon:t.isPayed?"flash_auto":"flash_on"},on:{click:t.openAbPanel}},[s("q-tooltip",[t._v(t._s(t.isPayed?t.$t("alphabiz_accelerating"):t.$t("ab_peer_available")))])],1):t._e()],1),t.torrent.upload||t.torrent.isSeeding?t._e():s("q-linear-progress",{staticClass:"q-mt-md",attrs:{value:t.torrent.done?1:t.torrent.progress,size:"18px",rounded:""}},[s("div",{staticClass:"progress-text flex flex-center absolute-full"},[t._v(t._s(t.progress||"0%"))])]),s("p",{staticClass:"text q-mb-xs bottom-status"},[t.statusText?s("span",{staticClass:"hint status-text"},[s("small",[t._v(t._s(t.statusText))]),s("br")]):t._e(),s("span",{staticStyle:{"margin-right":"10px"}},[t._v(t._s(this.$t("status"))+": "+t._s(t.torrentStatus))]),s("span",[t.torrent.paused||t.torrent.done||t.torrent.pending||t.torrent.isSeeding?t._e():s("span",{staticClass:"q-mr-sm"},[t._v("\n              "+t._s(t.downloadSpeed)+"\n            ")]),t.torrent.upload?t._e():s("span",{staticStyle:{"margin-right":"10px"}},[t._v("↓ "+t._s(t.downloaded)+" / "+t._s(t.total))])]),s("span",[t.torrent.paused||t.torrent.done||t.torrent.pending?t._e():s("span",{staticClass:"q-mr-sm"},[t._v("\n              "+t._s(t.uploadSpeed)+"\n            ")]),s("span",{staticStyle:{"margin-right":"10px"}},[t._v("↑ "+t._s(t.uploaded))])])]),s("p",{staticClass:"text timers q-mt-xs bottom-status"},[t.torrent.timeRemaining&&t.torrent.download?s("span",{staticClass:"remaining q-mr-md"},[t._v(t._s(t.$t("remaining"))+": "+t._s(t.remaining))]):t._e(),t.createdTime?s("span",[t._v(t._s(t.$t("created_time")+": "+t.createdTime))]):t._e(),t.completedTime?s("span",[t._v(t._s(t.$t("completed_time")+": "+t.completedTime))]):t._e(),t.usedTime?s("span",[t._v(t._s(t.$t("used_time")+": "+t.usedTime))]):t._e()])],1)])],1)],1)},a=[],o=(s("5319"),s("ddb0"),s("307e")),n=s("f880"),r=s("0613"),l=s("ed08"),c=s("f71e"),d=s("77d8"),h=s("0967"),u={name:"CardItem",inject:["io"],props:{torrent:{type:Object,required:!0},statusText:String,highlight:Boolean},data(){return{levelOptions:[{label:" Low ",value:"low"},{label:" Middle ",value:"mid"},{label:" High ",value:"high"}],locked:!1,loading:!1,isElectron:Object(l["isElectron"])(),isCapacitor:Object(d["a"])()}},computed:{isDevMode(){return r["a"].getters.isDevMode},isProcessingUpload(){return!(!this.torrent.isSeeding&&!this.torrent.done||this.torrent.length)},torrentAction(){return this.torrent.paused?this.torrent.done||1===this.torrent.progress||this.torrent.isSeeding?this.$t("seed"):this.$t("resume"):this.torrent.isSeeding?this.$t("stop_torrent"):this.$t("pause")},actionIcon(){return this.torrent.paused?this.torrent.done||this.torrent.isSeeding?"cloud_upload":"play_arrow":this.torrent.isSeeding?"stop":"pause"},isReady(){return this.torrent&&this.torrent.name&&this.torrent.length},downloadSpeed(){return this.byteToLargerSize(this.torrent.downloadSpeed)+"/s"},downloaded(){return this.byteToLargerSize(this.torrent.downloaded)},uploadSpeed(){return this.byteToLargerSize(this.torrent.uploadSpeed)+"/s"},uploaded(){return this.byteToLargerSize(this.torrent.uploaded)},total(){return this.byteToLargerSize(this.torrent.length)},remaining(){return!this.torrent.timeRemaining||this.torrent.paused?"-":this.msToTime(this.torrent.timeRemaining)},createdTime(){return this.torrent.createdTime?new Date(this.torrent.createdTime).toLocaleString(this.$i18n.locale,{hour12:!1}):""},completedTime(){return this.torrent.completedTime&&this.torrent.done?new Date(this.torrent.completedTime).toLocaleString(this.$i18n.locale,{hour12:!1}):""},usedTime(){return this.torrent.usedTime?this.msToTime(this.torrent.usedTime):""},torrentStatus(){if(this.torrent.missFile)return this.$t("miss_file");if(this.torrent.isSeeding||this.torrent.done){if(!this.torrent.length){if(this.torrent.verifyStatus){const{current:t,total:e}=this.torrent.verifyStatus,s=t/e,i=Object(n["f"])(s);return this.$t("loading")+` (${i})`}return this.$t("loading")}return this.torrent.paused?this.$t("downloaded"):this.$t("uploading")}if(this.paused)return this.$t("paused");if(this.torrent.paused)return this.torrent.done||this.torrent.isSeeding?this.$t("completed"):this.$t("paused");if(this.torrent.isSeeding)return this.$t("seeding");if(this.torrent.upload)return this.$t("uploading");if(this.torrent.pending)return this.$t("pending");if(this.torrent.waiting)return this.$t("waiting_for_verify");if(!this.torrent.ready){if(this.torrent.verifyStatus){const{current:t,total:e}=this.torrent.verifyStatus,s=t/e,i=Object(n["f"])(s);if(!isNaN(s))return this.$t("loading")+` (${i})`}return this.$t("loading")}return this.torrent.download?this.torrent.done?this.$t("downloaded"):this.$t("downloading"):this.$t("unknown_status")},displayName(){let t=this.torrent.postTitle||this.torrent.name||this.torrent.origin||this.torrent.token;if(!t||"string"!==typeof t){if(!(t&&t instanceof File))return this.$t("loading");t=t.name}if(t.includes("&dn")){const e=(t+"&").match(/&dn=(.*?)&/);if(e&&e[1])return e[1]}const e=t.match(/btih:([^&]*)/);if(e&&e[1])return e[1];const s=h["b"].is.win?"\\":"/";if(t.includes(s)){const e=t.replace(new RegExp(s+"$"),"").match(new RegExp(`([^${s}]*$)`));if(e&&e[1])return e[1]}return t},progress(){return Object(n["f"])(this.torrent.progress)},abPeers(){return this.torrent.connections?this.torrent.connections.filter((t=>!(!this.torrent.hasMetadata&&!t.hasMeta)&&(!!t.hasResource&&(t.isAbPeer&&t.subId&&t.subId!==r["a"].getters.accountUserInfo.sub)))):[]},showAbButton(){return!this.torrent.done&&!this.torrent.isSeeding&&(this.isDevMode&&this.abPeers.length)},payedConnections(){return this.abPeers.filter((t=>"high"===t.remoteGroup))},isPayed(){return this.payedConnections.length},showAbPeerHint(){return this.abPeers.length},connectedPeers(){const t={};for(const e of this.abPeers){const s=e.subId||e.id;t[s]?t[s].isAbPeer|=e.isAbPeer:(t[s]=e,t[s].addresses=[]),t[s].addresses.includes(e.address)||t[s].addresses.push(e.address)}return Object.values(t).sort(((t,e)=>t.id.localeCompare?t.id.localeCompare(e.id):0))},playableFiles(){return this.torrent.files.filter((t=>Object(o["a"])(t.name)))},playable(){return this.playableFiles.length}},methods:{byteToLargerSize(t){return Object(n["a"])(t,{byte:!0,gb:!0})},msToTime(t){const e=Math.floor(t/1e3),s=e%60,i=(e-s)/60;if(isNaN(s))return"-";if(i>60){const t=i%60,e=(i-t)/60;return e>24?"> 24h":`${e}:${("0"+t).slice(-2)}:${("0"+s).slice(-2)}`}return`${("0"+i).slice(-2)}:${("0"+s).slice(-2)}`},deleteTorrent(){this.$emit("deleteTorrent",this.torrent)},switchStateTorrent(){if(!this.locked)if(this.locked=!0,this.torrent.isSeeding?setTimeout((()=>{this.locked=!1}),2e3):setTimeout((()=>{this.locked=!1}),1e3),this.torrent.paused)this.$emit("resumeTorrent",this.torrent);else{if(!this.torrent.infoHash)return this.$q.dialog({message:this.$t("this_task_not_ready"),ok:{textColor:"red",color:"unset",flat:!0,label:this.$t("remove")},cancel:{textColor:"grey",color:"unset",flat:!0,label:this.$t("cancel")}}).onOk((()=>{this.io.emit("delete_torrent",this.torrent.token,!1)}));this.$emit("pauseTorrent",this.torrent.infoHash)}},openAbPanel(){console.log("open"),this.$emit("showAbPanel",this.torrent)},showDetail(){this.$emit("showDetail",this.torrent)},setThrottleGroup(t,e,s){this.$emit("setThrottleGroup",{infoHash:this.torrent.infoHash,id:t,subId:e,level:s})},saveTorrentFile(){this.$emit("saveTorrentFile",this.torrent.infoHash)},play(t,e){this.$emit("play",t,e)},copyMagnetURI(){let t=this.torrent.alphabizURI||this.torrent.magnetURI;t||(t="magnet:?xt=urn:btih:"+this.torrent.infoHash,this.torrent.name&&(t+="&dn="+encodeURIComponent(this.torrent.name))),Object(c["b"])(t),this.$q.notify(this.$t("text_copied"))},showPostInfo(){this.$emit("showPostInfo",this.torrent.fromPost)},showOriginTorrent(){this.$emit("showOriginTorrent",this.torrent)},openFile(){1===this.torrent.files.length?this.io.emit("open-external-file",this.torrent.files[0].path,this.torrent.infoHash):this.showDirectory()},showDirectory(){this.$emit("showDirectory",this.torrent)},showPaymentPannel(t){this.$emit("showPaymentPannel",{infoHash:this.torrent.infoHash,torrentName:this.torrent.name,peerId:t.id,address:t.address,remoteUser:t.user,remoteSubId:t.subId})},showQuickStart(){this.$emit("showQuickStart",this.torrent)},saveFile(t){if(this.isCapacitor)return this.$emit("saveFile",t.path);this.$emit("saveFile",t)},saveZip(){this.$emit("saveZip")}},watch:{torrentStatus(t,e){e!==t&&this.$emit("sortByStatus")}},mounted(){this.loading=this.torrent.loading}},p=u,m=(s("98d3"),s("2877")),g=s("f09f"),f=s("a370"),b=s("58ea"),v=s("0016"),y=s("05c0"),_=s("4e73"),w=s("1c1c"),C=s("66e5"),$=s("6b1d"),k=s("4074"),x=s("9c40"),q=s("2c91"),S=s("b498"),P=s("6a67"),T=s("7f67"),I=s("eebe"),O=s.n(I),U=Object(m["a"])(p,i,a,!1,null,"3b7765eb",null);e["a"]=U.exports;O()(U,"components",{QCard:g["a"],QCardSection:f["a"],QCircularProgress:b["a"],QIcon:v["a"],QTooltip:y["a"],QMenu:_["a"],QList:w["a"],QItem:C["a"],QLinearProgress:$["a"],QItemSection:k["a"],QBtn:x["a"],QSpace:q["a"],QColor:S["a"],QBtnToggle:P["a"]}),O()(U,"directives",{ClosePopup:T["a"]})},"284d":function(t,e,s){"use strict";var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"col-12 row"},[s("q-input",{staticClass:"q-mt-sm setting-number-input",attrs:{type:"number",dense:"",outlined:"",hint:t.label,rules:t.rules},on:{blur:t.onBlur},nativeOn:{paste:function(t){t.stopPropagation()}},scopedSlots:t._u([t.dice?{key:"append",fn:function(){return[s("q-icon",{staticClass:"cursor-pointer",attrs:{name:"casino"},on:{click:t.setRandom}},[s("q-tooltip",[t._v(t._s(t.$t("random")))])],1)]},proxy:!0}:null],null,!0),model:{value:t.number,callback:function(e){t.number=t._n(e)},expression:"number"}})],1)},a=[],o=(s("ddb0"),{props:{value:Number,keyName:String,label:String,dice:{type:Array,required:!1},rules:{type:Array,default:()=>[]},min:{type:Number,default:1}},computed:{number:{get(){return this.value},set(t){this.onChange(t)}},minValue(){return Array.isArray(this.dice)?this.dice[0]:this.min}},methods:{isValid(t){for(const e of this.rules)if("function"===typeof e){const s=e(t);if(!0!==s)return!1}return!0},onChange(t){if(""===t)return this.$emit("change",this.keyName,this.minValue);this.$emit("change",this.keyName,t)},onBlur(){this.isValid(this.value)||this.$emit("change",this.keyName,this.minValue)},setRandom(){if(!this.dice||!this.dice.length)return;const[t,e]=this.dice;return this.onChange(Math.floor(Math.random()*(e-t)+t))}}}),n=o,r=(s("b35b"),s("2877")),l=s("27f9"),c=s("0016"),d=s("05c0"),h=s("eebe"),u=s.n(h),p=Object(r["a"])(n,i,a,!1,null,"67993ab0",null);e["a"]=p.exports;u()(p,"components",{QInput:l["a"],QIcon:c["a"],QTooltip:d["a"]})},"2d04":function(t,e,s){"use strict";var i=s("1b40"),a=s("2b0e"),o=s("0613"),n=s("ff52"),r=s("0967"),l=s("2a19"),c=s("436b"),d=s("8847"),h=s("849b"),u=s("2ef0"),p=s("16ed"),m=s("a76d"),g=function(t,e,s,i){var a,o=arguments.length,n=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,s):i;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)n=Reflect.decorate(t,e,s,i);else for(var r=t.length-1;r>=0;r--)(a=t[r])&&(n=(o<3?a(n):o>3?a(e,s,n):a(e,s))||n);return o>3&&n&&Object.defineProperty(e,s,n),n},f=function(t,e,s,i){function a(t){return t instanceof s?t:new s((function(e){e(t)}))}return new(s||(s=Promise))((function(s,o){function n(t){try{l(i.next(t))}catch(e){o(e)}}function r(t){try{l(i["throw"](t))}catch(e){o(e)}}function l(t){t.done?s(t.value):a(t.value).then(n,r)}l((i=i.apply(t,e||[])).next())}))};const b=!!r["b"].is.electron;let v;b&&(v=s("34bb").ipcRenderer);const y={data(){return{removeOnAuthStateChangedListener:null}},created(){console.log("SignOutHandlerMixinSignOutHandlerMixin"),this.removeOnAuthStateChangedListener=this.$amplify.addOnAuthStateChangedListener((t=>{"signedOut"===t&&this.onDiscard()}))},beforeDestroy(){this.removeOnAuthStateChangedListener&&this.removeOnAuthStateChangedListener()}};let _=class extends a["a"]{constructor(){super(...arguments),this.loading=!1,this.changes=new Map,this.settings={},this.languages=p["a"],this.changed=!1}get language(){return this.settings.language}set language(t){d["b"].locale=t,b&&v.send("change-app-i18n",t),this.storeChange("language",t)}get darkMode(){return this.settings.darkMode}set darkMode(t){n["a"].set(t===m["a"].system?"auto":t===m["a"].dark),this.storeChange("darkMode",t)}t(t,...e){return d["b"].t(t,...e)}resetChange(){this.changes.clear(),this.changed=!1,this.loading=!1}storeChange(t,e){console.tag("Setting",t).log(e),this.changes.set(t,e),this.$set(this.settings,t,e),this.changed=!0}notify(t){l["a"].create({message:t,position:"bottom-right",type:"positive",timeout:2e3})}syncSetting(){return f(this,void 0,void 0,(function*(){const t=yield o["a"].dispatch("fetchSettings"),e=this.language;this.settings=Object(u["cloneDeep"])(t);const s=t.darkMode===m["a"].system;return n["a"].set(s?"auto":t.darkMode===m["a"].dark),e!==t.language&&(this.language=t.language),t}))}onSubmit(){return f(this,void 0,void 0,(function*(){if(!this.changes.size)return this.resetChange();this.loading=!0;const t=Object.fromEntries(this.changes);t.maximumDownloadNum&&h["a"].emit("update_torrent_settings",{maximumDownloadNum:t.maximumDownloadNum}),yield o["a"].dispatch("set",t),yield this.syncSetting(),this.resetChange(),this.notify(this.t("preferences_set_successfully"))}))}onDiscard(){return f(this,void 0,void 0,(function*(){this.changed&&(yield this.syncSetting(),this.resetChange())}))}onReset(){return f(this,void 0,void 0,(function*(){c["a"].create({title:this.t("reset"),message:this.t("reset_all_settings"),ok:{textColor:"red",color:"unset",flat:!0,label:this.t("reset")},cancel:{textColor:"unset",color:"unset",flat:!0,label:this.t("not_now")}}).onOk((()=>f(this,void 0,void 0,(function*(){this.loading=!0,yield o["a"].dispatch("resetSettings"),yield this.syncSetting(),this.resetChange(),this.notify(this.t("preferences_resetted"))}))))}))}created(){this.settings=Object(u["cloneDeep"])(o["a"].getters.settings)}beforeDestroy(){return this.onDiscard()}beforeRouteLeave(t,e,s){if(!this.changed)return s();c["a"].create({title:this.t("change_not_save"),message:this.t("discard_all_changes"),ok:this.t("stay_in_page"),cancel:this.t("discard"),persistent:!0}).onOk((()=>s(!1))).onCancel((()=>s()))}};_=g([Object(i["a"])({mixins:[y]})],_),e["a"]=_},"2de9":function(t,e,s){"use strict";var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-card",{directives:[{name:"intersection",rawName:"v-intersection",value:{handler:t.triggerPreload,threshold:0},expression:"{ handler: triggerPreload, threshold: 0 }"}],staticClass:"post-card overflow-hidden relative-position column no-wrap",style:{boxShadow:"0 1px 2px rgba(0, 0, 0, 0.24)",border:t.$q.dark.isActive?"1px solid rgba(255,255,255,0.24)":"none"},on:{mouseenter:function(){return t.onCardHover(!0)},mouseleave:function(){return t.onCardHover(!1)}}},[s("img",{staticClass:"absolute-top-left",staticStyle:{filter:"blur(24px)",transform:"scale(1.25)",opacity:"0.08"},attrs:{src:t.post.image,loading:"lazy"},on:{click:t.popupImage,error:t.onImageError,load:t.onImageLoaded}}),t.post.channel?s("div",[t.hideChannel?t._e():s("q-card-section",{staticClass:"post-channel-info no-wrap overflow-hidden row items-center"},[s("div",{staticClass:"channel cursor-pointer row items-center no-wrap",on:{click:t.toChannelPage}},[s("q-avatar",{staticClass:"shadow-2",staticStyle:{background:"#282828"},attrs:{size:"18"}},[t.isLoadedChannelImage?s("img",{attrs:{src:t.post.channel.image},on:{error:t.onChannelAvatarError,load:t.onChannelAvatarLoaded}}):t._e(),t.isLoadedChannelImage?t._e():s("q-icon",{staticStyle:{color:"#ccc"},attrs:{name:"subscriptions",size:"30px"}})],1),s("div",{staticClass:"channel-title q-ml-md ellipsis-2-lines",attrs:{title:t.post.channel.title}},[t._v("\n          "+t._s(t.post.channel.title||t.$t("loading"))+"\n        ")]),t.post.channel.hidden?s("span",{staticClass:"hidden-info text-grey q-ml-xs"},[t._v("("+t._s(t.$t("private_channel"))+")")]):t._e()],1),s("q-space"),s("FollowButton",{attrs:{id:t.post.channel.id,disableFollow:t.disableFollow}})],1),s("q-separator",{directives:[{name:"show",rawName:"v-show",value:!t.hideChannel,expression:"!hideChannel"}],staticStyle:{margin:"0 -4px"}})],1):t._e(),s("q-card-section",{staticClass:"post-info q-pa-none overflow-hidden",class:t.$q.screen.width>=790?["row","no-wrap","justify-start","items-stretch"]:["column","no-wrap","justify-start","items-center"],style:{maxHeight:t.$q.screen.width>=790?"calc(16px * 2 + 360px)":"unset",flexGrow:1}},[s("div",{staticClass:"image",class:t.$q.screen.width>=790?["q-pa-md"]:["q-pa-sm"]},[s("div",{staticClass:"image-container row justify-center items-center"},[t.allowClickImage?s("img",{attrs:{src:t.post.image,loading:"lazy"},on:{click:t.popupImage,error:t.onImageError,load:t.onImageLoaded}}):t._e(),t.allowClickImage?t._e():s("q-icon",{attrs:{size:"80px",name:"video_file",color:"general"}})],1)]),s("div",{staticClass:"overflow-hidden full-width flex-grow column no-wrap q-pb-md",style:{marginLeft:t.$q.screen.width>=790?"-8px !important":"0"}},[s("div",{staticClass:"desc-main q-pa-sm"},[s("div",{staticClass:"text-bold desc-title row overflow-hidden full-width no-wrap items-center"},[s("div",{staticClass:"post-title q-mr-sm overflow-hidden",attrs:{title:t.post.title}},[s("div",{staticClass:"text-no-wrap ellipsis"},[t._v(t._s(t.post.title))])]),s("q-space"),s("q-btn",{staticClass:"favorite-icon block",attrs:{dense:"",flat:"",color:"primary","text-color":"primary",round:"",icon:t.isFavorite?"star":"star_border"},on:{click:t.setFavorite}},[s("q-tooltip",[t._v(t._s(t.isFavorite?t.$t("remove_from_local_favorites"):t.$t("add_to_local_favorites")))])],1),t.post.channel?s("q-btn",{staticClass:"block",attrs:{dense:"",flat:"",round:"",icon:"more_vert"}},[s("q-menu",[s("q-list",{staticStyle:{"min-width":"100px"}},[s("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:t.follow}},[s("q-item-section",[t._v("\n                    "+t._s(t.followable?t.$t("follow"):t.$t("unfollow"))+"\n                    "+t._s(t.shortChannelTitle)+"\n                  ")])],1),s("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:t.share}},[s("q-item-section",[t._v("\n                    "+t._s(t.$t("share"))+"\n                    "+t._s(t.shortChannelTitle)+"\n                  ")])],1),s("q-separator"),s("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:t.blockChannel}},[s("q-item-section",[t._v("\n                    "+t._s(t.isBlocked?t.$t("unblock"):t.$t("block"))+"\n                    "+t._s(t.shortChannelTitle)+"\n                  ")])],1),s("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:t.blockUser}},[s("q-item-section",[t._v(t._s(t.isBlockedUser?t.$t("unblock_creator"):t.$t("block_creator")))])],1),t.lib.isLibAdmin?[s("q-separator"),s("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:t.takedownPost}},[s("q-item-section",[t._v(t._s(t.$t("takedown_post")))])],1)]:t._e()],2)],1)],1):t._e()],1),s("div",{staticClass:"text-subtitle2 q-mt-xs text-grey desc-time"},[s("span",[t._v(t._s(new Date(t.post.timestamp).toLocaleString()))]),s("q-badge",{staticClass:"q-ml-md bg-primary text-primary"},[t._v("\n            "+t._s(t.post.rate||"G")+"\n            "),s("q-tooltip",t._l(t.getRateText(t.post.rate).split("\n"),(function(e,i){return s("div",{key:i,staticClass:"rate-tip"},[t._v(t._s(e)+"\n              ")])})),0)],1),t.subtitleLang?s("q-btn",{staticClass:"q-ml-sm",attrs:{dense:"",flat:"",size:"xs"}},[s("q-icon",{staticStyle:{"font-size":"22px"},attrs:{name:"subtitles"}}),s("q-tooltip",[t._v(t._s(t.$t("with_subtitle",{language:t.subtitleLang})))])],1):t._e()],1)]),s("div",{staticClass:"overflow-auto q-pa-sm",staticStyle:{"flex-grow":"1","flex-shrink":"1"}},[s("div",{staticClass:"full-width overflow-hidden"},t._l((t.post.description||"").split("\n"),(function(e,i){return s("div",{key:i,staticClass:"desc-para"},[t._v(t._s(e)+"\n          ")])})),0)]),s("div",{directives:[{name:"show",rawName:"v-show",value:!t.hideButtons,expression:"!hideButtons"}],staticClass:"text-center post-buttons q-pt-sm"},[t.post.abUrl||t.backAbUrl?s("div",{staticClass:"download-btns"},[t.addedStatus?s("q-btn",{staticClass:"q-px-sm",attrs:{unelevated:"",dense:"",flat:"",ripple:!1,label:"downloading"===t.addedStatus?t.$t("downloading"):t.$t("completed"),icon:"downloading"===t.addedStatus?"download":"done","text-color":"primary",color:"primary"},on:{click:t.toTaskInfo}},[s("q-tooltip",[t._v(t._s(t.$t("lib_already_added"))),s("br"),t._v(t._s(t.$t("click_to_task")))])],1):s("q-btn",{staticClass:"q-px-sm",attrs:{unelevated:"",dense:"","text-color":"primary",color:"primary",label:t.$t("download"),icon:"download"},on:{click:t.download}}),t.playFile||t.preloadFailed?!t.playFile&&t.preloadFailed?s("q-btn",{staticClass:"q-ml-sm q-px-sm cursor-inherit",attrs:{unelevated:"",dense:"",flat:"",ripple:!1,label:t.$t("play_while_downloading"),icon:"ondemand_video","text-color":"primary",color:"primary"}},[s("q-tooltip",[t._v(t._s(t.$t("post_preload_failed")))])],1):s("q-btn",{staticClass:"q-ml-sm q-px-sm",attrs:{unelevated:"",dense:"",label:t.$t("play"),icon:"play_arrow","text-color":"primary",color:"primary"},on:{click:t.play}}):s("q-btn",{staticClass:"q-ml-sm q-px-sm",attrs:{unelevated:"",dense:"",label:t.$t("play_while_downloading"),icon:"ondemand_video","text-color":"primary",color:"primary"},on:{click:t.triggerPlay}})],1):s("div",{staticClass:"no-ab-url"},[s("q-btn",{attrs:{unelevated:"",dense:"",disable:"",label:t.$t("loading")}})],1)])])]),t.screen$xs?s("div",{staticClass:"dialog-actions"},[s("q-separator"),s("q-card-section",{staticClass:"flex q-py-sm"},[s("q-space"),s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{icon:"close",label:t.$t("cancel"),color:"general","text-color":"general",unelevated:""}})],1)],1):t._e()],1)},a=[],o=(s("5319"),s("e01a"),s("0613")),n=s("ed08"),r=s("c428"),l=s("71ac"),c=s("4aad"),d=s("849b"),h=s("bae3"),u=s("cdde"),p=s("20fc"),m=s("6ea7"),g=s("826a"),f=s("a939"),b=s("708e"),v=s.n(b),y=s("2b0e");const _=y["a"].observable([]);d["a"].on("preload-failed",(t=>{console.log("preload failed",t),_.includes(t)||(_.push(t),console.log(_))})),d["a"].on("preload-done",(t=>{console.log("preload done",t),_.includes(t)&&_.splice(_.indexOf(t),1)}));const w="requestIdleCallback"in window?requestIdleCallback:t=>setTimeout(t,100);async function C({url:t,postTitle:e}){if(!_.includes(t))return new Promise((s=>{w((()=>{d["a"].emit("preload-task",{url:t,postTitle:e}),s()}))}))}var $=s("77d8");const k=document.querySelector("#q-app"),x=t=>new Promise((e=>setTimeout(e,t)));var q={name:"PostCard",inject:["rootApp","io"],components:{FollowButton:f["a"]},props:{post:{type:Object,required:!0},hideChannel:{type:Boolean},hideButtons:{type:Boolean},disableFollow:{type:Boolean}},data(){return{scrollRoot:k,postCardHover:!1,allowClickImage:!0,animating:!1,followBtnHover:!1,pending:!1,favoriteNotifyFns:[],backAbUrl:"",isLoadedChannelImage:!0,isFavorite:l["a"].isFavorite(this.post.id),lib:c["a"],preloadTriggered:!1,notAvailable:_}},computed:{followable(){return!c["a"].followingChannels.find((t=>{var e;return t.id===(null===(e=this.post.channel)||void 0===e?void 0:e.id)}))},isBlocked(){var t,e;return null===(t=c["a"].userData.blockChannels)||void 0===t?void 0:t.includes(null===(e=this.post.channel)||void 0===e?void 0:e.id)},isBlockedUser(){var t,e;return null===(t=c["a"].userData.blockUsers)||void 0===t?void 0:t.includes(null===(e=this.post.channel)||void 0===e?void 0:e.creator)},followBtnLabel(){return this.followable?this.$t("follow"):this.followBtnHover?this.$t("unfollow"):this.$t("following")},abKey(){const t=this.post.abUrl||this.backAbUrl;return t?Object(r["a"])(t.includes("://")?t:decodeURIComponent(t)):""},addedStatus(){var t;return(null===(t=c["a"].addedPostMap[this.abKey])||void 0===t?void 0:t.type)||!1},shortChannelTitle(){return this.post.channel&&this.post.channel.title?this.post.channel.title.length>12?this.post.channel.title.substring(0,10)+"...":this.post.channel.title:""},playFile(){var t;return null===(t=c["a"].addedPostMap[this.abKey])||void 0===t?void 0:t.playFile},settings(){var t,e;const s=(null===(t=this.post)||void 0===t||null===(e=t._)||void 0===e?void 0:e["#"])||this.post.soul,i=o["a"].state.setting,a={downloadDirectory:i.downloadDirectory,uploadSpeed:i.uploadSpeed,downloadSpeed:i.downloadSpeed,maximumDownloadNum:i.maximumDownloadNum,maximumConnectionsNum:i.maximumConnectionsNum,payedUserShareRadix:i.payedUserShareRadix,trackers:i.trackerList||[],postTitle:Object(h["b"])(this.post.title)};return s&&(a.fromPost=s),a},subtitleLang(){return Object(m["a"])(this.post.subtitleList)},preloadFailed(){return this.notAvailable.includes(this.post.abUrl||this.backAbUrl)}},methods:{onCardHover(t){this.postCardHover=t},getRateText(t="G"){switch(t){case"G":return this.$t("rate_g_desc");case"PG":return this.$t("rate_pg_desc");case"PG-13":return this.$t("rate_pg_13_desc");case"R":return this.$t("rate_r_desc");case"NC-17":return this.$t("rate_nc_17_desc")}return this.$t("rate_g_desc")},confirm(t,e={ok:"",cancel:"",message:""}){const s={title:t,ok:e.ok||this.$t("ok"),cancel:e.cancel||this.$t("cancel")};return e.message&&(s.message=e.message),new Promise((t=>{this.$q.dialog(s).onOk((()=>t(!0))).onDismiss((()=>t(!1)))}))},popupImage(){console.log("popup",this.allowClickImage),this.allowClickImage&&this.$emit("preview",this.post.image)},async playAnimation(t,e="#downloading"){if(this.animating)return;this.animating=!0;const s=document.querySelector(e),i=s?s.getBoundingClientRect():{x:0,y:t.clientY,width:0,height:0},a={left:t.clientX-36+"px",top:t.clientY-36+"px"},o={left:i.x+i.width/3-36+"px",top:i.y+i.height/2-36+"px"},n=document.createElement("i");n.classList.add("q-icon","material-icons","text-primary"),n.innerHTML="video_file",n.style.position="absolute",n.style.fontSize="72px",n.style.left=a.left,n.style.top=a.top,n.style.opacity=0,n.style.transform="scale(2.5)",n.style.transition="0.4s ease",document.body.appendChild(n),await x(0),n.style.opacity=1,n.style.transform="scale(1)",await x(500),n.style.transition="1s ease",n.style.left=o.left,n.style.top=o.top,n.style.transform="scale(0.5)",n.style.opacity=0,await x(600),this.animating=!1,document.body.removeChild(n)},async triggerPlay(t){if(!o["a"].getters.accountUserInfo||!o["a"].getters.accountUserInfo.sub)return this.$q.dialog({message:this.$t("login_to_continue"),ok:this.$t("ok")});const e=this.post.abUrl||this.backAbUrl,i=e.includes(":")?e:decodeURIComponent(e);if("string"!==typeof i||!i.startsWith(v.a.shortProtocol+"://")&&!i.startsWith(v.a.protocol+"://")&&!i.startsWith("magnet:"))return this.$q.notify(this.$t("invalid_download_url")+": "+i);if(!Object(n["isElectron"])()&&!Object($["a"])()){const t=s("ac4e").wtClient;if(t.torrents[0]){const e=s("34f8").default;if(this.addedStatus)return e();const i=await this.confirm(this.$t("remove_old_task")+"?",{message:this.$t("remove_old_task_desc")});if(!i)return;t.torrents[0]&&await new Promise((e=>{t.torrents[0].destroy(e)}))}}this.playAnimation(t,"#drawer-player"),await x(600);const a=i.startsWith(v.a.shortProtocol+"://")?i.replace(v.a.shortProtocol+"://",`${v.a.protocol}://${encodeURIComponent(this.post.title)}/`):i;if(this.io.emit("download-and-play",{type:"magnet",url:a,token:a,subtitleList:Object(m["e"])(this.post.subtitleList),...this.settings}),Object(n["isElectron"])()||Object($["a"])()){var r;const t=await Object(p["a"])(a);if(!t)return;const e=null===(r=t.match(/([0-9a-fA-F]{40})/))||void 0===r?void 0:r[1];e&&o["a"].dispatch("remotePlay",e)}else{const{default:t}=s("34f8"),{wtClient:e}=s("ac4e"),i=setInterval((()=>{e.torrents.length&&(clearInterval(i),t())}),100)}},async download(t){if(!o["a"].getters.accountUserInfo||!o["a"].getters.accountUserInfo.sub)return this.$q.dialog({message:this.$t("login_to_continue"),ok:this.$t("ok")});const e=this.post.abUrl||this.backAbUrl,i=e.includes(":")?e:decodeURIComponent(e);if("string"!==typeof i||!i.startsWith(v.a.shortProtocol+"://")&&!i.startsWith(v.a.protocol+"://")&&!i.startsWith("magnet:"))return this.$q.notify(this.$t("invalid_download_url")+": "+i);const a=i.startsWith(v.a.shortProtocol+"://")?i.replace(v.a.shortProtocol+"://",`${v.a.protocol}://${encodeURIComponent(this.post.title)}/`):i;console.log(a),console.group("subtitle"),console.log(this.post.subtitleList),console.table(Object(m["e"])(this.post.subtitleList)),console.groupEnd();const r={type:"url",url:a,token:a,subtitleList:Object(m["e"])(this.post.subtitleList),...this.settings};if(!Object(n["isElectron"])()){const t=s("ac4e").wtClient;if(t.torrents[0]){const e=s("34f8").default;if(this.addedStatus)return e();const i=await this.confirm(this.$t("remove_old_task"),{message:this.$t("remove_old_task_desc")});if(!i)return;t.torrents[0]&&await new Promise((e=>{t.torrents[0].destroy(e)}))}}this.io.emit("download_torrent",r),this.playAnimation(t,Object(n["isElectron"])()?"#downloading":"#task-management")},checkChannel(){var t;const e=null===(t=this.post.channel)||void 0===t?void 0:t.id,s=c["a"].channelList.find((t=>t.id===e));return!(!e||!s)||(this.$q.dialog({title:this.$t("channel_not_found"),message:this.$t("cannot_get_channel_info"),ok:this.$t("ok")}),!1)},async follow(){if(this.pending)return;if(!this.checkChannel())return;const t=this.post.channel.id,e=!c["a"].followingChannels.find((e=>e&&e.id===t));if(!e){const t=await new Promise((t=>{this.$q.dialog({title:this.$t("unfollow"),message:this.$t("unfollow_confirm"),ok:this.$t("unfollow"),cancel:this.$t("cancel")}).onOk((()=>t(!1))).onDismiss((()=>t(!0)))}));if(t)return}this.pending=!0,setTimeout((()=>{!c["a"].followingChannels.find((e=>e.id===t))===e&&(console.log("follow failed!",t,e),e?c["a"].followChannel(t):c["a"].unfollowChannel(t)),this.pending=!1}),2e3),console.log("follow click",e),e?c["a"].followChannel(t):c["a"].unfollowChannel(t)},async share(){if(!this.checkChannel())return;const t=`${v.a.shortProtocol}-library://channel/${Object(h["b"])(this.post.channel.title)}/${this.post.channel.id}`;console.log("share",t);const e=await Object(p["a"])(t);if(console.log("converted url"),!e)return this.$q.notify(this.$t("uri_copy_failed"));Object(u["a"])(e).then((()=>{this.$q.notify(this.$t("copied"))}))},async blockChannel(){if(!this.checkChannel())return;if(console.log("block channel",this.post.channel.id,this.isBlocked),this.isBlocked)return c["a"].unblockChannel(this.post.channel.id).then((t=>{console.log("unblock channel result",t)}));const t=await this.confirm(this.$t("block_channel"),{message:this.$t("block_channel_confirm"),ok:this.$t("block")});t&&c["a"].blockChannel(this.post.channel.id).then((t=>{console.log("block channel result",t)}))},async blockUser(){var t;if(console.log("block user",null===(t=this.post.channel)||void 0===t?void 0:t.creator,this.isBlockedUser),!this.post.channel||!this.post.channel.creator)return;if(this.isBlockedUser)return c["a"].unblockUser(this.post.channel.creator).then((t=>{console.log("unblock user result",t)}));const e=await this.confirm(this.$t("block_creator"),{message:this.$t("block_creator_confirm"),ok:this.$t("block")});e&&c["a"].blockUser(this.post.channel.creator).then((t=>{console.log("block user result",t)}))},toChannelPage(){this.checkChannel()&&this.$emit("to-channel",this.post.channel)},toTaskInfo(){var t;const e=null===(t=this.post.channel)||void 0===t?void 0:t.soul;let s=`/downloader?currentTab=${this.addedStatus}&abKey=${this.abKey}`;e&&(s+=`&channel=${encodeURIComponent(e)}`),this.post.id&&(s+=`&postId=${this.post.id}`),e&&this.post.id&&(s+=`&soul=${encodeURIComponent(e+"/posts/"+this.post.id)}`),console.log("to",this.abKey,this.addedStatus,e,this.post.id),console.log(s),this.$router.push(s)},setFavorite(){const t=this.post.id;var e,s,i,a,o,n,r,c,d,h,u,p,m,g,f;this.isFavorite?l["a"].remove({id:t},(()=>{this.isFavorite=l["a"].isFavorite(t)})):l["a"].add({id:this.post.id,title:this.post.title,description:this.post.description,image:this.post.image,abUrl:this.post.abUrl||this.backAbUrl,soul:null===(e=this.post)||void 0===e||null===(s=e._)||void 0===s?void 0:s["#"],subtitleList:this.post.subtitleList,channel:{id:null===(i=this.post)||void 0===i||null===(a=i.channel)||void 0===a?void 0:a.id,title:null===(o=this.post)||void 0===o||null===(n=o.channel)||void 0===n?void 0:n.title,description:null===(r=this.post)||void 0===r||null===(c=r.channel)||void 0===c?void 0:c.description,image:null===(d=this.post)||void 0===d||null===(h=d.channel)||void 0===h?void 0:h.image,soul:null===(u=this.post)||void 0===u||null===(p=u.channel)||void 0===p||null===(m=p._)||void 0===m?void 0:m["#"],creator:null===(g=this.post)||void 0===g||null===(f=g.channel)||void 0===f?void 0:f.creator}});this.isFavorite=l["a"].isFavorite(t)},play(){if(!Object(n["isElectron"])()&&!Object($["a"])()&&this.addedStatus){const t=s("34f8").default;return t()}const{infoHash:t,playFile:e}=c["a"].addedPostMap[this.abKey]||{};console.log("play",t,e);const i=e.path||e;o["a"].dispatch("remotePlay",t),d["a"].emit("play-torrent",{infoHash:t,filepath:i})},onChannelAvatarError(){this.isLoadedChannelImage=!1},takedownPost(){if(!c["a"].isLibAdmin||!this.post.id)return;if(20!==this.post.id.length)return this.$q.notify("Cannot parse post id");const t=[{value:"Serious Violation",label:this.$t("serious_violation")},{value:"Copyright Disputes",label:this.$t("copyright_disputes")},{value:"Adults Only",label:this.$t("adults_only")}];this.$q.dialog({options:{model:t[0].value,type:"radio",items:t},message:this.$t("select_takedown_reason"),ok:this.$t("take_down"),cancel:this.$t("cancel")}).onOk((t=>{console.log(t),["Serious Violation","Copyright Disputes","Adults Only"].includes(t)&&c["a"].takedown("post",this.post.id,t).then((()=>{this.$q.notify(this.$t("success"))}))}))},onChannelAvatarLoaded(t){t.target.src===this.post.channel.image&&(this.isLoadedChannelImage=!0)},onImageError(){this.allowClickImage=!1},onImageLoaded(t){t.target.src===this.post.image&&(this.allowClickImage=!0)},triggerPreload({isIntersecting:t}){if(t&&!this.preloadTriggered&&this.settings.postTitle)return this.preloadFailed?console.log("skip preload failed",this.settings.postTitle):this.addedStatus?console.log("skip added",this.settings.postTitle):void((this.post.abUrl||this.backAbUrl)&&(console.log(`Scroll into view ${this.settings.postTitle}`),this.preloadTriggered=!0,C({url:this.post.abUrl||this.backAbUrl,postTitle:this.settings.postTitle})))}},activated(){var t,e;this.post.abUrl||(console.log("no aburl",{...this.post}),null!==(t=this.post)&&void 0!==t&&null!==(e=t.channel)&&void 0!==e&&e.soul&&this.post.id&&g["v"].get(this.post.channel.soul+"/posts/"+this.post.id).on(((t,e,s,i)=>{t&&t.abUrl&&(console.log("Get abUrl for",this.post.id,t.abUrl),this.backAbUrl=t.abUrl,i.off())})));this.isFavorite=l["a"].isFavorite(this.post.id)}},S=q,P=(s("bca4"),s("2877")),T=s("f09f"),I=s("a370"),O=s("cb32"),U=s("0016"),L=s("2c91"),j=s("eb85"),A=s("9c40"),R=s("05c0"),B=s("4e73"),D=s("1c1c"),Q=s("66e5"),F=s("4074"),E=s("58a8"),V=s("24e8"),N=s("a12b"),z=s("9748"),H=s("7f67"),M=s("eebe"),W=s.n(M),G=Object(P["a"])(S,i,a,!1,null,"1374bed6",null);e["a"]=G.exports;W()(G,"components",{QCard:T["a"],QCardSection:I["a"],QAvatar:O["a"],QIcon:U["a"],QSpace:L["a"],QSeparator:j["a"],QBtn:A["a"],QTooltip:R["a"],QMenu:B["a"],QList:D["a"],QItem:Q["a"],QItemSection:F["a"],QBadge:E["a"],QDialog:V["a"],QVirtualScroll:N["a"]}),W()(G,"directives",{Intersection:z["a"],ClosePopup:H["a"]})},"2e92":function(t,e,s){"use strict";var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-select",{staticClass:"setting-select",class:{caption:t.caption},attrs:{value:t.displayLabel,options:t.options,label:t.label,outlined:"",dense:"","emit-value":"","data-cy":"select-direct"},on:{input:t.emitChange},scopedSlots:t._u([t.caption?{key:"option",fn:function(e){return[s("q-item",t._g(t._b({},"q-item",e.itemProps,!1),e.itemEvents),[s("q-item-section",[s("q-item-label",{domProps:{innerHTML:t._s(e.opt.label)}}),e.opt.caption?s("q-tooltip",t._l(e.opt.caption.split("\n"),(function(e,i){return s("span",{key:i,staticClass:"tooltip"},[t._v(t._s(e))])})),0):t._e()],1)],1)]}}:null],null,!0)})},a=[],o=(s("ddb0"),{model:{prop:"value",event:"change"},props:{value:String,options:Array,label:String,caption:Boolean},computed:{displayLabel(){for(const t of this.options)if(t.value===this.value)return t.label;return this.value}},methods:{emitChange(t){this.$emit("change",t)}}}),n=o,r=(s("e38a"),s("2877")),l=s("ddd8"),c=s("66e5"),d=s("4074"),h=s("0170"),u=s("05c0"),p=s("eebe"),m=s.n(p),g=Object(r["a"])(n,i,a,!1,null,"58d8362a",null);e["a"]=g.exports;m()(g,"components",{QSelect:l["a"],QItem:c["a"],QItemSection:d["a"],QItemLabel:h["a"],QTooltip:u["a"]})},3013:function(t,e,s){"use strict";let i=null;e["a"]={data(){return{showBackToTop:!1,scrollContentSelector:".virtual-scroll-grid-wrapper"}},methods:{handleBackToTop(){if(this.showBackToTop){const t=this.$el.querySelector(this.scrollContentSelector);if(!t)return;t.scrollTop=0}else{if(!this.$refs.vscroll)return;this.$refs.vscroll.scrollTo(0,"start")}}},mounted(){const t=this.$el.querySelector(this.scrollContentSelector),e=()=>{this.showBackToTop=t.scrollTop>0};t&&(t.addEventListener("scroll",e),i=()=>t.removeEventListener("scroll",e))},beforeDestroy(){i&&i()}}},"344f":function(t,e,s){"use strict";s("572e")},"345c":function(t,e,s){},"34f8":function(t,e,s){"use strict";s.r(e),s.d(e,"default",(function(){return mt}));s("5319"),s("d9e2");var i=s("ac4e"),a=s("2a19"),o=s("a18c"),n=s("8847"),r=s("0613"),l=s("f0e2"),c=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-page",{staticStyle:{position:"relative"}},[s("input",{ref:"file",staticStyle:{display:"none"},attrs:{id:"media-file-upload",type:"file","data-cy":"file-input"},on:{input:t.manualAddFile}}),s("input",{ref:"subtitle",staticStyle:{display:"none"},attrs:{type:"file",accept:".srt,.vtt"},on:{input:t.manualAddSubtitle}}),s("div",{attrs:{id:"video-container",lang:t.lang}},[s("video",{ref:"video",staticClass:"video-js vjs-default-skin vjs-16-9 vjs-big-play-centered vjs-fluid",staticStyle:{height:"100%"},attrs:{crossorigin:"anonymous",id:"my-video"}})]),s("audio-info",{attrs:{show:t.isAudio}}),s("video-splash",{attrs:{show:t.showSplash,videoLoadingHint:t.videoLoadingHint}}),s("advanced-options",{attrs:{show:t.showAdvancedOptions,advancedOptions:t.advancedOpt},on:{close:function(){return t.toggleAdvancedOptions(!1)}}})],1)},d=[];s("ddb0"),s("2b3d"),s("9861"),s("e9c4");const h=s("9b0f"),u=s("a32b"),p=s("1c37"),m=s("acf9");function g(t){const e=t.path||t;if(console.log(e),!h.existsSync(e)&&!h.existsSync(e+".downloading"))return[];const s=u.dirname(t.path),i=u.extname(t.path),a=t.name.substring(0,t.name.lastIndexOf("."));console.log(s,a,i);const o=v(s,a),n=b(s,o),r=y(s,a),l=f(s,r);return[...n,...l]}function f(t,e){const s=[];try{e.forEach(((e,i,a)=>{a[i]=t+"/"+e;const o=h.readFileSync(a[i]),n=m.decode(o,p.detect(o)).replace(/^{[\\0-9A-Za-z&]*}/gm,""),r=1===(e.match(/\./g)||[]).length?e:u.extname(e.substring(0,e.lastIndexOf("."))).substring(1)+".srt";s.push({src:URL.createObjectURL(new Blob([_(n)])),label:r,path:t+"\\"+e})}))}catch(i){console.log(i)}return console.log(s),s}function b(t,e){const s=[];try{e.forEach(((e,i,a)=>{a[i]=t+"/"+e;const o=h.readFileSync(a[i]),n=p.analyse(o);console.log("encoding",n);const r=m.decode(o,p.detect(o)).replace(/^{[\\0-9A-Za-z&]*}/gm,""),l=1===(e.match(/\./g)||[]).length?e:u.extname(e.substring(0,e.lastIndexOf("."))).substring(1)+".vtt";s.push({src:URL.createObjectURL(new Blob([r])),label:l,path:t+"\\"+e})}))}catch(i){console.log(i)}return console.log(s),s}function v(t,e){let s;try{s=h.readdirSync(t),s=s.filter((t=>t.startsWith(e)&&t.endsWith(".vtt")))}catch(i){console.log(i)}return s}function y(t,e){let s;try{s=h.readdirSync(t),s=s.filter((t=>t.startsWith(e)&&t.endsWith(".srt")))}catch(i){console.log(i)}return s}function _(t){var e=t.replace(/\r+/g,"");e=e.replace(/^\s+|\s+$/g,"");var s=e.split("\n\n"),i="";if(s.length>0){i+="WEBVTT\n\n";for(var a=0;a<s.length;a+=1)i+=w(s[a])}return i}function w(t){var e="",s=t.split(/\n/);while(s.length>3){for(var i=3;i<s.length;i++)s[2]+="\n"+s[i];s.splice(3,s.length-3)}var a=0;if(!s[0].match(/\d+:\d+:\d+/)&&s[1].match(/\d+:\d+:\d+/)&&(e+=s[0].match(/\w+/)+"\n",a+=1),!s[a].match(/\d+:\d+:\d+/))return"";var o=s[1].match(/(\d+):(\d+):(\d+)(?:,(\d+))?\s*--?>\s*(\d+):(\d+):(\d+)(?:,(\d+))?/);return o?(e+=o[1]+":"+o[2]+":"+o[3]+"."+o[4]+" --\x3e "+o[5]+":"+o[6]+":"+o[7]+"."+o[8]+"\n",a+=1,s[a]&&(e+=s[a]+"\n\n"),e):""}const C=s("ed08").isElectron();function $(t){if(!C||"string"!==typeof t)return t;const e=s("a32b"),i=e.basename(t);return{name:i,path:t}}var k=s("307e"),x=s("4d5f"),q=s("41ed"),S=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{directives:[{name:"show",rawName:"v-show",value:t.show,expression:"show"}],attrs:{id:"video-splash"}},[s("div",{staticClass:"loading"},[s("q-circular-progress",{staticClass:"q-ma-md",attrs:{indeterminate:"",size:"24px",color:"warning"}}),s("p",[t._v(t._s(t.videoLoadingHint))])],1)])])},P=[],T={name:"VideoSplash",props:{show:{type:Boolean},videoLoadingHint:{type:String}},data(){return{}},created(){},mounted(){},computed:{},methods:{}},I=T,O=(s("e5e5"),s("2877")),U=s("58ea"),L=s("eebe"),j=s.n(L),A=Object(O["a"])(I,S,P,!1,null,"bcdd35fc",null),R=A.exports;j()(A,"components",{QCircularProgress:U["a"]});var B=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{directives:[{name:"show",rawName:"v-show",value:t.show,expression:"show"}],staticClass:"audio-info-container"},[s("p",{staticClass:"info"},[t._v(t._s(t.$t("this_is_an_audio_file")))]),s("img",{attrs:{src:t.icon,alt:"favicon",width:"100px"}})])])},D=[],Q={name:"AudioInfo",components:{},props:{show:{type:Boolean}},data(){return{icon:"developer/assets/icon-256.png"}},created(){},mounted(){},computed:{},methods:{}},F=Q,E=(s("6082"),Object(O["a"])(F,B,D,!1,null,"d5366250",null)),V=E.exports,N=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-dialog",{attrs:{value:t.show},on:{input:t.close}},[s("q-card",{staticStyle:{width:"600px","max-width":"80vw","overflow-x":"hidden"}},[s("q-card-section",{staticClass:"row"},[s("div",{staticClass:"text-h6 col-12"},[t._v(t._s(t.$t("advanced_options")))])]),s("q-card-section",{staticClass:"row"},[s("div",{staticClass:"col-4 justify-start q-pl-xl q-my-md"},[t._v(t._s(t.advancedOptions[0].name)+":")]),s("div",{staticClass:"col-8 justify-start q-pl-md q-my-md",staticStyle:{"word-wrap":"break-word"}},[t._v(t._s(t.advancedOptions[0].value))]),s("div",{staticClass:"col-4 justify-start q-pl-xl q-my-md"},[t._v(t._s(t.advancedOptions[1].name)+":")]),s("div",{staticClass:"col-8 justify-start q-pl-md q-my-md",staticStyle:{"word-wrap":"break-word"}},[t._v(t._s(t.advancedOptions[1].value))]),s("div",{staticClass:"col-4 justify-start q-pl-xl q-my-md"},[t._v(t._s(t.advancedOptions[2].name)+":")]),s("div",{staticClass:"col-8 justify-start q-pl-md q-my-md",staticStyle:{"word-wrap":"break-word"}},t._l(t.advancedOptions[2].value,(function(e,i){return s("div",{key:i,staticClass:"license-section"},[t._v("\n          "+t._s(e.label)+"\n        ")])})),0)])],1)],1)},z=[],H={name:"AdvancedOptions",components:{},props:{show:Boolean,advancedOptions:Array},data(){return{}},created(){},mounted(){},computed:{},methods:{close(){this.$emit("close")}}},M=H,W=s("24e8"),G=s("f09f"),K=s("a370"),Z=Object(O["a"])(M,N,z,!1,null,"5c3e2e5d",null),J=Z.exports;j()(Z,"components",{QDialog:W["a"],QCard:G["a"],QCardSection:K["a"]});var Y=s("708e"),X=s.n(Y),tt=s("0967"),et=s("77d8");const st=s("ed08").isElectron();window.videojs=l["default"],s("d80d"),s("01a0"),s("8d5e");const it=X.a.fileName,at={toggleSplash(){},updatePlayer(){}};var ot={name:"Player",inject:["rootApp","io"],components:{VideoSplash:R,AudioInfo:V,AdvancedOptions:J},data(){return{player:null,playerOptions:{fill:!1,autoplay:!0,responsive:!0,fluid:!0,preload:"auto",controls:!0,controlBar:{volumePanel:{inline:!1}}},subsBtn:null,progress:[],fileName:"",playerLang:"",playerCacheTime:0,showSplash:!1,videoLoadingHint:"",showAdvancedOptions:!1,isUpdateSubtitle:"",isAudio:!1,isPause:!1}},created(){this.initVideoComponent(),this.playerLang=r["a"].state.setting.language,this.playerCacheTime=r["a"].state.setting.videoCacheTime,window.addEventListener("error",(t=>{console.log("Uncaught global error",t.message,"\nThis has no effect to app and can be ignore")})),st&&(q["ipcRenderer"].once("ask-for-player",(()=>{this.$q.notify({message:this.$t("not_default_player"),actions:[{label:this.$t("dont_show_again"),textColor:"warning",handler:()=>{r["a"].dispatch("set",{dontAskForPlayer:!0})}},{label:this.$t("go_to_settings"),textColor:"warning",handler:()=>{this.$router.push("/basicSetting")}}]}),r["a"].dispatch("set",{dontAskForPlayer:!0})})),this.$root.$on("pause-player-before-close",(()=>{this.player&&(this.isPause=!0,r["a"].state.video.currentVideo.pipStatus&&this.player&&this.player.exitPictureInPicture(),r["a"].state.video.currentVideo.status&&this.player&&this.player.pause())})));for(const t in at)"function"===typeof this[t]&&(at[t]=(...e)=>this[t](...e))},mounted(){console.log("player mounted"),this.loadPlayer(!0)},async activated(){if(this.playerLang!==r["a"].state.setting.language&&(this.playerLang=r["a"].state.setting.language,this.languageChange()),this.playerCacheTime!==r["a"].state.setting.videoCacheTime){console.log("videoCacheTime change",r["a"].state.setting.videoCacheTime),this.playerCacheTime=r["a"].state.setting.videoCacheTime;const t=this.updateCacheRate(r["a"].state.setting.videoCacheTime);if(t){this.updateSrc(r["a"].state.video.currentVideo.url,{clearSubtitle:!1,clearProgress:!1}),this.player.currentTime(r["a"].state.video.currentVideo.currentTime);const t=r["a"].state.video.currentVideo.currentTime/this.player.duration(),e=document.querySelector(".vjs-play-progress");e&&setTimeout((()=>{e.style.width=100*t+"%"}),500)}}if(st||Object(et["a"])()){if(r["a"].state.video.currentVideo.remotePlay){this.isUpdateSubtitle="",this.isPause=!1,this.loadPlayer(!0),this.toggleSplash(!0),this.player.bigPlayButton.hide();const t=setTimeout((()=>{this.videoLoadingHint=this.$t("playing_timeout_hint")}),18e4);q["ipcRenderer"].send("get-stream-address"),q["ipcRenderer"].once("stream-address",((e,s)=>{console.log("got stream address",s),this.toggleSplash(!1),clearTimeout(t);let{address:i,filepath:a}=s;console.log("Stream play, try update player.src",s,"address",i,"filepath",a),a||(a="win32"===process.platform?decodeURI(i).replace("play:///","").replace(/\//g,"\\"):decodeURI(i).replace("play://","")),r["a"].dispatch("currentVideoUrl",i),r["a"].dispatch("currentVideoPath",a),r["a"].dispatch("currentVideoCurrentTime",0);try{this.updateSrc(i),this.isPause?(setTimeout((()=>{this.player.pause()}),1e3),this.isPause=!1):this.player.play(),this.player.readyState()&&r["a"].dispatch("resetRemotePlay"),this.clearOldSubtitle(),this.addSubtitle(a),this.changeSubtitleForLang()}catch(e){console.log("src err",e),r["a"].dispatch("resetRemotePlay")}}))}r["a"].state.video.currentVideo.url||r["a"].state.video.currentVideo.infoHash||this.loadPlayer(!0),q["ipcRenderer"].on("pause-player",(()=>{this.player&&(this.isPause=!0,r["a"].state.video.currentVideo.pipStatus&&this.player&&this.player.exitPictureInPicture(),r["a"].state.video.currentVideo.status&&this.player&&this.player.pause())}))}else r["a"].state.video.currentVideo.url!==this.player.src()&&console.log("url changed",r["a"].state.video.currentVideo.url,this.player.src());this.io.on("server_progress",(t=>{var e;if("/player"!==this.$router.currentRoute.path)return;if(!this.player&&!this.player.readyState())return;if(null===(e=r["a"].state.video.currentVideo)||void 0===e||!e.url)return;const s=t.find((t=>{var e;return null===(e=r["a"].state.video.currentVideo)||void 0===e?void 0:e.url.includes(t.name)}));if(s&&s.progress){const t=[],e=s.progress.length;let i=s.progress[0],a=1;for(let o=1;o<e;o++)if(s.progress[o]===i&&o<e-1)a+=1;else{if(s.progress[o+1]===i){a+=1;continue}o===e-1&&(a+=1),a&&t.push({color:1===i?"gold":"transparent",length:a/e*100}),i=s.progress[o],a=1}this.updateProgress(t)}})),this.io.on("update_subtitleList",(async(t,e)=>{this.isUpdateSubtitle||(this.isUpdateSubtitle=t,console.log("update_subtitleList!!!",t,"path:",r["a"].state.video.currentVideo.path,e))})),this.io.on("clear_player",(t=>{const e=r["a"].state.video.currentVideo.url;if(r["a"].state.video.currentVideo.infoHash!==t.infoHash)return;const s=/^http/gm.test(e),i=/^play:\/\//gm.test(e);i&&"paused"===t.status||(s||i)&&(console.log("is",s,i),r["a"].state.video.currentVideo.pipStatus&&this.player.exitPictureInPicture(),r["a"].dispatch("resetPlayer"),this.$destroy(),setTimeout((()=>{console.log("timeout",s,i),this.$router.push("/player");try{this.loadPlayer(!0)}catch(t){console.log("Failed to force load player. This will not go wrong.",t.message||t)}s&&this.$q.notify(this.$t("stop_stream_player")),i&&this.$q.notify(this.$t("stop_player"))}),500))}))},beforeDestroy(){this&&this.player&&this.player.dispose()},computed:{lang(){const t=r["a"].state.setting.language?r["a"].state.setting.language:"en-US";return this.player&&this.player.language(t),t},settings(){const t=r["a"].state.setting;return{defaultVideoPlayer:t.defaultVideoPlayer,language:t.language}},advancedOpt(){let t=r["a"].state.video.currentVideo.path;const e=r["a"].state.video.currentVideo.url;e&&e.startsWith("play://")&&(t=decodeURI(e).replace("play:///",""));const s=t?t.replace(/^.*[\\\/]/,""):this.fileName;return[{name:this.$t("title"),value:decodeURIComponent(s).replace("\\","")},{name:this.$t("location"),value:t},{name:this.$t("subtitle_file"),value:r["a"].state.video.currentVideo.subtitleList}]}},watch:{"$store.state.video.currentVideo.updatePlayer"(t,e){console.log("watch updatePlayer:",t),t&&t!==e&&(console.log("need update player"),r["a"].dispatch("updatePlayer",!1),this.updatePlayer(r["a"].state.video.currentVideo.url))}},methods:{toggleSplash(t,e=""){this.showSplash=t,this.videoLoadingHint=e},toggleAudio(t){this.isAudio=t},toggleAdvancedOptions(t){this.showAdvancedOptions=t},openFile(){console.log("click",this.$refs.file),this.$refs.file.click()},bigPlayBtnOpenFile(){const t=document.querySelector("#my-video video").src;console.log("bigPlayBtn",t),t?this.player.play():this.openFile()},async languageChange(){this.player&&(this.player.language(this.lang),this.updateComponentText(),r["a"].state.video.currentVideo.url&&await this.loadPlayer(!0))},manualAddFile(t){console.log("Open Media File: "+t.target.files[0]),0!==t.target.files.length&&(t.target.files[0].path&&r["a"].dispatch("currentVideoPath",t.target.files[0].path),this.updatePlayer(t.target.files[0]),setTimeout((()=>{this.$refs.file.value=null}),500))},async manualAddSubtitle(t){const e=t.target.files;if(!e.length)return;const s=e[0],i=this.player.textTracks(),a=await this.addSubtitle(s,s.name);console.log("manualAddSubtitle",s,s.name,a);let o=-1;setTimeout((()=>{for(let t=0;t<i.length;t++)s.name.includes(i[t].label)&&(o=t),i[t].mode="disabled";"number"===typeof a?(i[a].mode="showing",this.updateSubtitleList(i[a].label,{isShow:!0})):-1!==o&&(i[o].mode="showing",this.updateSubtitleList(i[o].label,{isShow:!0})),this.appendAddSubBtn(),t.target.value=""}),500)},initVideoComponent(){console.log("initVideoComponent");const t=l["default"].getComponent("Button"),e=l["default"].getComponent("MenuItem");l["default"].registerComponent("FileButton",l["default"].extend(t,{constructor:function(){t.apply(this,arguments);const e=arguments[1];this._text=e.text||"Open File...",this.el_.innerHTML=`<span class="open" title="${this._text}"></span>`,this.updateTitle=function(t){this.el_.innerHTML=`<span class="open" title="${t}"></span>`}}})),l["default"].registerComponent("SubsButton",l["default"].extend(t,{constructor:function(){t.apply(this,arguments);const e=arguments[1];this._text=e.text||"Add subtitles...",this.el_.innerHTML=`<span class="subs" title="${this._text}"></span>`,this.updateTitle=function(t){this.el_.innerHTML=`<span class="subs" title="${t}"></span>`}}})),l["default"].registerComponent("AddSubButton",l["default"].extend(e,{constructor:function(){e.apply(this,arguments);const t=arguments[1];this._text=t.text||"Add subtitles...",this.el_.innerHTML+=`<span>${this._text}</span>`}})),l["default"].registerComponent("AdvancedOptionsButton",l["default"].extend(t,{constructor:function(){t.apply(this,arguments);const e=arguments[1];this._text=e.text||"Advanced Options",this.el_.innerHTML=`<span class="advanced" title="${this._text}"></span>`,this.updateTitle=function(t){this.el_.innerHTML=`<span class="advanced" title="${t}"></span>`}}}));const s=l["default"].getComponent("SeekBar");s.prototype.getPercent=function(){const t=this.player_.currentTime(),e=t/this.player_.duration();return e>=1?1:e},s.prototype.handleMouseMove=function(t){let e=this.calculateDistance(t)*this.player_.duration();e===this.player_.duration()&&(e-=.1),this.player_.currentTime(e),this.update()}},addControlBarComponent(){const t=this.player.controlBar.addChild("FileButton",{text:this.$t("open_file")},1),e=tt["b"].is.mobile?"touchend":"click";t.on(e,this.openFile),this.subsBtn=this.player.controlBar.addChild("SubsButton",{text:this.$t("add_subtitles")+"..."},14),this.subsBtn.on(e,(()=>this.$refs.subtitle.click()));const s=this.player.controlBar.addChild("AdvancedOptionsButton",{text:this.$t("advanced_options")},16);s.on(e,(()=>{this.player.isFullscreen()&&this.player.exitFullscreen(),this.toggleAdvancedOptions(!0)}))},updateComponentText(){const t=this.player.controlBar.getChild("FileButton");t.updateTitle(this.$t("open_file")),this.subsBtn.updateTitle(this.$t("add_subtitles")+"...");const e=this.player.controlBar.getChild("AdvancedOptionsButton");e.updateTitle(this.$t("advanced_options"))},loadPlayer(t=!1){let e=()=>{};const s=new Promise((t=>{e=t}));if(!l["default"].getPlayer("my-video")||t){if(t){Object(l["default"])("my-video")&&(Object(l["default"])("my-video").isInPictureInPicture()&&Object(l["default"])("my-video").exitPictureInPicture(),Object(l["default"])("my-video").dispose());const t=document.querySelector("#video-container");t&&(t.innerHTML='<video\n            crossorigin="anonymous"\n            id="my-video"\n            class="video-js vjs-default-skin vjs-16-9 vjs-big-play-centered vjs-fluid"\n            ref="video"\n            style="height:100%"\n          ></video>')}try{this.player=Object(l["default"])("my-video",this.playerOptions,(()=>e()))}catch(i){console.log("loadPlayer error",i);const t=i.message;t.includes("The element or ID supplied is not valid.")&&(r["a"].dispatch("resetPlayer"),this.$destroy())}if(this.player.on("ready",(async()=>{r["a"].dispatch("updateVideoStatus",!1)})),this.player.on("canplay",(async()=>{r["a"].dispatch("resetRemotePlay");const t=(st?r["a"].state.video.currentVideo.path:this.fileName||r["a"].state.video.currentVideo.url).split(".").pop();if(this.toggleAudio(Object(k["b"])(t)),this.isUpdateSubtitle&&r["a"].state.video.currentVideo.infoHash===this.isUpdateSubtitle&&r["a"].state.video.currentVideo.path&&(await this.addSubtitle(r["a"].state.video.currentVideo.path),this.changeSubtitleForLang(),this.isUpdateSubtitle=""),!r["a"].state.video.currentVideo.url){const t=document.querySelector("#my-video video").src;r["a"].dispatch("currentVideoUrl",t);const e=t.split("/"),s=e[e.length-1];"undefined"!==typeof s&&(this.fileName=s),this.loadPlayer(!0),setTimeout((()=>this.player.play()),500)}setTimeout((()=>{!1===r["a"].state.video.currentVideo.status&&this.player.paused()&&this.player.bigPlayButton.show()}),700)})),this.player.on("play",(async()=>{if(this.settings.defaultVideoPlayer!==it&&r["a"].state.video.currentVideo.url.startsWith("play://")&&r["a"].state.video.currentVideo.infoHash){this.player.pause(),this.player.exitPictureInPicture();const t=r["a"].state.video.currentVideo.path;return console.log("player will pause,open default player,"+t),await Object(x["b"])(this.settings.defaultVideoPlayer,t),r["a"].dispatch("resetPlayer"),this.loadPlayer(!0)}this.player.bigPlayButton.hide(),r["a"].dispatch("updateVideoStatus",!0)})),this.player.on("pause",(()=>{4===this.player.readyState()&&this.player.bigPlayButton.show(),r["a"].dispatch("updateVideoStatus",!1)})),this.player.on("seeked",(()=>{setTimeout((()=>{const t=document.querySelector(".vjs-load-progress"),e=document.querySelector(".vjs-play-progress");t.style.width=e.style.width}),200)})),this.player.on("waiting",(()=>{const t=document.querySelector("#my-video video");t&&(t.style.backgroundColor="black")})),this.player.on("loadedmetadata",(()=>{const t=r["a"].state.video.currentVideo.url;if(!t||!/^http/gm.test(t))return;if(!/wait=0$/gm.test(t)||0===r["a"].state.setting.videoCacheTime)return;const e=this.updateCacheRate(r["a"].state.setting.videoCacheTime);console.log("loadedmetadata!",e),e&&(this.updateSrc(t,{clearSubtitle:!1,clearProgress:!1}),this.player.currentTime(r["a"].state.video.currentVideo.currentTime))})),this.player.on("leavepictureinpicture",(()=>{this.player&&this.player.bigPlayButton.hide(),r["a"].dispatch("updateVideoPIPStatus",!1),setTimeout((()=>{try{this.player.paused()?this.player.bigPlayButton.show():this.$router.push("/player")}catch(i){console.log("Failed to check pause status, but nothing will go wrong with this.",i.message||i)}}),500)})),this.player.on("enterpictureinpicture",(()=>{r["a"].dispatch("updateVideoPIPStatus",!0),this.player.paused()||setTimeout((()=>this.player.play()),500)})),this.player.on("timeupdate",(()=>{r["a"].dispatch("currentVideoCurrentTime",this.player.currentTime())})),this.player.on("error",(()=>{this.toggleSplash(!1),console.log("player error event!",this.player.error_.message);const t=this.player.languages()[this.player.language()],e=t&&t[this.player.error_.message]||this.player.error_.message;if(4!==this.player.error_.code||st||Object(et["a"])())this.$q.notify(e);else{const t='<i class="q-icon material-icons q-ml-xs">open_in_new</i>',s=`${this.$t("download")} ${it} Desktop${t}`,i=`<a class='doc-link' href='${X.a.homepage}' target='_blank'>${s}</a>`,a=this.$q.notify({html:!0,message:`<span>${e}</span>${i}`,actions:[{label:this.$t("close"),color:"green",handler(){a()}}],timeout:0})}r["a"].dispatch("resetPlayer"),this.$q.loading.hide(),this.loadPlayer(!0)})),r["a"].state.video.currentVideo.url&&!r["a"].state.video.currentVideo.remotePlay){this.player&&this.player.bigPlayButton.hide();const t=r["a"].state.video.currentVideo.subtitleList,e=r["a"].state.video.currentVideo.status,s=r["a"].state.video.currentVideo.updatePlayer;if(this.updateSrc(r["a"].state.video.currentVideo.url),this.player.currentTime(s?0:r["a"].state.video.currentVideo.currentTime),console.log("loadplayer(force) status",s,e,t,this.player),!s&&!e&&!/^https:\/\/localhost:8080\/webtorrent/gm.test(r["a"].state.video.currentVideo.url)){const t=()=>{this.player.pause(),this.player.off("play",t)};this.player.on("play",t)}"undefined"!==typeof t&&t.length?this.restoreSub(t):this.addSubtitle(r["a"].state.video.currentVideo.path),r["a"].dispatch("updatePlayer",!1)}return tt["b"].is.mobile?this.player.bigPlayButton.on("touchend",this.bigPlayBtnOpenFile):this.player.bigPlayButton.on("click",this.bigPlayBtnOpenFile),this.addControlBarComponent(),r["a"].dispatch("updateVideoPIPStatus",!1),s}this.player=l["default"].getPlayer("my-video")},async updatePlayer(t){if(!t)return;this.player||await this.loadPlayer(!0);const e="string"===typeof t?t:URL.createObjectURL(t);console.log("update Player",t,e),this.fileName=t.name,r["a"].dispatch("currentVideoUrl",e);try{this.updateSrc(e)}catch(s){console.debug("updateSrc error",s.message||s),await this.loadPlayer(!0)}r["a"].dispatch("resetInfoHash"),this.clearOldSubtitle(),r["a"].state.video.currentVideo.path?await this.addSubtitle(r["a"].state.video.currentVideo.path):await this.addSubtitle(t,t.name),this.changeSubtitleForLang()},updateSrc(t,e={clearSubtitle:!0,clearProgress:!0}){this.toggleAudio(!1),e.clearProgress&&this.clearProgress(),e.clearSubtitle&&r["a"].dispatch("currentVideoSubtitleList",[]),t.startsWith("play://")&&(t+=`?infoHash=${r["a"].state.video.currentVideo.infoHash}`),console.log("updateSrc()",t),this.player.src([{src:t,type:"video/mp4"}])},updateCacheRate(t){if(!this.player.duration())return;const e=60*t/this.player.duration(),s=r["a"].state.video.currentVideo.url;return!!s&&(r["a"].dispatch("currentVideoUrl",s.replace(/wait=.*/gm,`wait=${e}`)),!0)},updateProgress(t){if(t){let e=document.querySelector("#download-progress");if(!e){const t=document.querySelector(".vjs-progress-holder");if(!t)return;e=t.appendChild(document.createElement("div")),e.id="download-progress"}const s=t=>{let e=0;for(let s=0;s<t.length;s++)e=0===s?t[s].length:s===t.length-1?0:t[s].length>1?e+t[s].length:e+1,t[s].rate=e;return t},i=s(t);e.style.background=i.reduce(((t,e)=>t+`, ${e.color} 0%, ${e.color} ${e.rate}%`),"linear-gradient(90deg")+")"}},clearProgress(){let t=document.querySelector("#download-progress");if(!t){const e=document.querySelector(".vjs-progress-holder");if(!e)return;t=e.appendChild(document.createElement("div")),t.id="download-progress"}t.style.background=""},async addSubtitle(t,e){var s;console.log("sub",t,e);let i=t;if("string"===typeof t){if(t.startsWith("blob:"))return;i=t.startsWith("play://")?$(decodeURI(t.replace("play:///",""))):$(t)}e||(e=(null===(s=i)||void 0===s?void 0:s.name)||"");const a=e.match(/\.[^.]+$/);if(!a)return;const o=a[0].toLowerCase();console.log("addSubtitle sub",i,e);let n=!1,r=!1;if(st)[".ass"].includes(o)?console.log("add .ass sub"):await Promise.all(g(i).map((t=>new Promise((s=>{setTimeout((()=>{r=this.isRepeatSubtitle(t.label,t.path),"number"!==typeof r&&(this.player.addRemoteTextTrack({kind:"captions",label:t.label||e,src:t.src},!0),this.updateSubtitleList(t.label||e,{path:t.path}),n=!0),s()}))})))));else{if(console.log("web addSubtitle"),![".srt",".vtt"].includes(o))return;r=this.isRepeatSubtitle(e),"number"!==typeof r&&await new Promise((t=>{const s=new FileReader;s.readAsText(i),s.onload=s=>{const i=".vtt"===o?s.target.result:_(s.target.result);console.log(s.target.result),this.player.addRemoteTextTrack({src:URL.createObjectURL(new Blob([i])),kind:"captions",label:e},!0),this.updateSubtitleList(e),n=!0,t()}}))}if(n&&this.subsBtn){this.subsBtn.addClass("hidden"),this.listenSubsCapsMenuItem();const t=this.player.textTracks();t&&t[0]&&(t[0].mode="showing",this.updateSubtitleList(t[0].label,{isShow:!0})),this.appendAddSubBtn()}return r},isRepeatSubtitle(t,e){const s=r["a"].state.video.currentVideo.subtitleList;let i=!1;for(let a=0;a<s.length;a++)!e&&t.includes(s[a].label)&&(i=!0),e&&e.includes(s[a].path)&&t.includes(s[a].label)&&(i=a);return i},changeSubtitleForLang(){const t=this.player.textTracks();if(!t||!t[0])return;const e=navigator.language.substring(0,navigator.language.indexOf("-"));if(this.changeSubtitle(t,e))return;const s=this.settings.language.substring(0,this.settings.language.indexOf("-"));this.changeSubtitle(t,s)||this.changeSubtitle(t,"en")},changeSubtitle(t,e){const s=new RegExp(e,"i");for(let i=0;i<t.length;i++)if(s.test(t[i].label)){for(let e=0;e<t.length;e++)t[e].mode="disabled";return t[i].mode="showing",this.updateSubtitleList(t[i].label,{isShow:!0}),!0}return!1},updateSubtitleList(t,e={path:"",index:"",isShow:!1}){e.isShow||(e.isShow=!1);const s=JSON.parse(JSON.stringify(r["a"].state.video.currentVideo.subtitleList));if(e.isShow){let i=-1;s.forEach(((e,a)=>{s[a].label===t&&(i=a),s[a].isShow=!1})),"number"===typeof e.index?s[e.index].isShow=!0:-1!==i&&(s[i].isShow=!0)}else s.push({label:t,path:e.path,isShow:e.isShow});r["a"].dispatch("currentVideoSubtitleList",s)},listenSubsCapsMenuItem(){const t=this.player.controlBar.subsCapsButton,e=t.menu.children();e.forEach(((t,e)=>{if("SubsCapsMenuItem"===t.constructor.name){const s=tt["b"].is.mobile?"touchend":"click";t.on(s,(()=>{this.updateSubtitleList(t.track.label,{index:e-2,isShow:!0})}))}}))},clearOldSubtitle(){if(!this.subsBtn)return;this.subsBtn.removeClass("hidden");const t=this.player.remoteTextTracks();for(let e=t.length-1;e>=0;e--)this.player.removeRemoteTextTrack(t[e])},async restoreSub(t){let e;console.log("restoreSub",t),r["a"].dispatch("currentVideoSubtitleList",[]);for(const s in t){if(!t[s].path)return;await this.addSubtitle(t[s].path),t[s].isShow&&(e=s)}if("string"===typeof e){const t=this.player.textTracks();for(let e=0;e<t.length;e++)t[e].mode="disabled";t[e].mode="showing",this.updateSubtitleList(t[e].label,{isShow:!0})}},appendAddSubBtn(){const t=this;setTimeout((()=>{const e=this.player.controlBar.subsCapsButton,s=e.menu.children();if(!s)return;if(s.some((t=>"AddSubButton"===t.name_)))return;const i=e.menu.addChild("AddSubButton",{text:t.$t("add_subtitles")+"..."},2);i.addClass("add-sub-btn");const a=tt["b"].is.mobile?"touchend":"click";i.on(a,(()=>{this.$refs.subtitle.click()}))}),1e3)}}},nt=ot,rt=(s("941d"),s("9989")),lt=s("0016"),ct=Object(O["a"])(nt,c,d,!1,null,null,null);ct.exports;j()(ct,"components",{QPage:rt["a"],QIcon:lt["a"]});var dt=s("f880");const ht=()=>{const t=l["default"].getAllPlayers();return Array.isArray(t)?t[0]:null},ut=()=>{const t=()=>(i["wtClient"].torrents[0]&&i["wtClient"].torrents[0].files&&i["wtClient"].torrents[0].files.forEach((t=>{t._serviceWorker&&"activated"===t._serviceWorker.state||(t._serviceWorker=i["wtClient"].serviceWorker)})),!0);if(i["wtClient"].serviceWorker&&"activated"===i["wtClient"].serviceWorker.state){if("activated"===i["wtClient"].serviceWorker.state)return t();i["wtClient"].serviceWorker=null}if(!navigator.serviceWorker||!navigator.serviceWorker.controller)return!1;const e=navigator.serviceWorker.controller;return"activated"===e.state&&(i["wtClient"].loadWorker(e),t())};let pt=null;function mt(t){if("string"===typeof t&&t.startsWith("/webtorrent/")&&(t=t.replace("/webtorrent/","")),at.toggleSplash(!1),!ut())return void a["a"].create(n["b"].t("service_worker_error"));if(!i["wtClient"].torrents[0])return void a["a"].create(n["b"].t("add_task_first"));let e=!1;const s=Date.now();Object(o["b"])().push({name:"Player",params:{action:{type:"play_remote"}}}),pt&&clearInterval(pt),at.toggleSplash(!0,n["b"].t("loading")),pt=setInterval((async()=>{if(e)return;if(Date.now()-s>3e4&&!i["wtClient"].torrents[0].ready)return at.toggleSplash(!1),a["a"].create(n["b"].t("player_task_time")),void clearInterval(pt);if(i["wtClient"].torrents[0]&&!i["wtClient"].torrents[0].files[0])return void at.toggleSplash(!0,n["b"].t("loading"));{const t=i["wtClient"].torrents[0].files[0],e=Object(dt["a"])(t.downloaded||0),s=Object(dt["a"])(t.length||0),a=`(${e}/${s})`;if(at.toggleSplash(!0,n["b"].t("downloading")+"... "+a),i["wtClient"].torrents[0].pieces[t._startPiece]||i["wtClient"].torrents[0].pieces[t._startPiece+1])return void console.log("Wait for first two pieces downloaded")}const o=document.querySelector("#my-video video");if(!o)return;try{const s=ht();if(t||(t=i["wtClient"].torrents[0].files[0].path),4===s.readyState()){const e=`${location.origin}/webtorrent/${i["wtClient"].torrents[0].infoHash}/${encodeURI(t)}`;if(console.log(e,s.src(),e===s.src()),s.src()!==e)throw s.hasStarted(!1),new Error("Reset since src changed");return console.log(s.readyState(),"ready"),s.setAttribute("muted",!0),s.setAttribute("playsInline",!0),s.setAttribute("autoplay",!1),at.toggleSplash(!1),void clearInterval(pt)}if(e)return}catch(c){console.log("cannot get vjs",c)}if(e)return;const l=i["wtClient"].torrents[0].files.find((e=>t===e.path));if(o.setAttribute("playsInline",!0),o.setAttribute("muted",!0),o.setAttribute("autoplay",!1),l){console.log("Play file",t,l);const e=`${location.origin}/webtorrent/${i["wtClient"].torrents[0].infoHash}/${encodeURI(l.path||l.name)}`;r["a"].commit("CURRENT_VIDEO_URL_MUTATION",e),r["a"].commit("UPDATE_VIDEO_UPDATE_PLAYER_MUTATION",!0),setTimeout((()=>{const t=ht();t&&4===t.readyState()&&t.paused()&&a["a"].create(n["b"].t("autoplay_hint"))}),3e3)}else{const t=i["wtClient"].torrents[0].files[0];console.log("Cannot find same file. Use files[0]",t.path);const e=`${location.origin}/webtorrent/${i["wtClient"].torrents[0].infoHash}/${encodeURI(t.path||t.name)}`;r["a"].commit("CURRENT_VIDEO_URL_MUTATION",e),r["a"].commit("UPDATE_VIDEO_UPDATE_PLAYER_MUTATION",!0),setTimeout((()=>{const t=ht();t&&4===t.readyState()&&t.paused()&&a["a"].create(n["b"].t("autoplay_hint"))}),3e3)}at.toggleSplash(!1),e=!0}),1e3)}},3572:function(t,e,s){"use strict";s("d47b")},"3f23":function(t,e,s){"use strict";s("f9fe")},4114:function(t,e,s){},4396:function(t,e,s){},"43a8":function(t,e,s){"use strict";s.d(e,"a",(function(){return a}));var i=s("a32b");function a(t){if(!Array.isArray(t)||!t[0])return"";let e=Object(i["dirname"])(t[0]);for(let s=1;s<t.length;s++)while(!t[s].includes(e)&&e.length>1)e=Object(i["dirname"])(e);return e}},"449c":function(t,e,s){"use strict";s("4114")},"4bc8":function(t,e,s){},"51d9":function(t,e,s){"use strict";var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-icon",{class:{"cursor-pointer":t.clickable},attrs:{name:t.icon,size:t.size},on:{click:t.emitClick}},[t.tooltip?s("q-tooltip",[t._v("\n    "+t._s(t.tooltip)+"\n  ")]):t._e()],1)},a=[],o={name:"IconWithTooltip",props:{icon:{type:String,require:!0},tooltip:{type:String,default:""},clickable:{type:Boolean,default:!1},size:{type:String,default:""}},methods:{emitClick(){this.$emit("click")}}},n=o,r=s("2877"),l=s("0016"),c=s("05c0"),d=s("eebe"),h=s.n(d),u=Object(r["a"])(n,i,a,!1,null,null,null);e["a"]=u.exports;h()(u,"components",{QIcon:l["a"],QTooltip:c["a"]})},"52af":function(t,e,s){},"572e":function(t,e,s){},"5a1c":function(t,e,s){"use strict";s("9970")},"5ea8":function(t,e,s){"use strict";var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-card",{staticClass:"channel-card column relative-position overflow-hidden rounded-borders",style:{border:t.$q.dark.isActive?"1px solid rgba(255,255,255,0.24)":"none"},attrs:{flat:""}},[s("q-img",{staticClass:"channel-image absolute-top-left full-height",staticStyle:{filter:"blur(24px) saturate(1.5)",opacity:"0.2",transform:"scale(1.25)"},attrs:{src:t.image,ratio:1,"placeholder-src":"platform-assets/windows/icon/Wide310x150Logo.scale-240.png"}}),s("div",{staticClass:"image-container overflow-hidden",staticStyle:{"border-top-left-radius":"4px!important","border-top-right-radius":"4px!important"}},[s("q-img",{staticClass:"channel-image cursor-pointer",attrs:{contain:"",src:t.image,ratio:1},on:{click:t.detail,error:t.onImageError},scopedSlots:t._u([{key:"error",fn:function(){return[s("div",{staticClass:"absolute-bottom"},[s("div",{staticClass:"text-h6 ellipsis-3-lines overflow-hidden"},[s("q-icon",{attrs:{name:"video_library"}}),t._v("\n            "+t._s(t.title)+"\n          ")],1)]),s("q-tooltip",[t._v(t._s(t.editable?t.$t("edit_posts"):t.$t("channel_detail")))])]},proxy:!0}])},[t.image&&t.isHaveImage?t._e():s("q-icon",{staticClass:"absolute-center",staticStyle:{color:"#ccc"},attrs:{size:"90px",name:"subscriptions"}}),s("div",{staticClass:"absolute-bottom"},[s("div",{staticClass:"text-h6 ellipsis-3-lines overflow-hidden"},[t._v("\n          "+t._s(t.title)+"\n        ")])]),s("q-tooltip",[t._v(t._s(t.editable?t.$t("edit_posts"):t.$t("channel_detail")))])],1)],1),s("q-card-section",{staticClass:"q-py-none",staticStyle:{overflow:"visible"}},[s("div",{staticClass:"q-pa-none row",staticStyle:{margin:"0 -16px"}},[s("div",{staticClass:"q-py-sm q-px-sm q-pl-md",attrs:{"data-cy":"channel-ID"}},[t._v("ID: "+t._s(t.id))]),s("q-space"),s("q-btn",{staticClass:"q-py-xs q-px-sm",attrs:{unelevated:"",icon:"content_copy",size:"xs",dense:""},on:{click:t.copyId}}),t.lib.isLibAdmin?s("q-btn",{staticClass:"q-py-xs q-px-sm",attrs:{unelevated:"",icon:"block",size:"xs",dense:""},on:{click:t.takedown}},[s("q-tooltip",[t._v(t._s(t.$t("takedown_channel")))])],1):t._e()],1),s("div",{staticClass:"q-px-md channel-desc",staticStyle:{margin:"0 -16px"}},[t._v(t._s(t.description))]),s("div",{staticClass:"channel-tags",staticStyle:{margin:"4px -4px 0"}},[t.isBlocked?s("q-badge",{staticClass:"q-ma-xs q-py-xs",attrs:{color:"negative","text-color":"negative"}},[t._v(t._s(t.$t("blocked")))]):t._e(),t.hidden?s("q-badge",{staticClass:"q-ma-xs q-py-xs",attrs:{color:"general","text-color":"general"}},[t._v(t._s(t.$t("private_channel")))]):t._e()],1)]),s("q-space"),t.hideFollow?s("q-card-actions",[t.editable?s("q-btn",{attrs:{flat:"",icon:"delete",color:"negative"},on:{click:function(e){return e.stopPropagation(),t.remove.apply(null,arguments)}}},[s("q-tooltip",{attrs:{anchor:"top middle",self:"bottom middle",offset:[10,10]}},[t._v(t._s(t.$t("remove_channel"))+"\n      ")])],1):t._e(),s("q-space"),t.editable?s("q-btn",{attrs:{flat:"",icon:"edit"},on:{click:function(e){return e.stopPropagation(),t.detail.apply(null,arguments)}}},[s("q-tooltip",{attrs:{anchor:"top middle",self:"bottom middle",offset:[10,10]}},[t._v(t._s(t.$t("edit_channel"))+"\n      ")])],1):t._e(),t.editable?s("q-btn",{attrs:{flat:"",icon:"find_in_page"},on:{click:function(e){return e.stopPropagation(),t.preview.apply(null,arguments)}}},[s("q-tooltip",{attrs:{anchor:"top middle",self:"bottom middle",offset:[10,10]}},[t._v(t._s(t.$t("preview"))+"\n      ")])],1):t._e(),t.editable?s("q-btn",{attrs:{flat:"",icon:"settings"},on:{click:function(e){return e.stopPropagation(),t.edit.apply(null,arguments)}}},[s("q-tooltip",{attrs:{anchor:"top middle",self:"bottom middle",offset:[10,10]}},[t._v(t._s(t.$t("channel_setting"))+"\n      ")])],1):t._e()],1):s("q-card-actions",{staticClass:"flex justify-center items-center"},[s("FollowButton",{staticClass:"q-my-sm",attrs:{id:t.id}})],1)],1)},a=[],o=s("4aad"),n=s("a939"),r=s("f71e"),l={name:"ChannelCard",components:{FollowButton:n["a"]},data(){return{isHaveImage:!0,lib:o["a"]}},props:{title:{type:String,required:!0},description:{type:String,required:!0},image:{type:String,required:!0},id:{type:String,default:""},soul:{type:String,default:""},hidden:{type:Boolean},editable:{type:Boolean},hideFollow:{type:Boolean},followable:{type:Boolean}},watch:{image(t,e){t&&t!==e&&(this.isHaveImage=!0)}},computed:{isBlocked(){return o["a"].userData.blockChannels.includes(this.id)}},methods:{copyId(){Object(r["b"])(this.id).then((()=>{this.$q.notify(this.$t("copied_to_clipboard"))}))},edit(){this.editable&&this.$emit("edit",this.id)},detail(){this.$emit("detail",this.id)},onImageError(){this.isHaveImage=!1},preview(){this.$emit("preview",this.id)},follow(){this.$emit("follow",this.id)},remove(){this.$emit("remove-channel",this.id)},takedown(){if(!o["a"].isLibAdmin||!this.id)return;if(20!==this.id.length)return this.$q.notify("Cannot parse post id");const t=[{value:"Serious Violation",label:this.$t("serious_violation")},{value:"Copyright Disputes",label:this.$t("copyright_disputes")},{value:"Adults Only",label:this.$t("adults_only")}];this.$q.dialog({options:{model:t[0].value,type:"radio",items:t},message:this.$t("select_takedown_reason"),ok:this.$t("take_down"),cancel:this.$t("cancel")}).onOk((t=>{console.log(t),["Serious Violation","Copyright Disputes","Adults Only"].includes(t)&&o["a"].takedown("channel",this.id,t).then((()=>{this.$q.notify(this.$t("success"))}))}))}}},c=l,d=(s("5a1c"),s("2877")),h=s("f09f"),u=s("068f"),p=s("0016"),m=s("05c0"),g=s("a370"),f=s("2c91"),b=s("9c40"),v=s("58a8"),y=s("4b7e"),_=s("eebe"),w=s.n(_),C=Object(d["a"])(c,i,a,!1,null,"37cd58ed",null);e["a"]=C.exports;w()(C,"components",{QCard:h["a"],QImg:u["a"],QIcon:p["a"],QTooltip:m["a"],QCardSection:g["a"],QSpace:f["a"],QBtn:b["a"],QBadge:v["a"],QCardActions:y["a"]})},6082:function(t,e,s){"use strict";s("4bc8")},6277:function(t,e,s){"use strict";var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"search-channel"},[s("div",{staticClass:"fixed-bottom-right show-search-channel",class:{higher:t.higher}},[s("q-btn",{staticClass:"channel-search-btn q-ma-xs",class:{hide:t.hide},attrs:{fab:"","no-wrap":"",size:"18px",color:"primary","text-color":"primary",icon:"library_add"},on:{click:function(e){t.showDialog=!0}}},[s("div",{staticClass:"fab-inner-text"},[t._v(t._s(t.$t("search")))])])],1),s("q-dialog",{attrs:{position:t.screen$xs?"bottom":"standard","content-class":"fullscreen-dialog"},on:{hide:t.clearInput},model:{value:t.showDialog,callback:function(e){t.showDialog=e},expression:"showDialog"}},[s("q-card",{staticClass:"search-dialog overflow-hidden"},[s("q-card-section",{staticClass:"flex items-center q-py-sm"},[s("div",{staticClass:"text-h6 text-weight-bold"},[t._v(t._s(t.$t("search_for_channel")))]),s("q-space"),s("q-btn",{attrs:{flat:"",round:"",icon:"close"},on:{click:function(e){t.showDialog=!1}}})],1),s("q-card-section",{staticClass:"column items-stretch q-pt-none",staticStyle:{overflow:"visible"}},[s("div",{staticClass:"search-textfield"},[s("q-input",{attrs:{type:"text",outlined:"",dense:"",autofocus:"",label:this.$t("channel")+" ID",placeholder:"%abcd1234"},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.search.apply(null,arguments)}},nativeOn:{paste:function(t){t.stopPropagation()}},scopedSlots:t._u([{key:"append",fn:function(){return[s("q-icon",{staticClass:"cursor-pointer",attrs:{color:"primary",name:"search"},on:{click:t.search}})]},proxy:!0}]),model:{value:t.searchText,callback:function(e){t.searchText=e},expression:"searchText"}})],1),s("q-scroll-area",{staticClass:"items-center",staticStyle:{height:"calc(100vh - 256px)",margin:"4px auto 0",width:"100%"}},[s("div",{staticClass:"search-results full-width flex justify-center items-stretch"},[t._l(t.searchResults,(function(e){return s("ChannelCard",t._b({key:e.id,attrs:{followable:!t.lib.followingChannels.find((function(t){return t.id===e.id}))},on:{detail:t.detail,follow:t.follow}},"ChannelCard",e,!1))})),s("i"),s("i"),s("i"),s("i"),s("i"),s("i"),s("i"),s("i")],2)])],1)],1)],1)],1)},a=[],o=(s("498a"),s("5319"),s("4aad")),n=s("5ea8"),r={name:"SearchChannel",props:{higher:Boolean},components:{ChannelCard:n["a"]},data(){return{hide:!1,showDialog:!1,searchText:"",searchResults:[],lib:o["a"]}},methods:{clearInput(){this.searchText="",this.searchResults=[]},search(){if(console.log("search",this.searchText),!this.searchText||!this.searchText.trim())return this.$q.dialog({message:this.$t("please_input_channel_id"),ok:{textColor:"primary",color:"unset",flat:!0,label:this.$t("ok")}});const t=this.searchText.trim().replace(/^%/,""),e=o["a"].channelList.filter((e=>!!(e&&e.title&&e.id)&&(e.hidden?e.id===t:e.id.includes(t))));this.searchResults=e,e.length||this.$q.dialog({message:this.$t("search_channel_no_result",[t]),ok:{textColor:"primary",color:"unset",flat:!0,label:this.$t("ok")}})},follow(t){const e=!o["a"].followingChannels.find((e=>e.id===t));if(e)return o["a"].followChannel(t);this.$q.dialog({title:this.$t("unfollow"),message:this.$t("unfollow_confirm"),ok:this.$t("unfollow"),cancel:this.$t("cancel")}).onOk((()=>{o["a"].unfollowChannel(t)}))},detail(t){const e=o["a"].allChannelList.find((e=>e.id===t&&e.title&&e.creator));if(!e)return this.$q.dialog({title:this.$t("channel_not_found"),message:this.$t("cannot_get_channel_info"),ok:{textColor:"primary",color:"unset",flat:!0,label:this.$t("ok")}});console.log("find ch",e);const s=["id","title"].map((t=>{const s=e[t];return t+"="+encodeURIComponent(s)})).join("&"),i=`/library/channel?${s}`;this.$root.$emit("navigate-to",i),this.$router.push(i)}},activated(){this.hide=!0,setTimeout((()=>{this.hide=!1}),300)},deactivated(){this.hide=!0,this.clearInput()}},l=r,c=(s("344f"),s("2877")),d=s("9c40"),h=s("24e8"),u=s("f09f"),p=s("a370"),m=s("2c91"),g=s("27f9"),f=s("0016"),b=s("4983"),v=s("eebe"),y=s.n(v),_=Object(c["a"])(l,i,a,!1,null,"1c919252",null);e["a"]=_.exports;y()(_,"components",{QBtn:d["a"],QDialog:h["a"],QCard:u["a"],QCardSection:p["a"],QSpace:m["a"],QInput:g["a"],QIcon:f["a"],QScrollArea:b["a"]})},"6ea7":function(t,e,s){"use strict";s.d(e,"b",(function(){return o})),s.d(e,"f",(function(){return n})),s.d(e,"e",(function(){return r})),s.d(e,"a",(function(){return l})),s.d(e,"d",(function(){return c})),s.d(e,"c",(function(){return h}));s("ddb0");const{languages:i}=s("839e"),a="https://www.opensubtitles.org/subtitleserve/sub/";function o(){const t=["en","zh","es","fr","de","ru","pt"],e=[],s=[];return Object.entries(i).forEach((([i,a])=>{const o={label:`${a.native}(${i})`,value:i,name:a.name};t.includes(i)?s.push(o):e.push(o)})),[...s,...e]}function n(t){let e="";for(const s of t)(s.lang||s.url)&&(e&&(e+="%%%"),e=e+s.lang+"%%"+s.url);return e}function r(t){const e=[];if(!t||""===t)return e;let s;s=t.includes("%%%")?t.split("%%%"):[t];for(const i of s){const t=i.split("%%");e.push({lang:t[0],url:t[1]})}return e}function l(t){let e=t,s="";if(!Array.isArray(t)&&"string"!==typeof t)return s;"string"===typeof t&&(e=r(t));for(const i of e)s.includes(i.lang)||(s&&(s+="、"),s+=i.lang);return s}async function c(t){const e=s("bc3a"),i=/^\d+$/.test(t)?`${a}${t}`:t;return new Promise((t=>{e({method:"get",url:i,headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/108.0.0.0 Safari/537.36"},responseType:"stream"}).then((e=>{console.log("succ",e.status),t(!0)})).catch((e=>{var s,i;console.log("err",null===(s=e.response)||void 0===s?void 0:s.status),429===(null===(i=e.response)||void 0===i?void 0:i.status)&&t(!0),t(!1)}))}))}function d(t){return/^\d+$/.test(t)}function h(t){return d(t)?a+t:t}},9384:function(t,e,s){"use strict";var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{class:t.dense?"col-4":"col-12"},[s("q-checkbox",{staticClass:"q-mt-sm",attrs:{value:t.value,label:t.label,dense:""},on:{input:t.onChange}},[t.tooltip?s("q-tooltip",[t._v(t._s(t.tooltip))]):t._e()],1)],1)},a=[],o={props:{value:{required:!0},label:String,keyName:String,dense:Boolean,tooltip:{type:String,required:!1}},methods:{onChange(t){this.$emit("change",this.keyName,t)}}},n=o,r=s("2877"),l=s("8f8e"),c=s("05c0"),d=s("eebe"),h=s.n(d),u=Object(r["a"])(n,i,a,!1,null,null,null);e["a"]=u.exports;h()(u,"components",{QCheckbox:l["a"],QTooltip:c["a"]})},"941d":function(t,e,s){"use strict";s("52af")},"98d3":function(t,e,s){"use strict";s("ca9f")},9970:function(t,e,s){},"9c86":function(t,e,s){},"9e90":function(t,e,s){"use strict";var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-dialog",{attrs:{value:t.showPanel},on:{input:t.close}},[s("q-card",[s("q-card-section",{staticClass:"row items-center"},[s("q-expansion-item",{staticStyle:{width:"400px"},attrs:{"expand-separator":"","default-opened":"",icon:"people",label:"Peers ("+t.abPeers.length+")",caption:"Alphabiz peer"}},[s("div",{staticClass:"total col-12 q-px-md q-ml-sm"},[s("span",[t._v(t._s(t.$t("credit_cost"))+": "+t._s(t.torrentExpensesNum))])]),t._l(t.abPeers,(function(e){return s("q-field",{key:e.id,attrs:{label:e.subId||e.id,"stack-label":"",borderless:"",readonly:""},scopedSlots:t._u([{key:"prepend",fn:function(){return[s("div",{staticClass:"q-px-sm"})]},proxy:!0},{key:"control",fn:function(){return[t._l(e.addresses,(function(e,i){return s("div",{key:i+"-"+e,staticClass:"self-center full-width not-outline"},[t._v(" - "+t._s(e)+"\n            ")])})),s("div",{staticClass:"text full-width q-mt-xs"},[s("span",{staticClass:"peer-speed q-ml-xs q-mr-lg",class:{"text-primary":"0.00 KB"!==e.uploadSpeed}},[t._v("↑ "+t._s(e.uploadSpeed)+" / s")]),e.isPayed?s("q-icon",{staticClass:"text-primary q-mx-xs cursor-pointer",attrs:{name:"bolt"}},[s("q-tooltip",[t._v(" "+t._s(t.$t("accelerating")))])],1):t._e(),s("span",{staticClass:"peer-speed q-mr-md",class:{"text-primary":"0.00 KB"!==e.downloadSpeed}},[t._v("↓ "+t._s(e.downloadSpeed)+" / s")]),s("span",{directives:[{name:"show",rawName:"v-show",value:e.downloaded,expression:"peer.downloaded"}],staticClass:"peer-downloaded text-primary"},[t._v(t._s(e.downloadedData))])],1)]},proxy:!0}],null,!0)})}))],2)],1),s("q-card-section",{staticClass:"q-py-none"},[s("div",{staticClass:"total text-center"},[t._v("\n        "+t._s(t.$t("pay_with_credit_payed",[t.totalCredits]))+"\n      ")])]),s("q-card-actions",{attrs:{align:"right"}},[s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:t.$t("cancel")}}),s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:t.$t("ok")}})],1)],1)],1)},a=[],o=(s("ddb0"),s("f880")),n=s("0613"),r={props:{dp$source:Object,show:{type:Boolean,required:!0},torrent:{type:Object,required:!0},paymentSize:{type:Number,default:1e7}},computed:{torrentExpensesNum(){let t=0;if(this.dp$source.dp$expenseTxnDict&&this.dp$source.dp$expenseHashMapper){const e=this.dp$source.dp$expenseHashMapper[this.torrent.infoHash];if(console.log("torrentExpensesNum:","infoHash",this.torrent.infoHash),e)for(const s of e)t+=this.dp$source.dp$expenseTxnDict[s].amount}return Number((t/1e3).toFixed(3))},showPanel(){return this.show},totalCredits(){const t=this.torrent.length,e=t-this.torrent.downloaded,s=Number((e/1e10).toFixed(3));return s},abPeers(){if(!this.torrent||!this.torrent.connections)return[];const t=this.torrent.connections.filter((t=>t.isAbPeer&&t.hasResource&&t.subId!==n["a"].getters.accountUserInfo.sub)),e={};for(const s of t){const t=s.subId;t&&(e[t]?(e[t].isAbPeer|=s.isAbPeer,e[t].addresses.push(s.address),e[t].uploadSpeed+=s.uploadSpeed,e[t].downloadSpeed+=s.downloadSpeed,e[t].downloaded+=s.downloaded):(e[t]={...s},e[t].addresses=[s.address]))}return Object.values(e).sort(((t,e)=>t.id.localeCompare?t.id.localeCompare(e.id):0)).map((t=>(t.uploadSpeed=Object(o["a"])(t.uploadSpeed,{byte:!1,gb:!1}),t.downloadSpeed=Object(o["a"])(t.downloadSpeed,{byte:!1,gb:!1}),t.downloadedData=Object(o["a"])(t.downloaded,{byte:!0,gb:!0}),t.isPayed="high"===t.remoteGroup,t)))},payedConnections(){return this.abPeers.filter((t=>t.isPayed))},downloadedFromPayed(){return Object(o["a"])(this.payedConnections.reduce(((t,e)=>t+e.downloaded||0),0),{byte:!0,gb:!0})},hasPayed(){return this.payedConnections.length}},methods:{confirmPayment(){if(!this.abPeers.length)return;let t=10;const e=Math.floor(10*this.torrent.downloadSpeed/this.paymentSize);e>t&&(t=e);const s=this.torrent.length-this.torrent.downloaded;s<t*this.paymentSize/this.abPeers.length&&(t=Math.ceil(s/this.paymentSize/this.abPeers.length));const i=n["a"].getters.accountUserInfo;if(!i||!i.sub)return this.$q.notify("Please login first");this.$emit("setAutoRenew",this.torrent.infoHash,!0),this.abPeers.forEach((e=>{console.log("pay for",e),e.isPayed?console.log("skip high level peer",e):(console.log("dp$ create payment from","AlphabizPanel::confirmPayment"),this.$emit("createPayment",{infoHash:this.torrent.infoHash,remoteSubId:e.subId,payed:t,autoRenew:!0},!0))})),this.close()},close(){this.$emit("close")}}},l=r,c=s("2877"),d=s("24e8"),h=s("f09f"),u=s("a370"),p=s("3b73"),m=s("8572"),g=s("0016"),f=s("05c0"),b=s("4b7e"),v=s("9c40"),y=s("7f67"),_=s("eebe"),w=s.n(_),C=Object(c["a"])(l,i,a,!1,null,null,null);e["a"]=C.exports;w()(C,"components",{QDialog:d["a"],QCard:h["a"],QCardSection:u["a"],QExpansionItem:p["a"],QField:m["a"],QIcon:g["a"],QTooltip:f["a"],QCardActions:b["a"],QBtn:v["a"]}),w()(C,"directives",{ClosePopup:y["a"]})},a76d:function(t,e,s){"use strict";var i;s.d(e,"a",(function(){return i})),function(t){t["system"]="system",t["light"]="light",t["dark"]="dark"}(i||(i={}))},a8a5:function(t,e,s){},b35b:function(t,e,s){"use strict";s("b68e")},b4ab:function(t,e,s){"use strict";var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-dialog",{attrs:{value:t.show,persistent:"",position:t.screen$xs?"bottom":"standard","content-class":"fullscreen-dialog"},on:{input:t.changeShow}},[s("input",{ref:"fileSelector",staticStyle:{display:"none"},attrs:{type:"file",id:"file-selector"},on:{change:t.onFileChange}}),s("input",{ref:"folderSelector",staticStyle:{display:"none"},attrs:{type:"file",webkitdirectory:"",id:"folder-selector"},on:{change:t.onFolderChange}}),s("q-card",{staticClass:"card-container"},[s("q-card-section",{staticClass:"card-header non-selectable",class:{"q-py-sm":t.screen$xs}},[s("div",{staticClass:"text-h6 text-weight-bold q-my-none"},[t._v(t._s(t.$t("quick_start")))])]),s("q-separator",{directives:[{name:"show",rawName:"v-show",value:t.screen$xs,expression:"screen$xs"}]}),s("div",{staticClass:"card-content"},[s("q-card-section",{staticClass:"q-pt-none"},[s("div",{staticClass:"from-file-or-task flex items-start justify-start q-mb-lg"},[t.isCapacitor?t._e():s("div",{staticClass:"from-file-or-folder q-mt-md col-grow"},[s("q-btn",{staticClass:"full-width",class:{"q-mt-sm":!t.isElectron},attrs:{unelevated:"",dense:t.isElectron,color:"primary","text-color":"primary",label:t.$t("select_file")},on:{click:function(){return t.$refs.fileSelector.click()}}}),t.isElectron?s("q-btn",{staticClass:"full-width q-mt-sm",attrs:{unelevated:"",dense:"",color:"primary","text-color":"primary",label:t.$t("select_folder")},on:{click:function(){return t.$refs.folderSelector.click()}}}):t._e()],1),s("q-select",{staticClass:"col-grow q-mt-md",class:t.isCapacitor?"q-ml-none":"q-ml-sm",attrs:{outlined:"",dense:"","bottom-slots":"","use-input":"","menu-anchor":"bottom right","menu-self":"top end","menu-offset":[0,0],"popup-content-style":"height: 320px !important",behavior:"menu",label:t.$t("select_from_tasks"),options:t.taskOptions},on:{input:t.selectTask,filter:t.filterOptions},nativeOn:{paste:function(t){t.stopPropagation()}},scopedSlots:t._u([{key:"hint",fn:function(){return[s("div",{staticClass:"from-magnet text-primary cursor-pointer non-selectable",on:{click:function(e){e.stopPropagation(),e.preventDefault(),t.showMagnetInput=!0}}},[t._v("\n                "+t._s(t.$t("import_from_magnet"))+"\n              ")])]},proxy:!0}]),model:{value:t.abSelect,callback:function(e){t.abSelect=e},expression:"abSelect"}})],1),s("div",{staticClass:"post-inputs"},[s("q-input",{staticClass:"full-width q-mb-sm",attrs:{dense:"",outlined:"",label:t.$t("post_title"),rules:[t.rules.validatePostTitle]},nativeOn:{paste:function(t){t.stopPropagation()}},model:{value:t.postTitle,callback:function(e){t.postTitle=e},expression:"postTitle"}}),s("q-input",{staticClass:"full-width q-mb-sm",attrs:{dense:"",outlined:"",label:t.$t("placeholder_post_desc"),rules:[t.rules.validatePostDesc]},nativeOn:{paste:function(t){t.stopPropagation()}},model:{value:t.postDescription,callback:function(e){t.postDescription=e},expression:"postDescription"}}),s("q-input",{staticClass:"full-width q-mb-sm",attrs:{dense:"",outlined:"",label:t.appName+" URL",rules:[t.rules.validatePostUrl]},nativeOn:{paste:function(t){t.stopPropagation()}},model:{value:t.abUrl,callback:function(e){t.abUrl=e},expression:"abUrl"}}),s("ImageWithPreview",{staticClass:"q-mb-sm",attrs:{label:t.$t("poster"),rules:[t.rules.validatePostImage]},on:{state:t.updatePostImageState},model:{value:t.postImage,callback:function(e){t.postImage=e},expression:"postImage"}}),s("q-select",{staticClass:"full-width q-mb-sm",attrs:{dense:"",outlined:"",options:t.rateOptions,label:t.$t("film_rate")},model:{value:t.rate,callback:function(e){t.rate=e},expression:"rate"}})],1)]),s("q-card-section",{staticClass:"q-py-none"},[s("div",{staticClass:"channel-option non-selectable"},[s("label",{staticClass:"text-bold q-mr-sm",staticStyle:{"font-size":"1.125rem"}},[t._v(t._s(t.$t("channel_options")))]),s("q-radio",{attrs:{val:!0,label:t.$t("create_new_channel")},model:{value:t.createChannel,callback:function(e){t.createChannel=e},expression:"createChannel"}}),s("q-radio",{attrs:{val:!1,label:t.$t("use_existed_channel")},model:{value:t.createChannel,callback:function(e){t.createChannel=e},expression:"createChannel"}})],1),t.createChannel?s("div",{staticClass:"channel-inputs"},[s("q-input",{staticClass:"full-width q-mb-sm",attrs:{dense:"",outlined:"",label:t.$t("channel_title"),rules:[t.rules.validateChannelTitle]},nativeOn:{paste:function(t){t.stopPropagation()}},model:{value:t.channelTitle,callback:function(e){t.channelTitle=e},expression:"channelTitle"}}),s("q-input",{staticClass:"full-width q-mb-sm",attrs:{dense:"",outlined:"",label:t.$t("placeholder_channel_desc"),rules:[t.rules.validateChannelDesc]},nativeOn:{paste:function(t){t.stopPropagation()}},model:{value:t.channelDescription,callback:function(e){t.channelDescription=e},expression:"channelDescription"}}),s("ImageWithPreview",{attrs:{label:t.$t("channel_poster"),rules:[t.rules.validateChannelImage]},on:{state:t.updateChannelImageState},model:{value:t.channelImage,callback:function(e){t.channelImage=e},expression:"channelImage"}})],1):s("div",{staticClass:"channel-select"},[s("q-select",{staticClass:"full-width",attrs:{outlined:"","bottom-slots":"","use-input":"",dense:"","popup-content-style":"max-height: 320px !important","menu-anchor":"bottom right","menu-self":"top end","menu-offset":[0,0],"data-cy":"select-direct",behavior:"menu",label:t.$t("select_existed_channel"),options:t.channelOptions},on:{filter:t.filterChannels},nativeOn:{paste:function(t){t.stopPropagation()}},scopedSlots:t._u([{key:"option",fn:function(e){return[s("q-item",t._g(t._b({},"q-item",e.itemProps,!1),e.itemEvents),[s("q-item-section",[s("q-item-label",[s("span",{staticClass:"label"},[t._v(t._s(e.opt.label))]),s("small",{staticClass:"text-grey q-ml-sm"},[t._v(t._s(e.opt.caption))])])],1)],1)]}}]),model:{value:t.selectedChannel,callback:function(e){t.selectedChannel=e},expression:"selectedChannel"}})],1)])],1),s("q-separator",{directives:[{name:"show",rawName:"v-show",value:t.screen$xs,expression:"screen$xs"}]}),s("q-card-actions",{staticClass:"card-footer",attrs:{align:"right"}},[s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:t.$t("cancel")}}),s("q-btn",{attrs:{unelevated:"",label:t.$t("lib_submit"),disable:!t.submitReady,"text-color":"primary",color:"primary"},on:{click:t.submit}})],1)],1),s("q-dialog",{attrs:{value:!!t.progressText,persistent:""}},[s("q-card",{staticClass:"progress-card"},[s("q-card-section",[s("div",{staticClass:"text q-pa-md"},[t._v(t._s(t.progressText))])])],1)],1),s("q-dialog",{on:{hide:function(e){t.magnetInput=""}},model:{value:t.showMagnetInput,callback:function(e){t.showMagnetInput=e},expression:"showMagnetInput"}},[s("q-card",{staticStyle:{width:"480px"}},[s("q-card-section",{staticClass:"full-width"},[s("div",{staticClass:"text-h6"},[t._v(t._s(t.$t("input_magnet_url")))]),s("q-input",{attrs:{type:"text",autofocus:""},nativeOn:{paste:function(t){t.stopPropagation()}},model:{value:t.magnetInput,callback:function(e){t.magnetInput=e},expression:"magnetInput"}})],1),s("q-card-actions",{attrs:{align:"right"}},[s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",icon:"close"}}),s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",icon:"done",color:"primary","text-color":"primary"},on:{click:t.fromMagnet}})],1)],1)],1)],1)},a=[],o=(s("ace4"),s("5cc6"),s("907a"),s("3c5d"),s("219c"),s("ddb0"),s("498a"),s("f880")),n=s("4aad"),r=s("648d"),l=s("c65d"),c=s("ed08"),d=s("43a8"),h=s("1141"),u=s("c428"),p=s("8847"),m=s("20fc"),g=s("849b"),f=s("0613"),b=s("708e"),v=s.n(b),y=s("77d8");const _=4e9,w=t=>new Promise((e=>setTimeout(e,t))),C=()=>{const t=new Uint8Array(12);return crypto.getRandomValues(t),t.reduce(((t,e)=>{const s=e.toString(16).padStart(2,"0");return t+s}),"")};var $={components:{ImageWithPreview:l["a"]},name:"QuickStart",props:{show:Boolean,preset:{required:!1,default:null}},data(){const t=[{label:this.$t("rate_g"),value:"G"},{label:this.$t("rate_pg"),value:"PG"},{label:this.$t("rate_pg_13"),value:"PG-13"},{label:this.$t("rate_r"),value:"R"},{label:this.$t("rate_nc_17"),value:"NC-17"}],e={validateChannelTitle(t){return t.length>0&&t.length<100||p["b"].t("validate_channel_title_length")},validateChannelDesc(t){return t.length>9&&t.length<301||p["b"].t("validate_channel_desc_length")},validateChannelImage(t){return!t||(t.match(/\s/)?p["b"].t("validate_url_no_space"):(t.startsWith("http://")||t.startsWith("https://"))&&t.length<2048||p["b"].t("validate_channel_image_url"))},validatePostTitle(t){return t.length>0&&t.length<100||p["b"].t("validate_post_title_length")},validatePostDesc(t){return t.length>9&&t.length<301||p["b"].t("validate_post_desc_length")},validatePostImage(t){return!t||(t.match(/\s/)?p["b"].t("validate_url_no_space"):(t.startsWith("http://")||t.startsWith("https"))&&t.length<2048||p["b"].t("validate_post_image_url"))},validatePostUrl(t){if(!t.startsWith(v.a.shortProtocol+"://")&&!t.startsWith(v.a.protocol+"://"))return p["b"].t("validate_post_url");const e=Object(u["a"])(t);return 28!==e.length?p["b"].t("validate_post_url"):t.length<2048||p["b"].t("validate_post_url_length")}},s=v.a.displayName;return{appName:s,rules:e,progressText:"",postTitle:"",titleFromTask:"",postDescription:"",postImage:"",isPostImageLoaded:!1,channelTitle:"",channelDescription:"",channelImage:"",isChannelImageLoaded:!1,abUrl:"",abSelect:null,rateOptions:t,magnetInput:"",showMagnetInput:!1,createChannel:!0,rate:t[0],taskOptions:[],channelFilterInput:"",selectedChannel:{label:"",title:"",id:""},isElectron:Object(c["isElectron"])(),isCapacitor:Object(y["a"])()}},computed:{username(){return n["a"].userData.name?n["a"].userData.name:f["a"].getters.accountUserInfo.nickname?f["a"].getters.accountUserInfo.nickname:n["a"].user.name||"-"},uploadingTasks(){return r["a"].taskList.uploading.map((t=>this.getTaskOption(t)))},channelOptions(){return n["a"].ownedChannels.filter((t=>!!t.id&&t.title.toLowerCase().includes(this.channelFilterInput))).filter((t=>n["a"].channelList.some((e=>t.id===e.id)))).map((t=>{const e=t.title.length>48?t.title.substring(0,44)+"...":t.title;return{label:e,title:t.title,caption:"%"+t.id,id:t.id}}))},submitReady(){if(this.channelImage&&!this.isChannelImageLoaded)return!1;if(this.channelImage&&!0!==this.rules.validateChannelImage(this.channelImage))return!1;if(this.postImage&&!this.isPostImageLoaded)return!1;if(this.postImage&&!0!==this.rules.validatePostImage(this.postImage))return!1;if(!this.rate)return!1;if(this.createChannel){if([this.rules.validateChannelTitle(this.channelTitle),this.rules.validateChannelDesc(this.channelDescription)].some((t=>!0!==t)))return!1}else if(!this.selectedChannel.id)return!1;return!![this.rules.validatePostTitle(this.postTitle),this.rules.validatePostDesc(this.postDescription),this.rules.validatePostUrl(this.abUrl)].every((t=>!0===t))}},methods:{todo(){this.$q.notify("TODO: This is not impl")},changeShow(t){this.$emit("input",t)},clear(){var t;const e={progressText:"",postTitle:"",titleFromTask:"",postDescription:"",postImage:"",isPostImageLoaded:!1,channelTitle:"",channelDescription:"",channelImage:"",isChannelImageLoaded:!1,abUrl:"",abSelect:null,magnetInput:"",showMagnetInput:!1,createChannel:!0,rate:this.rateOptions[0],taskOptions:[],channelFilterInput:"",selectedChannel:{label:"",title:"",id:""}};null!==(t=this.channelOptions)&&void 0!==t&&t.length&&(e.createChannel=!1,e.selectedChannel=this.channelOptions[0]);for(const s in e)this.$set(this,s,e[s])},getTaskOption(t){var e;const s=t.postTitle||t.name||t.infoHash,i=s.length>36?s.substring(0,32)+"...":s;let a=Object(o["f"])(t.progress||1);if(t.ready)a="100.00%";else if(t.verifyStatus){const{current:e,total:s}=t.verifyStatus,i=e/s,n=Object(o["f"])(i);isNaN(i)||(a=n)}const n=(null===(e=t.alphabizURI.split("&"))||void 0===e?void 0:e[0])||t.alphabizURI,r=v.a.shortProtocol+"://"+n.split("/").pop();return{label:t.ready?i:i+` (${a})`,title:s,progress:a,value:r,ready:t.ready}},filterOptions(t,e){const s=t.toLowerCase();e((()=>{this.taskOptions=this.uploadingTasks.filter((t=>t.title.toLowerCase().includes(s)))}))},selectTask(t){this.abUrl=t.value,this.postTitle?this.titleFromTask=t.title:this.postTitle=t.title,this.postDescription||(this.postDescription=this.$t("uploaded_by",{title:t.title,name:this.username})),this.channelTitle||(this.channelTitle=t.title),this.channelDescription||(this.channelDescription=this.$t("created_by",{title:t.title,name:this.username}))},filterChannels(t,e){const s=t.toLowerCase();e((()=>{this.channelFilterInput=s}))},updatePostImageState(t){this.isPostImageLoaded=1===t},updateChannelImageState(t){this.isChannelImageLoaded=1===t},showProgress(t,...e){console.log(this.$t("progress")+":",t,...e),this.progressText=t},async createNewChannel(){const t=await n["a"].createChannel(this.channelTitle.trim(),this.channelDescription.trim(),this.channelImage.trim());return console.log("Channel created",t),t},async submit(){let t=!1,e=null;const s=async s=>(clearTimeout(e),e=setTimeout((()=>{t=!0,this.$q.dialog({message:this.$t("quick_start_timeout",[s]),ok:this.$t("ok")})}),11e3),new Promise((t=>setTimeout(t,1e4))));let i=this.selectedChannel.id;if(this.createChannel){this.showProgress(this.$t("creating_new_channel")),await w(1e3);const a=await Promise.race([this.createNewChannel(),s(this.$t("create_new_channel"))]);if(clearTimeout(e),console.log(a),t||!a)return this.showProgress("");this.showProgress(this.$t("created_new_channel"),a),await w(1e3),i=a.id}this.showProgress(this.$t("creating_new_post")),await w(1e3);const a=await Promise.race([n["a"].createPost({title:this.postTitle.trim(),description:this.postDescription.trim(),image:this.postImage.trim(),rate:this.rate.value,abUrl:this.abUrl.trim()},i),s(this.$t("create_new_post"))]);if(t||!a)return this.showProgress("");clearTimeout(e),this.showProgress(this.$t("created_new_post"),a),await w(2e3),this.showProgress(""),await w(500),this.$emit("input",!1),this.$q.dialog({message:this.$t("success"),ok:this.$t("ok")})},async askForConfirm(t,e){return new Promise((s=>{this.$q.dialog({title:t,message:e,ok:this.$t("ok"),cancel:this.$t("cancel")}).onOk((()=>s(!0))).onCancel((()=>s(!1)))}))},calcFileSize(t){return t.reduce(((t,e)=>t+e.size),0)},async onFileChange(t){var e,i;const a=null===t||void 0===t||null===(e=t.target)||void 0===e||null===(i=e.files)||void 0===i?void 0:i[0];if(a){if(console.log("file selected",a),t.target.value=null,a.size>_){const t=await this.askForConfirm(this.$t("file_too_large"),this.$t("file_too_large_msg",{size:Object(o["a"])(a.size)}));if(!t)return}if(Object(c["isElectron"])())this.createTask(a.path);else{const t=s("ac4e").wtClient;if(t.torrents.length){const e=await this.askForConfirm(this.$t("remove_old_task"),this.$t("remove_old_task_desc"));if(!e)return;t.torrents[0].destroy(),t.torrents.splice(0)}this.createTask(a)}}},async onFolderChange(t){var e,s,i;console.log("onFolderChange",t),(null===t||void 0===t||null===(e=t.target)||void 0===e||null===(s=e.files)||void 0===s?void 0:s.length)>100&&(this.showProgress(this.$t("resolving_folder_files")),await w(100));const a=[...null===t||void 0===t||null===(i=t.target)||void 0===i?void 0:i.files];if(!a)return;console.log("folder selected",a),t.target.value=null;const n=this.calcFileSize(a),r=Object(d["a"])(a.map((t=>t.path)));if(this.showProgress(""),await w(50),n>_){const t=await this.askForConfirm(this.$t("folder_too_large"),this.$t("folder_too_large_msg",{size:Object(o["a"])(n)}));if(!t)return}console.log("TOTAL:",n),console.log("Create task with folder",r),this.createTask(r)},async createTask(t){const e=C();this.showProgress(this.$t("creating_new_task")),Object(c["isElectron"])()?Object(h["g"])(t,e):g["a"].emit("wt-add",t,{token:e});const s=()=>{const t=setInterval((()=>{const s=r["a"].taskList.uploading.find((t=>t.token===e)),i=()=>{this.showProgress(""),this.selectTask(this.getTaskOption(s))};if(s.ready&&s.alphabizURI)return clearInterval(t),void i();if(!s.verifyStatus)return this.showProgress(this.$t("loading")+"... (0%)");const a=Object(o["f"])(s.verifyStatus.current/s.verifyStatus.total);this.showProgress(this.$t("loading")+`... (${a})`),s.verifyStatus.current>=s.verifyStatus.total&&s.alphabizURI&&(clearInterval(t),setTimeout(i,1e3))}),1e3)},i=Date.now(),a=setInterval((()=>{const t=r["a"].taskList.uploading.find((t=>t.token===e));if(t)clearInterval(a),s();else if(Date.now()-i>3e3)return clearInterval(a),this.showProgress(""),this.askForConfirm(this.$t("cannot_create_task"),this.$t("cannot_create_task_msg"))}),500)},async fromMagnet(){if("string"!==typeof this.magnetInput||!this.magnetInput)return;if(!this.magnetInput.startsWith("magnet"))return this.$q.dialog({title:this.$t("invalid_download_url"),ok:this.$t("ok")});let t=this.magnetInput;if(!t.includes("dn=")){if(!this.postTitle)return this.$q.dialog({message:this.$t("magnet_does_not_have_name"),ok:this.$t("ok")});t+=`&dn=${encodeURIComponent(this.postTitle)}`}const e=await Object(m["a"])(t);if(!e)return this.$q.dialog({title:this.$t("invalid_download_url"),ok:this.$t("ok")});const s=t.split("&").find((t=>t.startsWith("dn="))),i=s?decodeURIComponent(s.substring(3)):this.postTitle;if(!i)return this.$q.dialog({title:this.$t("cannot_get_task_name"),ok:this.$t("ok")});this.selectTask({value:e,label:i,title:i})}},watch:{show(t){t&&this.$nextTick((()=>{this.clear(),this.preset&&this.selectTask(this.getTaskOption(this.preset))}))}}},k=$,x=(s("3f23"),s("2877")),q=s("24e8"),S=s("f09f"),P=s("a370"),T=s("eb85"),I=s("9c40"),O=s("ddd8"),U=s("27f9"),L=s("3786"),j=s("66e5"),A=s("4074"),R=s("0170"),B=s("4b7e"),D=s("7f67"),Q=s("eebe"),F=s.n(Q),E=Object(x["a"])(k,i,a,!1,null,"21d380c1",null);e["a"]=E.exports;F()(E,"components",{QDialog:q["a"],QCard:S["a"],QCardSection:P["a"],QSeparator:T["a"],QBtn:I["a"],QSelect:O["a"],QInput:U["a"],QRadio:L["a"],QItem:j["a"],QItemSection:A["a"],QItemLabel:R["a"],QCardActions:B["a"]}),F()(E,"directives",{ClosePopup:D["a"]})},b68e:function(t,e,s){},b739:function(t,e,s){},bca4:function(t,e,s){"use strict";s("4396")},c65d:function(t,e,s){"use strict";var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"image-with-preview full-width"},[s("q-input",{staticClass:"full-width",attrs:{outlined:"","stack-label":"",value:t.value,label:t.label,rules:t.rules,placeholder:"https://example.org/path/to/image.jpg",debounce:500},on:{input:t.emitSrc},nativeOn:{paste:function(t){t.stopPropagation()}},scopedSlots:t._u([{key:"after",fn:function(){return[s("div",{staticClass:"image-container"},[s("img",{staticClass:"preview-image",class:t.state,attrs:{src:t.realSrc},on:{error:t.emitError,load:t.emitSuccess}}),"error"===t.state?s("q-icon",{attrs:{name:"close",size:"56px",color:"red"}},[s("q-tooltip",[t._v(t._s(t.$t("invalid_image")))])],1):t._e(),"loading"===t.state?s("q-icon",{attrs:{name:"image",size:"56px",color:"green"}},[s("q-tooltip",[t._v(t._s(t.$t("poster")))])],1):t._e()],1)]},proxy:!0}])})],1)},a=[],o={props:{value:String,label:String,rules:{type:Array,default:()=>[]}},data(){return{state:"loading"}},computed:{realSrc(){let t=this.value||"";while(t.startsWith("https%3A%2F%2F"))t=decodeURIComponent(t),console.log("decode",this.value,t);return t}},methods:{emitSrc(t){this.$emit("input",t)},emitError(){""!==this.value&&(this.$emit("state",2),this.state="error")},emitSuccess(){this.$emit("state",1),this.state="loaded"}},watch:{value(){console.log("src change"),this.$emit("state",0),this.state="loading"}}},n=o,r=(s("eda3"),s("2877")),l=s("27f9"),c=s("0016"),d=s("05c0"),h=s("eebe"),u=s.n(h),p=Object(r["a"])(n,i,a,!1,null,"048417eb",null);e["a"]=p.exports;u()(p,"components",{QInput:l["a"],QIcon:c["a"],QTooltip:d["a"]})},ca9f:function(t,e,s){},cc54:function(t,e,s){"use strict";s("feb4")},cdb1:function(t,e,s){"use strict";var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-footer",{attrs:{bordered:""}},[s("div",{directives:[{name:"show",rawName:"v-show",value:!t.disable,expression:"!disable"}],staticClass:"row q-pa-sm setting-footer"},[s("q-btn",{staticClass:"q-mx-xs",attrs:{unelevated:"",loading:t.loading,"text-color":"primary",color:"primary",label:t.$t("submit")},on:{click:t.submit}}),s("q-btn",{staticClass:"q-mx-xs",attrs:{unelevated:"",loading:t.loading,"text-color":"general",color:"general",label:t.$t("discard")},on:{click:t.discard}}),s("q-space"),s("q-btn",{staticClass:"q-mx-xs",attrs:{unelevated:"",loading:t.loading,"text-color":"negative",color:"negative",label:t.$t("reset")},on:{click:t.reset}})],1)])},a=[],o={props:{disable:Boolean,loading:Boolean},methods:{submit(){this.$emit("submit")},discard(){this.$emit("discard")},reset(){this.$emit("reset")}}},n=o,r=(s("3572"),s("2877")),l=s("7ff0"),c=s("9c40"),d=s("2c91"),h=s("eebe"),u=s.n(h),p=Object(r["a"])(n,i,a,!1,null,"faac6c86",null);e["a"]=p.exports;u()(p,"components",{QFooter:l["a"],QBtn:c["a"],QSpace:d["a"]})},d47b:function(t,e,s){},d491:function(t,e,s){"use strict";var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.torrent?s("q-dialog",{staticClass:"detail-dialog",attrs:{value:t.show,position:t.screen$xs?"bottom":"standard","content-class":"fullscreen-dialog"},on:{input:t.closeDialog}},[s("q-card",{staticClass:"detail-dialog",class:t.isCapacitor?"capacitor":""},[s("q-card-section",{staticClass:"flex items-center no-wrap",class:t.screen$xs?"q-py-sm":"q-py-md"},[t.torrent.fromPost?s("q-icon",{staticClass:"q-mr-xs text-primary",attrs:{name:"video_library"}},[s("q-tooltip",[t._v("\n          "+t._s(t.$t("library"))+"\n        ")])],1):t._e(),s("div",{staticClass:"text-h6 ellipsis",attrs:{title:t.torrent.postTitle||t.torrent.name}},[t._v("\n        "+t._s(t.torrent.postTitle||t.torrent.name)+"\n      ")]),s("q-space"),s("q-btn",{directives:[{name:"show",rawName:"v-show",value:t.screen$xs,expression:"screen$xs"},{name:"close-popup",rawName:"v-close-popup"}],attrs:{icon:"close",flat:"",round:""}})],1),s("q-separator",{directives:[{name:"show",rawName:"v-show",value:t.screen$xs,expression:"screen$xs"}]}),s("q-card-section",{class:t.screen$xs?"q-pt-md":"q-pt-none"},[s("q-input",{attrs:{readonly:"",label:t.$t("download")+" URL",outlined:"",dense:""},scopedSlots:t._u([{key:"append",fn:function(){return[s("IconWithTooltip",{attrs:{icon:"content_copy",tooltip:t.$t("copy_download_uri"),clickable:!0},on:{click:t.copyMagnetURI}}),s("IconWithTooltip",{attrs:{icon:"share",tooltip:t.$t("copy_share_uri"),clickable:!0},on:{click:t.copyShortURI}})]},proxy:!0}],null,!1,2307292726),model:{value:t.downloadURI,callback:function(e){t.downloadURI=e},expression:"downloadURI"}})],1),t.fileTree.length?s("q-card-section",{staticClass:"q-pt-none"},[s("div",{staticClass:"title"},[t.isElectron||t.isCapacitor?s("q-btn",{attrs:{flat:"",dense:"",size:"sm"},on:{click:t.showDirectory}},[s("IconWithTooltip",{attrs:{icon:"folder_open",tooltip:t.$t("open_directory"),clickable:""}})],1):t._e(),t._v("\n        "+t._s(t.$t("files"))+":\n      ")],1),s("q-tree",{staticClass:"no-select file-tree",attrs:{nodes:t.fileTree,"node-key":"label",dense:"","no-connectors":""},scopedSlots:t._u([{key:"default-header",fn:function(e){return[s("q-item",{staticClass:"text full-width q-py-none q-px-xs no-margin vertical-middle",class:{"no-path":!e.node.path},attrs:{dense:"",clickable:!e.node.children},on:{dblclick:function(s){return t.onDblClick(e.node)}}},[!e.node.children&&e.node.path?s("IconWithTooltip",t._b({staticClass:"q-mt-xs q-mr-xs"},"IconWithTooltip",t.getFileIcon(e.node.path),!1)):e.node.path?s("IconWithTooltip",{staticClass:"q-mt-xs q-mr-xs",attrs:{icon:"folder"}}):t._e(),t.isCapacitor&&e.node.done&&e.node.fullPath?s("IconWithTooltip",{staticClass:"q-mt-xs q-mr-xs",attrs:{icon:"ios_share",label:t.$t("open_file")},on:{click:function(s){return t.shareFile(e.node)}}}):t._e(),e.node.progress?s("span",{staticClass:"file-progress"},[t._v(t._s(e.node.progress))]):t._e(),s("span",{staticClass:"file-name"},[t._v("‎"+t._s(e.node.label))])],1)]}}],null,!1,3668704012)})],1):t._e(),t.torrent.subtitleList&&t.torrent.subtitleList.length?s("q-card-section",{staticClass:"q-pt-none"},[s("q-expansion-item",{attrs:{"expand-separator":"",icon:"subtitles",label:"字幕 ("+t.torrent.subtitleList.length+")",value:!0}},[s("q-markup-table",{staticClass:"subtitleList-table q-px-sm",attrs:{flat:"",dense:""}},[s("thead",[s("tr",[s("th",{staticClass:"text-center",staticStyle:{"padding-left":"20px"}},[t._v(t._s(t.$t("language")))]),s("th",{staticClass:"text-center"},[t._v(t._s(t.$t("download_link")))]),s("th")])]),s("tbody",t._l(t.torrent.subtitleList,(function(e,i){return s("tr",{key:i},[s("td",{staticClass:"text-center",staticStyle:{"padding-left":"20px"},attrs:{title:e.lang}},[t._v(t._s(e.lang))]),s("td",{staticClass:"text-left url ellipsis",attrs:{title:t.getSubtitleUrl(e.url)}},[t._v(t._s(t.getSubtitleUrl(e.url)))]),s("td",{staticClass:"text-center"},[s("q-btn",{attrs:{icon:"content_copy",size:"xs",dense:"",flat:""},on:{click:function(s){return t.copySubtitleURL(e.url)}}},[s("q-tooltip",[t._v(t._s(t.$t("copy_download_uri")))])],1),t.isElectron?s("q-btn",{attrs:{icon:"file_download",size:"xs",dense:"",flat:""},on:{click:function(s){return t.downloadSubtitleURL(e.url)}}},[s("q-tooltip",[t._v(t._s(t.$t("download_link")))])],1):t._e()],1)])})),0)])],1)],1):t._e(),s("q-card-section",{staticClass:"q-pt-none peers"},[s("q-expansion-item",{attrs:{"expand-separator":"",icon:"people",label:"Peers ("+t.connectedPeers.length+")",value:!0}},[s("q-markup-table",{staticClass:"peer-table q-px-sm",attrs:{flat:"",dense:""}},[s("thead",[s("tr",[s("th",{staticClass:"text-center"}),s("th",{staticClass:"text-left ip",staticStyle:{"padding-left":"32px"}},[t._v("Peer")]),t.isDevMode?s("th",{staticClass:"text-left client"},[t._v(t._s(t.$t("client")))]):t._e(),s("th",{staticClass:"text-right"},[t._v(t._s(t.$t("total_download_speed")))]),s("th",{staticClass:"text-right"},[t._v(t._s(t.$t("total_upload_speed")))]),s("th",{staticClass:"text-right"},[t._v(t._s(t.$t("progress")))])])]),s("tbody",t._l(t.connectedPeers,(function(e){return s("PeerInfo",{key:e.id,attrs:{peer:e},on:{showPaymentPannel:t.showPaymentPannel}})})),1)])],1)],1),t.isDevMode?s("q-card-section",{staticClass:"q-pt-none"},[s("q-expansion-item",{directives:[{name:"show",rawName:"v-show",value:t.trackerList.length,expression:"trackerList.length"}],attrs:{icon:"dns",label:"Trackers ("+t.trackerList.length+")"}},[t.isElectron?s("div",{staticClass:"row justify-end q-pa-sm"},[s("q-input",{staticClass:"col",attrs:{dense:"",type:"text",label:"Tracker URL"},nativeOn:{paste:function(t){t.stopPropagation()}},model:{value:t.newTrackerUrl,callback:function(e){t.newTrackerUrl=e},expression:"newTrackerUrl"}}),s("q-btn",{attrs:{dense:"",color:"primary q-mx-sm q-px-sm",icon:"add",label:t.$t("add")},on:{click:t.addTracker}})],1):t._e(),s("q-markup-table",{staticClass:"tracker-table q-px-sm",attrs:{flat:"",dense:""}},[s("thead",[s("tr",[s("th",{staticClass:"text-left",staticStyle:{"padding-left":"40px"}},[t._v("URL")]),s("th",{staticClass:"text-left"},[t._v(t._s(t.$t("status")))]),s("th",{staticClass:"text-right"},[t._v(t._s(t.$t("last_update")))]),s("th",{staticClass:"text-center"},[t._v(t._s(t.$t("seeders")))]),s("th",{staticClass:"text-center"},[t._v("Peers")]),t.isElectron?s("th"):t._e()])]),s("tbody",t._l(t.trackerList,(function(e){return s("tr",{key:e.url},[s("td",{staticClass:"text-left url",attrs:{title:e.displayUrl+(e.isIpv6?" (IPv6)":"")}},[e.isIpv6?s("IconWithTooltip",{staticStyle:{color:"#4697ec"},attrs:{icon:"looks_6",tooltip:"IPv6",size:"xs"}}):s("q-icon",{attrs:{name:"looks_4",color:"grey",size:"xs"}}),t._v("\n              "+t._s(e.displayUrl)+"\n            ")],1),s("td",{staticClass:"text-left status",attrs:{title:e.status}},[t._v(t._s(e.status))]),s("td",{staticClass:"text-right"},[t._v(t._s(e.time))]),s("td",{staticClass:"text-center"},[t._v(t._s(e.complete))]),s("td",{staticClass:"text-center"},[t._v(t._s(e.incomplete))]),t.isElectron?s("td",{staticClass:"text-center"},[s("q-btn",{attrs:{color:"red",icon:"close",size:"xs",dense:"",flat:""},on:{click:function(s){return t.removeTracker(e.url)}}})],1):t._e()])})),0)])],1)],1):t._e()],1)],1):t._e()},a=[],o=(s("26e9"),s("5319"),s("ddb0"),s("498a"),s("f71e")),n=s("f880"),r=s("51d9"),l=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("tr",[s("td",{staticClass:"status text-center"},[t.peer.isAbPeer?"high"===t.peer.level?s("q-icon",{attrs:{name:"done_all"}},[s("q-tooltip",[t._v(t._s(t.$t("ab_peer_verified")))])],1):s("q-icon",{attrs:{name:"done"}},[s("q-tooltip",[t._v(t._s(t.$t("ab_peer")))])],1):s("q-icon",{attrs:{name:"remove"}},[s("q-tooltip",[t._v(t._s(t.$t("common_peer")))])],1)],1),s("td",{staticClass:"addresses"},t._l(t.peer.addresses,(function(e){return s("div",{key:t.peer.id+"_"+e,staticClass:"self-center not-outline address"},[s("q-icon",{attrs:{name:t.peer.secure?"lock":"lock_open",size:"xs",color:t.peer.secure?"green":"grey"}},[s("q-tooltip",[t._v(t._s(t.peer.secure?t.$t("encrypted_connection"):t.$t("non_encrypted_connection")))])],1),s("span",{staticClass:"country-flag q-ml-sm",attrs:{title:t.country}},[t._v(t._s(t.countryFlag))]),t.isDevMode?s("span",{staticClass:"q-ml-xs"},[t._v(t._s(e))]):s("span",{staticClass:"q-ml-xs"},[t._v(t._s(e?e.substring(0,4)+"*":"-"))])],1)})),0),t.isDevMode?s("td",{staticClass:"client text-left",class:{"text-primary":"Alphabiz"===t.peerClient},attrs:{title:t.peerClient}},[t._v(t._s(t.peerClient))]):t._e(),s("td",{staticClass:"text-right",class:{"text-primary":t.peer.downloadSpeed}},[t._v(t._s(t.downloadSpeed)+" / s")]),s("td",{staticClass:"text-right",class:{"text-primary":t.peer.uploadSpeed}},[t._v(t._s(t.uploadSpeed)+" / s")]),s("td",{staticClass:"progress text-right"},[t._v(t._s(t.peerProgress))])])},c=[],d=s("839e"),h=s.n(d),u=s("b843"),p=s.n(u),m=s("ed08"),g=s("0613");let f=null;Object(m["isElectron"])()&&(f=global["require"]("geoip-country"));var b={props:{peer:{type:Object,required:!0}},computed:{isDevMode(){return g["a"].getters.isDevMode},country(){const t=this.peer.addresses[0];if(!t)return"";try{const e=f.lookup(t);return e&&e.country?e.country:""}catch(e){return""}},countryFlag(){return this.country?h.a.getEmojiFlag(this.country):""},uploadSpeed(){return Object(n["a"])(this.peer.uploadSpeed,{byte:!1,gb:!1})},downloadSpeed(){return Object(n["a"])(this.peer.downloadSpeed,{byte:!1,gb:!1})},peerClient(){if(!this.peer.id)return"-";const t=Buffer.from(this.peer.id,"hex").toString("ascii");try{const e=p()(t.replace("-AB","-WD")),s=this.peer.isAbPeer?"(Alphabiz)WebTorrent":e.client;return"unknown"===s?this.$t("unknown"):e.version?s+" "+e.version:s}catch(e){return this.$t("unknown")}},peerProgress(){if("number"!==typeof this.peer.progress)return"-";const t=Number((100*this.peer.progress).toFixed(1));return t+"%"}},methods:{showPaymentPannel(){this.$emit("showPaymentPannel",{peerId:this.peer.id,address:this.peer.address,remoteUser:this.peer.user,remoteSubId:this.peer.subId})}}},v=b,y=(s("cc54"),s("2877")),_=s("0016"),w=s("05c0"),C=s("eebe"),$=s.n(C),k=Object(y["a"])(v,l,c,!1,null,"3bfc5956",null),x=k.exports;$()(k,"components",{QIcon:_["a"],QTooltip:w["a"]});var q=s("307e"),S=s("6ea7"),P=s("9649"),T=s("708e"),I=s.n(T),O=s("77d8"),U={props:{show:{type:Boolean,default:!1},torrent:{type:Object,required:!0}},data(){const t=Object(P["default"])()?s("34bb").ipcRenderer:{};return{newTrackerUrl:"",isCapacitor:Object(O["a"])(),isElectron:Object(P["default"])(),ipcRenderer:t}},components:{IconWithTooltip:r["a"],PeerInfo:x},inject:["io"],computed:{isDevMode(){return g["a"].getters.isDevMode},fileCount(){if(!this.torrent)return 0;const t=this.torrent.files||this.torrent.file||[];return t&&t.length?t.length:0},fileTree(){if(!this.torrent)return[];const t=this.torrent.files&&this.torrent.files.map?this.torrent.files.map((t=>t.path)):this.torrent.file||[];if(!t||!t.length)return[];const e=this.fileCount>21?t.slice(t.length-20):t,s=Object(n["b"])(e,this.torrent.files);return s?(this.fileCount>21&&s.children&&s.children.push({label:this.$t("more_files_are_not_shown",[this.fileCount-20])}),[s]):[]},downloadURI(){return this.torrent.alphabizURI?this.torrent.alphabizURI:this.torrent.magnetURI},trackerList(){if(!this.torrent.trackerList)return[];const t=this.torrent.trackerList.map((t=>{const e=this.trackerStatus(t.message||t.status),s=t.info||{complete:"-",incomplete:"-"},i=new Date(t.timestamp),a=[i.getHours(),i.getMinutes(),i.getSeconds()].map((t=>("00"+t).slice(-2))).join(":");return{url:t.url,displayUrl:t.url.replace("@6",""),status:e,time:a,isIpv6:t.isIpv6,...s}})).reverse();return Object(P["default"])()?t:t.filter((t=>{var e;return null===(e=t.url)||void 0===e?void 0:e.startsWith("ws")}))},connectedPeers(){if(!this.torrent||!this.torrent.connections)return[];const t={};for(const i of this.torrent.connections){const e=i.id;t[e]||(t[e]={...i},t[e].addresses=[],t[e].uploadSpeed=0,t[e].downloadSpeed=0,t[e].downloaded=0),t[e].addresses.includes(i.address)||t[e].addresses.push(i.address),t[e].uploadSpeed+=i.uploadSpeed,t[e].downloadSpeed+=i.downloadSpeed,t[e].downloaded+=i.downloaded,t[e].isAbPeer|=i.isAbPeer,t[e].isPayed|="high"===i.remoteGroup,t[e].secure|=i.secure}const e=[],s=Object.values(t).sort(((t,e)=>{var s;return null!==(s=t.id)&&void 0!==s&&s.localeCompare?t.id.localeCompare(e.id):0})).filter((t=>!!t.id&&(!e.includes(t.id)&&(e.push(t.id),!0))));return s}},methods:{getFileIcon(t){const e=Object(n["c"])([t]);return{icon:e.icon,tooltip:this.$t(e.tooltip)}},closeDialog(){this.$emit("close")},copyToClipboard(t){Object(o["b"])(t).then((()=>{this.$q.notify(this.$t("uri_copied"))})).catch((()=>{this.$q.notify(this.$t("uri_copy_failed"))}))},copyMagnetURI(){this.copyToClipboard(this.downloadURI)},copyShortURI(){if(!this.torrent.alphabizURI)return;const t=this.torrent.alphabizURI.match(/[^:/]\/([^&/]+)&/);t&&t[1]&&this.copyToClipboard(I.a.shortProtocol+"://"+t[1])},copySubtitleURL(t){console.log("copySubtitleURL",this.torrent),this.copyToClipboard(Object(S["c"])(t))},downloadSubtitleURL(t){this.ipcRenderer.send("to_browserurl",Object(S["c"])(t))},getSubtitleUrl(t){return Object(S["c"])(t)},showPaymentPannel(t){this.$emit("showPaymentPannel",Object.assign({infoHash:this.torrent.infoHash,name:this.torrent.name},t))},showDirectory(){this.$emit("showDirectory",this.torrent)},onDblClick(t){console.log(t),t.children||(Object(q["a"])(t.label)?this.$emit("play",t.path,this.torrent.infoHash):t.path&&this.io.emit("open-external-file",t.path))},shareFile(t){this.$emit("shareFile",t.fullPath)},trackerStatus(t){const e=t.toLowerCase();return"connecting"===e?this.$t("connecting"):"updated"===e?this.$t("connected"):e.includes("timed out")?this.$t("request_timed_out"):e.includes("connection failed")?this.$t("connection_failed"):this.$t("unknown_error",[t])},addTracker(){console.log("add",this.newTrackerUrl,this.torrent.infoHash);const t=this.newTrackerUrl.trim();if(this.torrent.trackerList.find((e=>e.url===t)))return this.$q.notify(this.$t("duplicate_tracker"));this.isElectron&&this.ipcRenderer.send("add-tracker",{infoHash:this.torrent.infoHash,url:t}),this.newTrackerUrl=""},removeTracker(t){console.log("remove",t,this.torrent.infoHash),this.isElectron&&this.ipcRenderer.send("remove-tracker",{infoHash:this.torrent.infoHash,url:t})}}},L=U,j=(s("449c"),s("24e8")),A=s("f09f"),R=s("a370"),B=s("2c91"),D=s("9c40"),Q=s("eb85"),F=s("27f9"),E=s("7f41"),V=s("66e5"),N=s("3b73"),z=s("2bb1"),H=s("7f67"),M=Object(y["a"])(L,i,a,!1,null,"6136421d",null);e["a"]=M.exports;$()(M,"components",{QDialog:j["a"],QCard:A["a"],QCardSection:R["a"],QIcon:_["a"],QTooltip:w["a"],QSpace:B["a"],QBtn:D["a"],QSeparator:Q["a"],QInput:F["a"],QTree:E["a"],QItem:V["a"],QExpansionItem:N["a"],QMarkupTable:z["a"]}),$()(M,"directives",{ClosePopup:H["a"]})},decc:function(t,e,s){"use strict";e["a"]=function(t){const e=function(){return"index"===t||"explore"===t?this.searchFilteredPosts:"favorite"===t?this.filteredFavorites:void 0},s=async function(){this.loader$loadPostsNext?await this.loader$loadPostsNext({count:6}):this.loadNext&&await this.loadNext()};return{data(){return{pagination:{descending:!0,page:1,rowsPerPage:6}}},computed:{tableData:e,pagesNumber(){return Math.ceil(this.tableData.length/this.pagination.rowsPerPage)},currentPageNumber(){return this.pagination.page}},watch:{async currentPageNumber(t){const e=this.$el.querySelector(".library-table>.q-table__grid-content");if(e.scrollTop=0,t===this.pagesNumber)try{this.loading=!0,console.log("query"),await s.call(this)}catch(i){this.$q.notify({type:"negative",position:"bottom-right",message:i.message})}finally{this.loading=!1}}}}}},e061:function(t,e,s){"use strict";var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{directives:[{name:"show",rawName:"v-show",value:!t.electronOnly||t.isElectron,expression:"electronOnly ? isElectron : true"}],staticClass:"setting-block row q-pt-sm q-pb-md"},[s("div",{staticClass:"setting-label col-xs-12 col-sm-4 q-pt-sm"},[s("span",{staticClass:"q-mr-md"},[t._v(t._s(t.label))])]),s("div",{staticClass:"setting-content col row"},[t._t("default")],2)])},a=[],o=s("ed08"),n={props:{label:String,electronOnly:Boolean},data(){return{isElectron:Object(o["isElectron"])()}}},r=n,l=(s("1eab"),s("2877")),c=Object(l["a"])(r,i,a,!1,null,"00cd607c",null);e["a"]=c.exports},e38a:function(t,e,s){"use strict";s("f05f")},e5e5:function(t,e,s){"use strict";s("a8a5")},e64e:function(t,e,s){"use strict";s.d(e,"a",(function(){return a}));var i=s("4aad");const a={data(){return{isActive:!1,searchText:"",lib:i["a"]}},activated(){this.isActive=!0,this.searchText=i["a"].search.text},deactivated(){this.isActive=!1},watch:{"lib.search.text"(t){this.isActive&&(this.searchText=t)}}}},eda3:function(t,e,s){"use strict";s("9c86")},f05f:function(t,e,s){},f9fe:function(t,e,s){},feb4:function(t,e,s){}}]);